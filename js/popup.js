(function(){var qZ=function(qZ,bK){var cx=function(){};cx.prototype=qZ;var Rr=new cx;if(bK){var Lz={}.hasOwnProperty;for(var wv in bK)if(Lz.call(bK,wv))Rr[wv]=bK[wv]}return Rr},bK=false,cx=new Lz;function Rr(qZ,bK){var cx=new Audio(qZ);if(bK)cx.volume=bK;cx.load();var Rr=false;function Lz(qZ){wv(qZ)}function wv(qZ){if(!cx.paused)if(cx.pause(),!qZ)cx.currentTime=0;try{var bK=cx.play();if(bK)bK.then((function(){})).catch((function(qZ){}))}catch(qZ){}}this.play=function(qZ){wv(qZ)},this.startLoop=function(qZ){if(Rr)return;cx.addEventListener("ended",Lz),Lz(qZ),Rr=true},this.stopLoop=function(qZ){try{cx.removeEventListener("ended",Lz)}catch(qZ){}if(cx.pause(),!qZ)cx.currentTime=0;Rr=false},this.isPlaying=function(){return!cx.paused},this.isPaused=function(){return cx.paused},this.stop=this.stopLoop}function Lz(){this.credit=new Rr("../sounds/credit.mp3"),this.coffeeBreakMusic=new Rr("../sounds/coffee-break-music.mp3"),this.die=new Rr("../sounds/miss.mp3"),this.ghostReturnToHome=new Rr("../sounds/ghost-return-to-home.mp3"),this.eatingGhost=new Rr("../sounds/eating-ghost.mp3"),this.ghostTurnToBlue=new Rr("../sounds/ghost-turn-to-blue.mp3",.5),this.eatingFruit=new Rr("../sounds/eating-fruit.mp3"),this.ghostSpurtMove1=new Rr("../sounds/ghost-spurt-move-1.mp3"),this.ghostSpurtMove2=new Rr("../sounds/ghost-spurt-move-2.mp3"),this.ghostSpurtMove3=new Rr("../sounds/ghost-spurt-move-3.mp3"),this.ghostSpurtMove4=new Rr("../sounds/ghost-spurt-move-4.mp3"),this.ghostNormalMove=new Rr("../sounds/ghost-normal-move.mp3"),this.extend=new Rr("../sounds/extend.mp3"),this.eating=new Rr("../sounds/eating.mp3",.5),this.startMusic=new Rr("../sounds/start-music.mp3"),this.ghostReset=function(qZ){for(var bK in this){if(bK=="silence"||bK=="ghostReset")return;if(bK.match(/^ghost/))this[bK].stopLoop(qZ)}},this.silence=function(qZ){for(var bK in this){if(bK=="silence"||bK=="ghostReset")return;this[bK].stopLoop(qZ)}}}var wv=function(){return"#"+("00000"+(Math.random()*(1<<24)|0).toString(16)).slice(-6)},Gw=function(qZ,bK){return Math.floor(Math.random()*(bK-qZ+1))+qZ},AA=0,pF=1,gO=2,qN=3,Yl=false,ao=false,De=AA,TS=(ty=["PAC-MAN","MS PAC-MAN","COOKIE-MAN","CRAZY OTTO"],function(qZ){if(qZ==void 0)qZ=De;return ty[qZ]}),ty,qK=(SW=[["ORIGINAL ARCADE:","NAMCO (C) 1980","","REVERSE-ENGINEERING:","JAMEY PITTMAN","","REMAKE:","SHAUN WILLIAMS"],["ORIGINAL ARCADE ADDON:","MIDWAY/GCC (C) 1981","","REVERSE-ENGINEERING:","BART GRANTHAM","","REMAKE:","SHAUN WILLIAMS"],["A NEW PAC-MAN GAME","WITH RANDOM MAZES:","SHAUN WILLIAMS (C) 2012","","COOKIE MONSTER DESIGN:","JIM HENSON","","PAC-MAN CROSSOVER CONCEPT:","TANG YONGFA"],["THE UNRELEASED","MS. PAC-MAN PROTOTYPE:","GCC (C) 1981","","SPRITES REFERENCED FROM","STEVE GOLSON'S","CAX 2012 PRESENTATION","","REMAKE:","SHAUN WILLIAMS"]],function(qZ){if(qZ==void 0)qZ=De;return SW[qZ]}),SW,xk=function(qZ){if(qZ==void 0)qZ=De;if(qZ==qN)return["plato","darwin","freud","newton"];else if(qZ==pF)return["blinky","pinky","inky","sue"];else if(qZ==AA)return["blinky","pinky","inky","clyde"];else if(qZ==gO)return["elmo","piggy","rosita","zoe"]},yH=function(qZ){if(qZ==void 0)qZ=De;if(qZ==qN)return PP.drawMonsterSprite;else if(qZ==gO)return PP.drawMuppetSprite;else return PP.drawGhostSprite},Jz=function(qZ){if(qZ==void 0)qZ=De;if(qZ==qN)return PP.drawOttoSprite;else if(qZ==AA)return PP.drawPacmanSprite;else if(qZ==pF)return PP.drawMsPacmanSprite;else if(qZ==gO)return Ly},eT,Gs,Rg;(function(){var qZ,bK,cx,Rr,Lz;eT=function(){for(wX.invincible=false,wX.ai=false,qZ=0;qZ<5;qZ++)Af[qZ].isDrawPath=false,Af[qZ].isDrawTarget=false;EC.setUpdatesPerSecond(60)},Rr={},Lz={},Gs=function(){for(bK=wX.invincible,cx=wX.ai,qZ=0;qZ<5;qZ++)Rr[qZ]=Af[qZ].isDrawPath,Lz[qZ]=Af[qZ].isDrawTarget},Rg=function(){for(wX.invincible=bK,wX.ai=cx,qZ=0;qZ<5;qZ++)Af[qZ].isDrawPath=Rr[qZ],Af[qZ].isDrawTarget=Lz[qZ]}})();var qy=1,TM=0,pg={},IF={},SO={},bj={},na={},sx=function(qZ){pg[qZ]=qy,IF[qZ]=TM,SO[qZ]=EG(),bj[qZ]=Zq(),na[qZ]=LM},Qe=function(qZ){if(qy=pg[qZ],TM!=IF[qZ])TM=IF[qZ],BA.drawMap();ri(SO[qZ]),gw(bj[qZ]),LM=na[qZ]},yB=[0,0,0,0,0,0,0,0,0],IY=[1e4,1e4,1e4,1e4,1e4,1e4,1e4,1e4],xu=function(){if(Yl)return 8;return De*2+(ao?1:0)},UM=function(qZ){var bK=Zq();if(bK<1e4&&bK+qZ>=1e4)TM++,BA.drawMap();if(bK+=qZ,gw(bK),!Yl)if(bK>EG())ri(bK)},Zq=function(){return yB[xu()]},gw=function(qZ){yB[xu()]=qZ},EG=function(){return IY[xu()]},ri=function(qZ){IY[xu()]=qZ,kS()},wL=function(){var qZ,bK,cx;if(localStorage&&localStorage.highScores)for(qZ=JSON.parse(localStorage.highScores),bK=qZ.length,cx=0;cx<bK;cx++)IY[cx]=Math.max(IY[cx],qZ[cx])},kS=function(){if(localStorage)localStorage.highScores=JSON.stringify(IY)},eI=0,vZ=1,oc=2,mW=3,mr=function(qZ){return-qZ*Math.PI/2},nh=function(qZ){return(qZ+1)%4},vM=function(qZ){return(qZ+3)%4},So=function(qZ){return(qZ+2)%4},kv=function(qZ){if(qZ.x==-1)return vZ;if(qZ.x==1)return mW;if(qZ.y==-1)return eI;if(qZ.y==1)return oc},Pg=function(qZ,bK){if(bK==eI)qZ.x=0,qZ.y=-1;else if(bK==mW)qZ.x=1,qZ.y=0;else if(bK==oc)qZ.x=0,qZ.y=1;else if(bK==vZ)qZ.x=-1,qZ.y=0},lD=function(qZ,bK,cx){var Rr,Lz,wv,Gw=1/0,AA={},pF=0,gO;for(gO=0;gO<4;gO++)if(cx[gO])if(Pg(AA,gO),Rr=AA.x+qZ.x-bK.x,Lz=AA.y+qZ.y-bK.y,wv=Rr*Rr+Lz*Lz,wv<Gw)Gw=wv,pF=gO;return pF},ak=function(qZ,bK){var cx={};cx[eI]=Rj.isFloorTile(qZ.x,qZ.y-1),cx[mW]=Rj.isFloorTile(qZ.x+1,qZ.y),cx[oc]=Rj.isFloorTile(qZ.x,qZ.y+1),cx[vZ]=Rj.isFloorTile(qZ.x-1,qZ.y);var Rr=0,Lz;if(bK!=void 0){for(Lz=0;Lz<4;Lz++)if(cx[Lz])Rr++;var wv=So(bK);if(Rr>1)cx[wv]=false}return cx},pe=function(qZ,bK){return Rj.isFloorTile(qZ.x+bK.x,qZ.y+bK.y)},jn=8,Hp={x:3,y:4},Lm=function(qZ,bK,cx){this.numCols=qZ,this.numRows=bK,this.numTiles=qZ*bK,this.widthPixels=qZ*jn,this.heightPixels=bK*jn,this.tiles=cx,this.doorTile={x:13,y:14},this.doorPixel={x:(this.doorTile.x+1)*jn-1,y:this.doorTile.y*jn+Hp.y},this.homeTopPixel=17*jn,this.homeBottomPixel=18*jn,this.timeEaten={},this.resetCurrent(),this.parseDots(),this.parseTunnels(),this.parseWalls()},qT,jm;function CX(qZ,bK,cx){qZ/=255,bK/=255,cx/=255;var Rr=Math.max(qZ,bK,cx),Lz=Math.min(qZ,bK,cx),wv,Gw,AA=(Rr+Lz)/2;if(Rr==Lz)wv=Gw=0;else{var pF=Rr-Lz;switch(Gw=AA>.5?pF/(2-Rr-Lz):pF/(Rr+Lz),Rr){case qZ:wv=(bK-cx)/pF+(bK<cx?6:0);break;case bK:wv=(cx-qZ)/pF+2;break;case cx:wv=(qZ-bK)/pF+4;break}wv/=6}return[wv,Gw,AA]}function Qm(qZ,bK,cx){var Rr,Lz,wv;if(bK==0)Rr=Lz=wv=cx;else{function Gw(qZ,bK,cx){if(cx<0)cx+=1;if(cx>1)cx-=1;if(cx<1/6)return qZ+(bK-qZ)*6*cx;if(cx<1/2)return bK;if(cx<2/3)return qZ+(bK-qZ)*(2/3-cx)*6;return qZ}var AA=cx<.5?cx*(1+bK):cx+bK-cx*bK,pF=2*cx-AA;Rr=Gw(pF,AA,qZ+1/3),Lz=Gw(pF,AA,qZ),wv=Gw(pF,AA,qZ-1/3)}return Rr*=255,Lz*=255,wv*=255,[Rr,Lz,wv]}function vG(qZ,bK,cx){qZ/=255,bK/=255,cx/=255;var Rr=Math.max(qZ,bK,cx),Lz=Math.min(qZ,bK,cx),wv,Gw,AA=Rr,pF=Rr-Lz;if(Gw=Rr==0?0:pF/Rr,Rr==Lz)wv=0;else{switch(Rr){case qZ:wv=(bK-cx)/pF+(bK<cx?6:0);break;case bK:wv=(cx-qZ)/pF+2;break;case cx:wv=(qZ-bK)/pF+4;break}wv/=6}return[wv,Gw,AA]}function uK(qZ,bK,cx){var Rr,Lz,wv,Gw=Math.floor(qZ*6),AA=qZ*6-Gw,pF=cx*(1-bK),gO=cx*(1-AA*bK),qN=cx*(1-(1-AA)*bK);switch(Gw%6){case 0:Rr=cx,Lz=qN,wv=pF;break;case 1:Rr=gO,Lz=cx,wv=pF;break;case 2:Rr=pF,Lz=cx,wv=qN;break;case 3:Rr=pF,Lz=gO,wv=cx;break;case 4:Rr=qN,Lz=pF,wv=cx;break;case 5:Rr=cx,Lz=pF,wv=gO;break}return Rr*=255,Lz*=255,wv*=255,[Rr,Lz,wv]}function wk(qZ){var bK=Math.floor(qZ[0]),cx=Math.floor(qZ[1]),Rr=Math.floor(qZ[2]);return"rgb("+bK+","+cx+","+Rr+")"}Lm.prototype.save=function(qZ){},Lm.prototype.eraseFuture=function(qZ){var bK;for(bK=0;bK<this.numTiles;bK++)if(qZ<=this.timeEaten[bK])delete this.timeEaten[bK]},Lm.prototype.load=function(qZ,bK){var cx,Rr,Lz=function(qZ){var bK,cx;bK=qZ%this.numCols,cx=Math.floor(qZ/this.numCols),BA.refreshPellet(bK,cx)},wv;for(wv=0;wv<this.numTiles;wv++)if(cx=this.startTiles[wv],cx=="."||cx=="o")if(bK<=this.timeEaten[wv]){if(this.currentTiles[wv]!=cx)this.dotsEaten--,this.currentTiles[wv]=cx,Lz.call(this,wv)}else if(bK>this.timeEaten[wv])if(this.currentTiles[wv]!=" ")this.dotsEaten++,this.currentTiles[wv]=" ",Lz.call(this,wv)},Lm.prototype.resetTimeEaten=function(){this.startTiles=this.currentTiles.slice(0),this.timeEaten={}},Lm.prototype.resetCurrent=function(){this.currentTiles=this.tiles.split(""),this.dotsEaten=0},Lm.prototype.parseWalls=function(){var qZ=this;this.paths=[];var bK={},cx=function(bK,cx){if(bK>=-2&&bK<qZ.numCols+2&&cx>=0&&cx<qZ.numRows)return bK+2+cx*(qZ.numCols+4)},Rr={},Lz=0,wv,Gw;for(Gw=0;Gw<this.numRows;Gw++)for(wv=-2;wv<this.numCols+2;wv++,Lz++)if(this.getTile(wv,Gw)=="|"&&(this.getTile(wv-1,Gw)!="|"||this.getTile(wv+1,Gw)!="|"||this.getTile(wv,Gw-1)!="|"||this.getTile(wv,Gw+1)!="|"||this.getTile(wv-1,Gw-1)!="|"||this.getTile(wv-1,Gw+1)!="|"||this.getTile(wv+1,Gw-1)!="|"||this.getTile(wv+1,Gw+1)!="|"))Rr[Lz]=true;var AA=function(Lz,wv){var Gw={},AA;if(cx(Lz+1,wv)in Rr)AA=mW;else if(cx(Lz,wv+1)in Rr)AA=oc;else throw"tile shouldn't be 1x1 at "+Lz+","+wv;Pg(Gw,AA),Lz+=Gw.x,wv+=Gw.y;var pF=Lz,gO=wv,qN=AA,Yl=[],ao,De,TS,ty,qK,SW=function(bK,Lz,wv){var Gw={};if(Pg(Gw,wv),!(cx(bK+Gw.y,Lz-Gw.x)in Rr))ao=qZ.isFloorTile(bK+Gw.y,Lz-Gw.x)?5:0;var AA=-jn/2+ao,pF=jn/2,gO=mr(wv),qN=Math.cos(gO),Yl=Math.sin(gO);return{x:AA*qN-pF*Yl+(bK+.5)*jn,y:AA*Yl+pF*qN+(Lz+.5)*jn}};while(true){if(bK[cx(Lz,wv)]=true,De=SW(Lz,wv,AA),ty)if(TS=Yl[Yl.length-1],Gw.x==0)De.cx=De.x,De.cy=TS.y;else De.cx=TS.x,De.cy=De.y;if(ty=false,qK=false,cx(Lz+Gw.y,wv-Gw.x)in Rr)AA=nh(AA),ty=true;else if(cx(Lz+Gw.x,wv+Gw.y)in Rr);else if(cx(Lz-Gw.y,wv+Gw.x)in Rr)AA=vM(AA),ty=true;else AA=So(AA),qK=true;if(Pg(Gw,AA),Yl.push(De),qK)Yl.push(SW(Lz-Gw.x,wv-Gw.y,So(AA))),Yl.push(SW(Lz,wv,AA));if(Lz+=Gw.x,wv+=Gw.y,Lz==pF&&wv==gO&&AA==qN){qZ.paths.push(Yl);break}}};for(Lz=0,Gw=0;Gw<this.numRows;Gw++)for(wv=-2;wv<this.numCols+2;wv++,Lz++)if(Lz in Rr&&!(Lz in bK))bK[Lz]=true,AA(wv,Gw)},Lm.prototype.parseDots=function(){var qZ,bK;this.numDots=0,this.numEnergizers=0,this.energizers=[];var cx=0,Rr;for(bK=0;bK<this.numRows;bK++)for(qZ=0;qZ<this.numCols;qZ++){if(Rr=this.tiles[cx],Rr==".")this.numDots++;else if(Rr=="o")this.numDots++,this.numEnergizers++,this.energizers.push({x:qZ,y:bK});cx++}},Lm.prototype.dotsLeft=function(){return this.numDots-this.dotsEaten},Lm.prototype.allDotsEaten=function(){return this.dotsLeft()==0},Lm.prototype.parseTunnels=(qT=function(qZ,bK,cx){while(!this.isFloorTile(qZ,bK-1)&&!this.isFloorTile(qZ,bK+1)&&this.isFloorTile(qZ,bK))qZ+=cx;return qZ},jm=2,function(){var qZ,bK,cx,Rr;for(this.tunnelRows={},qZ=0;qZ<this.numRows;qZ++)if(this.isFloorTile(0,qZ)&&this.isFloorTile(this.numCols-1,qZ))this.tunnelRows[qZ]={leftEntrance:qT.call(this,0,qZ,1),rightEntrance:qT.call(this,this.numCols-1,qZ,-1),leftExit:-jm*jn,rightExit:(this.numCols+jm)*jn-1}}),Lm.prototype.teleport=function(qZ){var bK,cx=this.tunnelRows[qZ.tile.y];if(cx)if(qZ.pixel.x<cx.leftExit)qZ.pixel.x=cx.rightExit;else if(qZ.pixel.x>cx.rightExit)qZ.pixel.x=cx.leftExit},Lm.prototype.posToIndex=function(qZ,bK){if(qZ>=0&&qZ<this.numCols&&bK>=0&&bK<this.numRows)return qZ+bK*this.numCols},Lm.prototype.isTunnelTile=function(qZ,bK){var cx=this.tunnelRows[bK];return cx&&(qZ<cx.leftEntrance||qZ>cx.rightEntrance)},Lm.prototype.getTile=function(qZ,bK){if(qZ>=0&&qZ<this.numCols&&bK>=0&&bK<this.numRows)return this.currentTiles[this.posToIndex(qZ,bK)];if((qZ<0||qZ>=this.numCols)&&(this.isTunnelTile(qZ,bK-1)||this.isTunnelTile(qZ,bK+1)))return"|";if(this.isTunnelTile(qZ,bK))return" "},Lm.prototype.isFloorTileChar=function(qZ){return qZ==" "||qZ=="."||qZ=="o"},Lm.prototype.isFloorTile=function(qZ,bK){return this.isFloorTileChar(this.getTile(qZ,bK))},Lm.prototype.onDotEat=function(qZ,bK){this.dotsEaten++;var cx=this.posToIndex(qZ,bK);this.currentTiles[cx]=" ",this.timeEaten[cx]=Gg.getTime(),BA.erasePellet(qZ,bK)};var Wd=(sX=function(qZ){var bK=qZ.length,cx,Rr,Lz;for(cx=0;cx<bK;cx++)Rr=Gw(0,bK-1),Lz=qZ[cx],qZ[cx]=qZ[Rr],qZ[Rr]=Lz},Nm=function(qZ){var bK=qZ.length;if(bK>0)return qZ[Gw(0,bK-1)]},Sg=0,QX=1,Bz=2,DJ=3,hS=[],xF=[],LX=[],PR=9,Tg=5,Wu=function(){var qZ,bK;for(qZ=0;qZ<PR*Tg;qZ++)hS[qZ]={x:qZ%Tg,y:Math.floor(qZ/Tg),filled:false,connect:[false,false,false,false],next:[],no:void 0,group:void 0};for(qZ=0;qZ<PR*Tg;qZ++){var bK=hS[qZ];if(bK.x>0)bK.next[DJ]=hS[qZ-1];if(bK.x<Tg-1)bK.next[QX]=hS[qZ+1];if(bK.y>0)bK.next[Sg]=hS[qZ-Tg];if(bK.y<PR-1)bK.next[Bz]=hS[qZ+Tg]}qZ=3*Tg,bK=hS[qZ],bK.filled=true,bK.connect[DJ]=bK.connect[QX]=bK.connect[Bz]=true,qZ++,bK=hS[qZ],bK.filled=true,bK.connect[DJ]=bK.connect[Bz]=true,qZ+=Tg-1,bK=hS[qZ],bK.filled=true,bK.connect[DJ]=bK.connect[Sg]=bK.connect[QX]=true,qZ++,bK=hS[qZ],bK.filled=true,bK.connect[Sg]=bK.connect[DJ]=true},HH=function(){var qZ=function(){var qZ,bK=[];for(qZ=0;qZ<Tg;qZ++){for(y=0;y<PR;y++){var cx=hS[qZ+y*Tg];if(!cx.filled)bK.push(cx)}if(bK.length>0)break}return bK},bK=function(qZ,bK,cx,Rr){if(qZ.y==6&&qZ.x==0&&bK==Bz||qZ.y==7&&qZ.x==0&&bK==Sg)return false;if(Rr==2&&(bK==cx||So(bK)==cx))return false;if(qZ.next[bK]&&!qZ.next[bK].filled)if(qZ.next[bK].next[DJ]&&!qZ.next[bK].next[DJ].filled);else return true;return false},cx=function(qZ,cx,Rr){var Lz=[],wv=0;for(i=0;i<4;i++)if(bK(qZ,i,cx,Rr))Lz.push(i),wv++;return{openCells:Lz,numOpenCells:wv}},Rr=function(qZ,bK){if(qZ.connect[bK]=true,qZ.next[bK].connect[So(bK)]=true,qZ.x==0&&bK==QX)qZ.connect[DJ]=true},Lz=function(){var Lz,AA,pF,gO,qN,Yl,ao,De=0,TS,ty,qK=[0,0,.1,.5,.75,1],SW={};SW[0]=SW[PR-1]=0;var xk=.35,yH=0,Jz=1,eT=1,Gs=.5,Rg=function(qZ){qZ.filled=true,qZ.no=De++,qZ.group=TS};for(TS=0;;TS++){if(gO=qZ(),qN=gO.length,qN==0)break;if(pF=Lz=gO[Gw(0,qN-1)],Rg(Lz),Lz.x<Tg-1&&Lz.y in SW&&Math.random()<=xk)if(SW[Lz.y]==0){Lz.connect[Lz.y==0?Sg:Bz]=true,SW[Lz.y]++;continue}if(ty=1,Lz.x==Tg-1)Lz.connect[QX]=true,Lz.isRaiseHeightCandidate=true;else while(ty<5){var qy=false;if(ty==2){var TM=pF;if(TM.x>0&&TM.connect[QX]&&TM.next[QX]&&TM.next[QX].next[QX])if(yH<Jz&&Math.random()<=eT){TM=TM.next[QX].next[QX];var pg={};if(bK(TM,Sg))pg[Sg]=true;if(bK(TM,Bz))pg[Bz]=true;if(pg[Sg]&&pg[Bz])ao=[Sg,Bz][Gw(0,1)];else if(pg[Sg])ao=Sg;else if(pg[Bz])ao=Bz;else ao=void 0;if(ao!=void 0)Rr(TM,DJ),Rg(TM),Rr(TM,ao),Rg(TM.next[ao]),yH++,ty+=2,qy=true}}if(!qy){var IF=cx(Lz,Yl,ty);if(gO=IF["openCells"],qN=IF["numOpenCells"],qN==0&&ty==2)Lz=AA,IF=cx(Lz,Yl,ty),gO=IF["openCells"],qN=IF["numOpenCells"];if(qN==0)qy=true;else{if(Yl=gO[Gw(0,qN-1)],AA=Lz.next[Yl],Rr(Lz,Yl),Rg(AA),ty++,pF.x==0&&ty==3)qy=true;if(Math.random()<=qK[ty])qy=true}}if(qy){if(ty==1);else if(ty==2){var TM=pF;if(TM.x==Tg-1){if(TM.connect[Sg])TM=TM.next[Sg];TM.connect[QX]=TM.next[Bz].connect[QX]=true}}else if(ty==3||ty==4)if(yH<Jz&&pF.x>0&&Math.random()<=Gs){var pg=[],SO=0;for(ao=0;ao<4;ao++)if(Lz.connect[ao]&&bK(Lz.next[ao],ao))pg.push(ao),SO++;if(SO>0)ao=pg[Gw(0,SO-1)],TM=Lz.next[ao],Rr(TM,ao),Rg(TM.next[ao]),yH++}break}}}wv()},wv=function(){var qZ,bK,cx,Rr,Lz,wv,Gw;for(qZ=0;qZ<PR*Tg;qZ++){if(bK=hS[qZ],wv=qZ%Tg,Gw=Math.floor(qZ/Tg),cx=bK.connect,(bK.x==0||!cx[DJ])&&(bK.x==Tg-1||!cx[QX])&&cx[Sg]!=cx[Bz])bK.isRaiseHeightCandidate=true;if(Rr=bK.next[QX],Rr!=void 0)if(Lz=Rr.connect,(bK.x==0||!cx[DJ])&&!cx[Sg]&&!cx[Bz]&&(Rr.x==Tg-1||!Lz[QX])&&!Lz[Sg]&&!Lz[Bz])bK.isRaiseHeightCandidate=Rr.isRaiseHeightCandidate=true;if(bK.x==Tg-1&&cx[QX])bK.isShrinkWidthCandidate=true;if((bK.y==0||!cx[Sg])&&(bK.y==PR-1||!cx[Bz])&&cx[DJ]!=cx[QX])bK.isShrinkWidthCandidate=true}},AA=function(qZ){return qZ.connect[Sg]&&qZ.connect[QX]&&qZ.connect[Bz]&&qZ.connect[DJ]},pF=function(){var qZ=function(bK,cx){if(cx==PR-1)return true;var Rr,Lz,wv;for(Rr=bK;Rr<Tg;Rr++)if(Lz=hS[Rr+cx*Tg],wv=Lz.next[Bz],(!Lz.connect[QX]||AA(Lz))&&(!wv.connect[QX]||AA(wv)))break;for(var Gw=[],pF=0,gO;wv;wv=wv.next[DJ]){if(wv.isShrinkWidthCandidate)Gw.push(wv),pF++;if((!wv.connect[DJ]||AA(wv))&&(!wv.next[Sg].connect[DJ]||AA(wv.next[Sg])))break}for(sX(Gw),gO=0;gO<pF;gO++)if(wv=Gw[gO],qZ(wv.x,wv.y))return wv.shrinkWidth=true,LX[wv.y]=wv.x,true;return false},bK,cx;for(bK=Tg-1;bK>=0;bK--)if(cx=hS[bK],cx.isShrinkWidthCandidate&&qZ(bK,0))return cx.shrinkWidth=true,LX[cx.y]=cx.x,true;return false},gO=function(){var qZ=function(bK,cx){if(bK==Tg-1)return true;var Rr,Lz,wv;for(Rr=cx;Rr>=0;Rr--)if(Lz=hS[bK+Rr*Tg],wv=Lz.next[QX],(!Lz.connect[Sg]||AA(Lz))&&(!wv.connect[Sg]||AA(wv)))break;for(var Gw=[],pF=0,gO;wv;wv=wv.next[Bz]){if(wv.isRaiseHeightCandidate)Gw.push(wv),pF++;if((!wv.connect[Bz]||AA(wv))&&(!wv.next[DJ].connect[Bz]||AA(wv.next[DJ])))break}for(sX(Gw),gO=0;gO<pF;gO++)if(wv=Gw[gO],qZ(wv.x,wv.y))return wv.raiseHeight=true,xF[wv.x]=wv.y,true;return false},bK,cx;for(bK=0;bK<3;bK++)if(cx=hS[bK*Tg],cx.isRaiseHeightCandidate&&qZ(0,bK))return cx.raiseHeight=true,xF[cx.x]=cx.y,true;return false},qN=function(){var qZ=hS[4];if(qZ.connect[Sg]||qZ.connect[QX])return false;if(qZ=hS[PR*Tg-1],qZ.connect[Bz]||qZ.connect[QX])return false;var bK=function(qZ,bK){var cx=hS[qZ+bK*Tg].connect,Rr=hS[qZ+1+bK*Tg].connect;return!cx[Sg]&&!cx[Bz]&&(qZ==0||!cx[DJ])&&cx[QX]&&!Rr[Sg]&&!Rr[Bz]&&Rr[DJ]&&!Rr[QX]},cx=function(qZ,bK){var cx=hS[qZ+bK*Tg].connect,Rr=hS[qZ+(bK+1)*Tg].connect;if(qZ==Tg-1)return!cx[DJ]&&!cx[Sg]&&!cx[Bz]&&!Rr[DJ]&&!Rr[Sg]&&!Rr[Bz];return!cx[DJ]&&!cx[QX]&&!cx[Sg]&&cx[Bz]&&!Rr[DJ]&&!Rr[QX]&&Rr[Sg]&&!Rr[Bz]},Rr,Lz,wv;for(Lz=0;Lz<PR-1;Lz++)for(Rr=0;Rr<Tg-1;Rr++)if(bK(Rr,Lz)&&bK(Rr,Lz+1)||cx(Rr,Lz)&&cx(Rr+1,Lz)){if(Rr==0)return false;hS[Rr+Lz*Tg].connect[Bz]=true,hS[Rr+Lz*Tg].connect[QX]=true,wv=hS[Rr+Lz*Tg].group,hS[Rr+1+Lz*Tg].connect[Bz]=true,hS[Rr+1+Lz*Tg].connect[DJ]=true,hS[Rr+1+Lz*Tg].group=wv,hS[Rr+(Lz+1)*Tg].connect[Sg]=true,hS[Rr+(Lz+1)*Tg].connect[QX]=true,hS[Rr+(Lz+1)*Tg].group=wv,hS[Rr+1+(Lz+1)*Tg].connect[Sg]=true,hS[Rr+1+(Lz+1)*Tg].connect[DJ]=true,hS[Rr+1+(Lz+1)*Tg].group=wv}if(!gO())return false;if(!pF())return false;return true},Yl=function(){var qZ,bK;for(qZ=0;qZ<PR*Tg;qZ++){if(bK=hS[qZ],bK.final_x=bK.x*3,LX[bK.y]<bK.x)bK.final_x--;if(bK.final_y=bK.y*3,xF[bK.x]<bK.y)bK.final_y++;bK.final_w=bK.shrinkWidth?2:3,bK.final_h=bK.raiseHeight?4:3}},ao=function(qZ,bK){var cx,Rr;for(cx=0;cx<PR*Tg;cx++)if(Rr=hS[cx],Rr.group==qZ)Rr.group=bK},De=function(){var qZ=[],bK=[],cx=[],Rr=[],Lz=[],wv=[],Gw=[],AA=[],pF=[],gO=[],qN=0,Yl,ao,De,TS;for(Yl=0;Yl<PR;Yl++){if(ao=hS[Tg-1+Yl*Tg],ao.connect[Sg])continue;if(ao.y>1&&ao.y<PR-2)if(ao.isEdgeTunnelCandidate=true,Gw.push(ao),ao.y<=2)AA.push(ao);else if(ao.y>=5)pF.push(ao);if(De=!ao.next[Sg]||ao.next[Sg].connect[QX],TS=!ao.next[Bz]||ao.next[Bz].connect[QX],ao.connect[QX]){if(De)if(ao.isVoidTunnelCandidate=true,Rr.push(ao),ao.y<=2)Lz.push(ao);else if(ao.y>=6)wv.push(ao)}else{if(ao.connect[Bz])continue;if(De!=TS){if(!ao.raiseHeight&&Yl<PR-1&&!ao.next[DJ].connect[DJ]){qZ.push(ao),ao.isSingleDeadEndCandidate=true,ao.singleDeadEndDir=De?Sg:Bz;var ty=De?1:0;if(ao.y<=1+ty)bK.push(ao);else if(ao.y>=5+ty)cx.push(ao)}}else if(De&&TS)if(Yl>0&&Yl<PR-1)if(ao.next[DJ].connect[Sg]&&ao.next[DJ].connect[Bz])if(ao.isDoubleDeadEndCandidate=true,ao.y>=2&&ao.y<=5)gO.push(ao)}}var qK=Math.random()<=.45?2:1,ao,SW=function(qZ){if(qZ.connect[QX]=true,qZ.singleDeadEndDir==Sg)qZ.topTunnel=true;else qZ.next[Bz].topTunnel=true},xk,yH;if(qK==1)if(ao=Nm(Rr))ao.topTunnel=true;else if(ao=Nm(qZ))SW(ao);else if(ao=Nm(Gw))ao.topTunnel=true;else return false;else if(qK==2)if(ao=Nm(gO))ao.connect[QX]=true,ao.topTunnel=true,ao.next[Bz].topTunnel=true;else{if(qN=1,ao=Nm(Lz))ao.topTunnel=true;else if(ao=Nm(bK))SW(ao);else if(ao=Nm(AA))ao.topTunnel=true;else qN=0;if(ao=Nm(wv))ao.topTunnel=true;else if(ao=Nm(cx))SW(ao);else if(ao=Nm(pF))ao.topTunnel=true;else if(qN==0)return false}for(Yl=0;Yl<PR;Yl++)if(ao=hS[Tg-1+Yl*Tg],ao.topTunnel){xk=true,yH=ao.final_y;while(ao.next[DJ])if(ao=ao.next[DJ],!ao.connect[Sg]&&ao.final_y==yH)continue;else{xk=false;break}if(xk)return false}var Jz=Rr.length,eT,Gs=function(qZ,bK){var cx,Rr;for(cx=0;cx<PR*Tg;cx++)if(Rr=hS[cx],Rr.group==qZ)Rr.group=bK};for(eT=0;eT<Jz;eT++)if(ao=Rr[eT],!ao.topTunnel)Gs(ao.group,ao.next[Sg].group),ao.connect[Sg]=true,ao.next[Sg].connect[Bz]=true;return true},TS=function(){var qZ,bK,cx,Rr;for(qZ=0;qZ<Tg;qZ++)if(cx=hS[qZ],!cx.connect[DJ]&&!cx.connect[QX]&&!cx.connect[Sg]&&(!cx.connect[Bz]||!cx.next[Bz].connect[Bz]))if((!cx.next[DJ]||!cx.next[DJ].connect[Sg])&&cx.next[QX]&&!cx.next[QX].connect[Sg])if(!(cx.next[Bz]&&cx.next[Bz].connect[QX]&&cx.next[Bz].next[QX].connect[QX]))if(cx.isJoinCandidate=true,Math.random()<=.25)cx.connect[Sg]=true;for(qZ=0;qZ<Tg;qZ++)if(cx=hS[qZ+(PR-1)*Tg],!cx.connect[DJ]&&!cx.connect[QX]&&!cx.connect[Bz]&&(!cx.connect[Sg]||!cx.next[Sg].connect[Sg]))if((!cx.next[DJ]||!cx.next[DJ].connect[Bz])&&cx.next[QX]&&!cx.next[QX].connect[Bz])if(!(cx.next[Sg]&&cx.next[Sg].connect[QX]&&cx.next[Sg].next[QX].connect[QX]))if(cx.isJoinCandidate=true,Math.random()<=.25)cx.connect[Bz]=true;for(bK=1;bK<PR-1;bK++){if(cx=hS[Tg-1+bK*Tg],cx.raiseHeight)continue;if(!cx.connect[QX]&&!cx.connect[Sg]&&!cx.connect[Bz]&&!cx.next[Sg].connect[QX]&&!cx.next[Bz].connect[QX])if(cx.connect[DJ])if(Rr=cx.next[DJ],!Rr.connect[Sg]&&!Rr.connect[Bz]&&!Rr.connect[DJ])if(cx.isJoinCandidate=true,Math.random()<=.5)cx.connect[QX]=true}},ty=0;while(true){if(Wu(),Lz(),ty++,!qN())continue;if(Yl(),TS(),!De())continue;break}},ai=function(){var qZ=[],bK=[],cx=PR*3+1+3,Rr=Tg*3-1+2,Lz=Rr-2,wv=(Rr-2)*2,AA=function(bK,Gw,AA){if(bK<0||bK>Rr-1||Gw<0||Gw>cx-1)return;bK-=2,qZ[Lz+bK+Gw*wv]=AA,qZ[Lz-1-bK+Gw*wv]=AA},pF=function(bK,Gw){if(bK<0||bK>Rr-1||Gw<0||Gw>cx-1)return;return bK-=2,qZ[Lz+bK+Gw*wv]},gO=function(qZ,Lz,wv){if(qZ<0||qZ>Rr-1||Lz<0||Lz>cx-1)return;qZ-=2,bK[qZ+Lz*Rr]=wv},qN=function(qZ,Lz){if(qZ<0||qZ>Rr-1||Lz<0||Lz>cx-1)return;return qZ-=2,bK[qZ+Lz*Rr]},Yl,ao,De,TS,ty,qK,SW,xk,yH,Jz,TS;for(Yl=0;Yl<cx*wv;Yl++)qZ.push("_");for(Yl=0;Yl<cx*Rr;Yl++)bK.push(void 0);for(Yl=0;Yl<PR*Tg;Yl++)for(ao=hS[Yl],SW=0;SW<ao.final_w;SW++)for(xk=0;xk<ao.final_h;xk++)gO(ao.final_x+SW,ao.final_y+1+xk,ao);for(TS=0;TS<cx;TS++)for(De=0;De<Rr;De++){if(ao=qN(De,TS),yH=qN(De-1,TS),Jz=qN(De,TS-1),ao){if(yH&&ao.group!=yH.group||Jz&&ao.group!=Jz.group||!Jz&&!ao.connect[Sg])AA(De,TS,".")}else if(yH&&(!yH.connect[QX]||pF(De-1,TS)==".")||Jz&&(!Jz.connect[Bz]||pF(De,TS-1)=="."))AA(De,TS,".");if(pF(De-1,TS)=="."&&pF(De,TS-1)=="."&&pF(De-1,TS-1)=="_")AA(De,TS,".")}for(ao=hS[Tg-1];ao;ao=ao.next[Bz])if(ao.topTunnel)TS=ao.final_y+1,AA(Rr-1,TS,"."),AA(Rr-2,TS,".");for(TS=0;TS<cx;TS++)for(De=0;De<Rr;De++)if(pF(De,TS)!="."&&(pF(De-1,TS)=="."||pF(De,TS-1)=="."||pF(De+1,TS)=="."||pF(De,TS+1)=="."||pF(De-1,TS-1)=="."||pF(De+1,TS-1)=="."||pF(De+1,TS+1)=="."||pF(De-1,TS+1)=="."))AA(De,TS,"|");AA(2,12,"-");var eT=function(){var qZ,bK=cx/2,Lz=Rr-2,wv;for(wv=2;wv<bK;wv++)if(pF(Lz,wv)=="."&&pF(Lz,wv+1)=="."){qZ=wv+1;break}for(bK=Math.min(bK,qZ+7),wv=qZ+1;wv<bK;wv++)if(pF(Lz-1,wv)=="."){bK=wv-1;break}return{miny:qZ,maxy:bK}},Gs=function(){var qZ=cx/2,bK,Lz=Rr-2,wv;for(wv=cx-3;wv>=qZ;wv--)if(pF(Lz,wv)=="."&&pF(Lz,wv+1)=="."){bK=wv;break}for(qZ=Math.max(qZ,bK-7),wv=bK-1;wv>qZ;wv--)if(pF(Lz-1,wv)=="."){qZ=wv+1;break}return{miny:qZ,maxy:bK}},De=Rr-2,TS,Rg;if(Rg=eT())TS=Gw(Rg.miny,Rg.maxy),AA(De,TS,"o");if(Rg=Gs())TS=Gw(Rg.miny,Rg.maxy),AA(De,TS,"o");var qy=function(qZ,bK){var cx;while(true){if(cx=[],pF(qZ-1,bK)==".")cx.push({x:qZ-1,y:bK});if(pF(qZ+1,bK)==".")cx.push({x:qZ+1,y:bK});if(pF(qZ,bK-1)==".")cx.push({x:qZ,y:bK-1});if(pF(qZ,bK+1)==".")cx.push({x:qZ,y:bK+1});if(cx.length==1)AA(qZ,bK," "),qZ=cx[0].x,bK=cx[0].y;else break}},Yl,TM,TS;for(De=Rr-1,TS=0;TS<cx;TS++)if(pF(De,TS)==".")qy(De,TS);for(AA(1,cx-8," "),Yl=0;Yl<7;Yl++){TS=cx-14,AA(Yl,TS," "),TM=1;while(pF(Yl,TS+TM)=="."&&pF(Yl-1,TS+TM)=="|"&&pF(Yl+1,TS+TM)=="|")AA(Yl,TS+TM," "),TM++;TS=cx-20,AA(Yl,TS," "),TM=1;while(pF(Yl,TS-TM)=="."&&pF(Yl-1,TS-TM)=="|"&&pF(Yl+1,TS-TM)=="|")AA(Yl,TS-TM," "),TM++}for(Yl=0;Yl<7;Yl++){De=6,TS=cx-14-Yl,AA(De,TS," "),TM=1;while(pF(De+TM,TS)=="."&&pF(De+TM,TS-1)=="|"&&pF(De+TM,TS+1)=="|")AA(De+TM,TS," "),TM++}return"____________________________"+"____________________________"+"____________________________"+qZ.join("")+"____________________________"+"____________________________"},Na=function(){return"#"+("00000"+(Math.random()*(1<<24)|0).toString(16)).slice(-6)},py=function(qZ,bK,cx,Rr){var Lz={},wv,Gw,AA,pF;for(Gw=0;Gw<36;Gw++)for(wv=0;wv<28;wv++)if(Rr(wv,Gw)){if(AA=wv+Gw*28,Lz[AA]={x:wv,y:Gw,dist:1/0,penult:void 0,neighbors:[],completed:false},Rr(wv-1,Gw))pF=AA-1,Lz[AA].neighbors.push(Lz[pF]),Lz[pF].neighbors.push(Lz[AA]);if(Rr(wv,Gw-1))pF=AA-28,Lz[AA].neighbors.push(Lz[pF]),Lz[pF].neighbors.push(Lz[AA])}var gO=Lz[bK+cx*28],qN,Yl,ao,De;gO.completed=true,gO.dist=0;while(true){for(AA=0;AA<4;AA++)if(qN=gO.neighbors[AA],qN&&!qN.completed)if(De=gO.dist+1,De==qN.dist){if(Math.random()<.5)qN.penult=gO}else if(De<qN.dist)qN.dist=De,qN.penult=gO;for(Yl=void 0,ao=1/0,AA=0;AA<28*36;AA++)if(qN=Lz[AA],qN&&!qN.completed)if(qN.dist<ao)Yl=qN,ao=qN.dist;if(!Yl)break;gO=Yl,gO.completed=true}return Lz},im=function(qZ){if(!qZ.penult)return;var bK=qZ.x-qZ.penult.x,cx=qZ.y-qZ.penult.y;if(cx==-1)return eI;else if(cx==1)return oc;else if(bK==-1)return vZ;else if(bK==1)return mW},CI=function(qZ){var bK=function(bK,cx){if(bK<0||bK>=28||cx<0||cx>=36)return false;return qZ.isFloorTile(bK,cx)},cx=py(qZ,qZ.doorTile.x,qZ.doorTile.y,bK);qZ.getExitDir=function(qZ,bK){if(qZ<0||qZ>=28||bK<0||bK>=36)return;var Rr=cx[qZ+bK*28],Lz=im(Rr);if(Lz!=void 0)return So(Lz)}},JH=function(){var qZ={v:"^","^":"v","<":">",">":"<"},bK=function(bK){var cx="",Rr;for(Rr=bK.length-1;Rr>=0;Rr--)cx+=qZ[bK[Rr]];return cx},cx={};cx[eI]="^",cx[oc]="v",cx[vZ]="<",cx[mW]=">";var Rr=function(qZ,Rr,Lz,wv,Gw,AA){var pF=qZ[Rr+Lz*28],gO,qN,Yl="",ao;for(ao=qZ[wv+Gw*28];ao!=pF;ao=ao.penult)Yl=cx[im(ao)]+Yl;return AA?bK(Yl):Yl};return function(qZ){paths={entrances:[],exits:[]};var bK=function(bK,cx){if(bK<0||bK>=28||cx<0||cx>=36)return false;return qZ.isFloorTile(bK,cx)};for(enter_graph=py(qZ,15,20,(function(qZ,cx){return qZ==14&&cx==20?false:bK(qZ,cx)})),exit_graph=py(qZ,16,20,(function(qZ,cx){return qZ==17&&cx==20?false:bK(qZ,cx)})),y=0;y<36;y++)if(qZ.isFloorTile(-1,y))paths.entrances.push({start:{y:y*8+4,x:-4},path:">"+Rr(enter_graph,15,20,0,y,true)}),paths.entrances.push({start:{y:y*8+4,x:28*8+4},path:"<"+Rr(enter_graph,15,20,27,y,true)}),paths.exits.push({start:{y:y*8+4,x:-4},path:Rr(exit_graph,16,20,0,y,false)+"<"}),paths.exits.push({start:{y:y*8+4,x:28*8+4},path:Rr(exit_graph,16,20,27,y,false)+">"});qZ.fruitPaths=paths}}(),function(){HH();var qZ=new Lm(28,36,ai());return JH(qZ),CI(qZ),qZ.name="Random Map",qZ.wallFillColor=Na(),qZ.wallStrokeColor=wk(Qm(Math.random(),Math.random(),Math.random()*.4+.6)),qZ.pelletColor="#ffb8ae",qZ}),sX,Nm,Sg,QX,Bz,DJ,hS,xF,LX,PR,Tg,Wu,HH,ai,Na,py,im,CI,JH,PP=function(){var qZ,bK,cx=22,Rr=14,Lz=22,wv=0,Gw=function(){var qZ=document.getElementById("gridcanvas");if(!qZ)return;var bK=cx*Rr*ys,wv=cx*Lz*ys;qZ.width=bK,qZ.height=wv;var Gw=qZ.getContext("2d"),AA,pF;Gw.clearRect(0,0,bK,wv);var gO=cx*ys;for(Gw.beginPath(),AA=0;AA<=bK;AA+=gO)Gw.moveTo(AA,0),Gw.lineTo(AA,wv);for(pF=0;pF<=wv;pF+=gO)Gw.moveTo(0,pF),Gw.lineTo(bK,pF);Gw.lineWidth="1px",Gw.lineCap="square",Gw.strokeStyle="rgba(255,255,255,0.5)",Gw.stroke()},AA=function(){Gw(),qZ=document.getElementById("atlas"),bK=qZ.getContext("2d");var AA=cx*Rr*ys,pF=cx*Lz*ys;if(qZ.width=AA,qZ.height=pF,wv>0)bK.restore();wv++,bK.save(),bK.clearRect(0,0,AA,pF),bK.scale(ys,ys);var gO=function(qZ,bK,Rr){var Lz=Rr*cx+cx/2,wv=bK*cx+cx/2;qZ(Lz,wv)},qN=0;gO((function(qZ,cx){mc(bK,qZ,cx)}),qN,0),gO((function(qZ,cx){SE(bK,qZ,cx)}),qN,1),gO((function(qZ,cx){bf(bK,qZ,cx)}),qN,2),gO((function(qZ,cx){RT(bK,qZ,cx)}),qN,3),gO((function(qZ,cx){wf(bK,qZ,cx)}),qN,4),gO((function(qZ,cx){pi(bK,qZ,cx)}),qN,5),gO((function(qZ,cx){IU(bK,qZ,cx)}),qN,6),gO((function(qZ,cx){iC(bK,qZ,cx)}),qN,7),gO((function(qZ,cx){bW(bK,qZ,cx)}),qN,8),gO((function(qZ,cx){hQ(bK,qZ,cx)}),qN,9),gO((function(qZ,cx){QB(bK,qZ,cx)}),qN,10),gO((function(qZ,cx){MQ(bK,qZ,cx)}),qN,11),gO((function(qZ,cx){WI(bK,qZ,cx)}),qN,12);var Yl=function(qZ,cx){var Rr,Lz,wv=0;for(Rr=0;Rr<4;Rr++)for(Lz=0;Lz<2;Lz++)gO((function(qZ,wv){bg(bK,qZ,wv,Lz,Rr,false,false,false,cx)}),qZ,wv),wv++};qN++,Yl(qN,"#FF0000"),qN++,Yl(qN,"#FFB8FF"),qN++,Yl(qN,"#00FFFF"),qN++,Yl(qN,"#FFB851"),qN++,function(){var qZ,cx=0;for(qZ=0;qZ<4;qZ++)gO((function(cx,Rr){bg(bK,cx,Rr,0,qZ,false,false,true,"#fff")}),qN,cx),cx++}(),gO((function(qZ,cx){bg(bK,qZ,cx,0,eI,true,false,false,"#fff")}),qN,4),gO((function(qZ,cx){bg(bK,qZ,cx,1,eI,true,false,false,"#fff")}),qN,5),gO((function(qZ,cx){bg(bK,qZ,cx,0,eI,true,true,false,"#fff")}),qN,6),gO((function(qZ,cx){bg(bK,qZ,cx,1,eI,true,true,false,"#fff")}),qN,7);var ao=function(qZ,cx,Rr){gO((function(qZ,cx){Rs(bK,qZ,cx,Rr,Math.PI/6)}),qZ,cx),gO((function(qZ,cx){Rs(bK,qZ,cx,Rr,Math.PI/3)}),qZ,cx+1)};qN++,gO((function(qZ,cx){Rs(bK,qZ,cx,mW,0)}),qN,0),function(){var qZ,bK=1;for(qZ=0;qZ<4;qZ++)ao(qN,bK,qZ),bK+=2}();var De=function(qZ,cx,Rr){gO((function(qZ,cx){ud(bK,qZ,cx,Rr,0)}),qZ,cx),gO((function(qZ,cx){ud(bK,qZ,cx,Rr,1)}),qZ,cx+1),gO((function(qZ,cx){ud(bK,qZ,cx,Rr,2)}),qZ,cx+2)};qN++,function(){var qZ,bK=0;for(qZ=0;qZ<4;qZ++)De(qN,bK,qZ),bK+=3}();var TS=function(qZ,cx,Rr){gO((function(qZ,cx){Ly(bK,qZ,cx,Rr,0,true)}),qZ,cx),gO((function(qZ,cx){Ly(bK,qZ,cx,Rr,1,true)}),qZ,cx+1),gO((function(qZ,cx){Ly(bK,qZ,cx,Rr,2,true)}),qZ,cx+2)};qN++,function(){var qZ,bK=0;for(qZ=0;qZ<4;qZ++)TS(qN,bK,qZ),bK+=3}();var ty=function(qZ,cx){var Rr,Lz,wv=0;for(Rr=0;Rr<4;Rr++)for(Lz=0;Lz<2;Lz++)gO((function(qZ,wv){tx(bK,qZ,wv,Lz,Rr,false,false,false,cx)}),qZ,wv),wv++};qN++,ty(qN,"#FF0000"),qN++,ty(qN,"#FFB8FF"),qN++,ty(qN,"#00FFFF"),qN++,ty(qN,"#FFB851"),qN++,function(){var qZ,cx=0;for(qZ=0;qZ<4;qZ++)gO((function(cx,Rr){tx(bK,cx,Rr,0,qZ,false,false,true,"#fff")}),qN,cx),cx++}(),gO((function(qZ,cx){tx(bK,qZ,cx,0,eI,true,false,false,"#fff")}),qN,4),gO((function(qZ,cx){tx(bK,qZ,cx,1,eI,true,false,false,"#fff")}),qN,5),gO((function(qZ,cx){tx(bK,qZ,cx,0,eI,true,true,false,"#fff")}),qN,6),gO((function(qZ,cx){tx(bK,qZ,cx,1,eI,true,true,false,"#fff")}),qN,7);var qK=function(qZ,cx,Rr){var Lz;for(Lz=0;Lz<4;Lz++)gO((function(qZ,cx){HL(bK,qZ,cx,Rr,Lz)}),qZ,cx),cx++};qN++,qK(qN,0,eI),qK(qN,4,mW),qN++,qK(qN,0,oc),qK(qN,4,vZ),qN++,gO((function(qZ,cx){mg(bK,qZ,cx,200,"#33ffff")}),qN,0),gO((function(qZ,cx){mg(bK,qZ,cx,400,"#33ffff")}),qN,1),gO((function(qZ,cx){mg(bK,qZ,cx,800,"#33ffff")}),qN,2),gO((function(qZ,cx){mg(bK,qZ,cx,1600,"#33ffff")}),qN,3),gO((function(qZ,cx){mg(bK,qZ,cx,100,"#ffb8ff")}),qN,4),gO((function(qZ,cx){mg(bK,qZ,cx,300,"#ffb8ff")}),qN,5),gO((function(qZ,cx){mg(bK,qZ,cx,500,"#ffb8ff")}),qN,6),gO((function(qZ,cx){mg(bK,qZ,cx,700,"#ffb8ff")}),qN,7),gO((function(qZ,cx){mg(bK,qZ,cx,1e3,"#ffb8ff")}),qN,8),gO((function(qZ,cx){mg(bK,qZ,cx,2e3,"#ffb8ff")}),qN,9),gO((function(qZ,cx){mg(bK,qZ,cx,3e3,"#ffb8ff")}),qN,10),gO((function(qZ,cx){mg(bK,qZ,cx,5e3,"#ffb8ff")}),qN,11),qN++,gO((function(qZ,cx){Fu(bK,qZ,cx,100,"#fff")}),qN,0),gO((function(qZ,cx){Fu(bK,qZ,cx,200,"#fff")}),qN,1),gO((function(qZ,cx){Fu(bK,qZ,cx,500,"#fff")}),qN,2),gO((function(qZ,cx){Fu(bK,qZ,cx,700,"#fff")}),qN,3),gO((function(qZ,cx){Fu(bK,qZ,cx,1e3,"#fff")}),qN,4),gO((function(qZ,cx){Fu(bK,qZ,cx,2e3,"#fff")}),qN,5),gO((function(qZ,cx){Fu(bK,qZ,cx,5e3,"#fff")}),qN,6),qN++,gO((function(qZ,cx){BH(bK,qZ,cx,"#0ff")}),qN,0),gO((function(qZ,cx){BH(bK,qZ,cx,"#FFF")}),qN,1);var SW=function(qZ,cx,Rr){var Lz;for(Lz=0;Lz<4;Lz++)gO((function(qZ,cx){XK(bK,qZ,cx,Rr,Lz)}),qZ,cx),cx++};qN++,SW(qN,0,eI),SW(qN,4,mW),qN++,SW(qN,0,oc),SW(qN,4,vZ)},pF=function(bK,Rr,Lz,wv,Gw,AA){var pF=Rr*cx*ys,gO=bK*cx*ys,qN=ys*cx,Yl=ys*cx,ao=wv-cx/2,De=Gw-cx/2,TS=cx,ty=cx;if(AA);Lz.drawImage(qZ,pF,gO,qN,Yl,ao,De,TS,ty)},gO=function(qZ,bK,cx,Rr){var Lz=16,wv={200:0,400:1,800:2,1600:3}[Rr];if(wv!=void 0)pF(Lz,wv,qZ,bK,cx)},qN=function(qZ,bK,cx,Rr){var Lz=16,wv={100:4,300:5,500:6,700:7,1e3:8,2e3:9,3e3:10,5e3:11}[Rr];if(wv!=void 0)pF(Lz,wv,qZ,bK,cx)},Yl=function(qZ,bK,cx,Rr){var Lz=17,wv={100:0,200:1,500:2,700:3,1e3:4,2e3:5,5e3:6}[Rr];if(wv!=void 0)pF(Lz,wv,qZ,bK,cx)},ao=function(qZ,bK,cx,Rr,Lz,wv,Gw,AA,gO){var qN,Yl;if(AA)qN=5,Yl=Lz;else if(wv)qN=5,Yl=Gw?6:4,Yl+=Rr;else if(Yl=Lz*2+Rr,gO==eP.color)qN=1;else if(gO==QQ.color)qN=2;else if(gO==eD.color)qN=3;else if(gO==UK.color)qN=4;else qN=5;pF(qN,Yl,qZ,bK,cx)},De=function(qZ,bK,cx,Rr,Lz,wv,Gw,AA,pF){if(wv)if(Gw)eT(qZ,bK,cx,"cookieface");else eT(qZ,bK,cx,"cookie");else ao(qZ,bK,cx,Rr,Lz,wv,Gw,AA,pF)},TS=function(qZ,bK,cx,Rr,Lz,wv,Gw,AA,gO){var qN,Yl;if(AA)qN=13,Yl=Lz;else if(wv)qN=13,Yl=Gw?6:4,Yl+=Rr;else if(Yl=Lz*2+Rr,gO==eP.color)qN=9;else if(gO==QQ.color)qN=10;else if(gO==eD.color)qN=11;else if(gO==UK.color)qN=12;else qN=13;pF(qN,Yl,qZ,bK,cx)},ty=function(qZ,bK,cx,Rr,Lz){var wv,Gw;if(Rr==eI)wv=Lz,Gw=14;else if(Rr==mW)wv=Lz+4,Gw=14;else if(Rr==oc)wv=Lz,Gw=15;else if(Rr==vZ)wv=Lz+4,Gw=15;pF(Gw,wv,qZ,bK,cx)},qK=function(qZ,bK,cx,Rr,Lz){var wv,Gw;if(Rr==eI)wv=Lz,Gw=19;else if(Rr==mW)wv=Lz+4,Gw=19;else if(Rr==oc)wv=Lz,Gw=20;else if(Rr==vZ)wv=Lz+4,Gw=20;pF(Gw,wv,qZ,bK,cx)},SW=function(qZ,bK,cx,Rr){var Lz=18,wv=Rr;pF(Lz,wv,qZ,bK,cx)},xk=function(qZ,bK,cx,Rr,Lz){var wv=6,Gw;if(Lz==0)Gw=0;else Gw=Rr*2+1+(Lz-1);pF(wv,Gw,qZ,bK,cx)},yH=function(qZ,bK,cx,Rr,Lz){var wv=7,Gw=Rr*3+Lz;pF(wv,Gw,qZ,bK,cx)},Jz=function(qZ,bK,cx,Rr,Lz){var wv=8,Gw=Rr*3+Lz;pF(wv,Gw,qZ,bK,cx)},eT=function(qZ,bK,cx,Rr){var Lz=0,wv={cherry:0,strawberry:1,orange:2,apple:3,melon:4,galaxian:5,bell:6,key:7,pretzel:8,pear:9,banana:10,cookie:11,cookieface:12}[Rr];pF(Lz,wv,qZ,bK,cx)};return{create:AA,getCanvas:function(){return qZ},drawGhostSprite:ao,drawMonsterSprite:TS,drawMuppetSprite:De,drawOttoSprite:ty,drawMsOttoSprite:qK,drawPacmanSprite:xk,drawMsPacmanSprite:yH,drawCookiemanSprite:Jz,drawFruitSprite:eT,drawGhostPoints:gO,drawPacFruitPoints:qN,drawMsPacFruitPoints:Yl,drawSnail:SW}}(),mx,BA,ys,Ne=4*jn,H=jn/8,oP=28*jn+H*2,Ab=36*jn+H*2,JQ=oP+Ne*2,RY=Ab+Ne*2,gm,CD=function(qZ){BA=mx[qZ],BA.drawMap()},VO=function(){return 1;if(window.innerWidth<=320)return window.devicePixelRatio||1;return 1},Sn=function(){var cx,Rr,Lz,wv=2;ys=wv;var Gw=0,ao=function(){gm.width=JQ*wv,gm.height=RY*wv;var qZ=1;if(gm.style.width=gm.width/qZ,gm.style.height=gm.height/qZ,Gw>0)Rr.restore();if(Rr.save(),Rr.scale(wv,wv),cx.width=oP*wv,cx.height=Ab*wv,Gw>0)Lz.restore();Lz.save(),Lz.scale(wv,wv),Gw++},TS=function(){var qZ=(window.innerWidth-10)/JQ,bK=(window.innerHeight-10)/RY,cx=Math.min(qZ,bK);return cx*=1,cx},ty=function(){if(ys=wv=TS(),ao(),PP.create(),BA)BA.drawMap();qK()},qK=function(){var qZ=TS()/1,bK=JQ*qZ,cx=Math.max(0,(window.innerWidth-10)/2-bK/2),Rr=0;document.body.style.marginLeft=(window.innerWidth-bK)/2+"px"},SW;gm=document.getElementById("canvas"),cx=document.createElement("canvas"),Rr=gm.getContext("2d"),Lz=cx.getContext("2d"),ty(),window.addEventListener("resize",(function(){clearTimeout(SW),SW=setTimeout(ty,100)}),false);var xk=function(){Lz.fillStyle="#000",Lz.fillRect(0,0,oP,Ab),Lz.translate(H,H)},eT=function(){Lz.translate(-H,-H)},Gs=function(){this.actorSize=(jn-1)*2,this.energizerSize=jn+2,this.pointsEarnedTextSize=jn,this.energizerColor="#FFF",this.pelletColor="#888",this.flashLevel=false};Gs.prototype={setOverlayColor:function(qZ){this.overlayColor=qZ},beginMapClip:function(){Rr.save(),Rr.beginPath(),Rr.rect(-H,-H,oP-1,Ab-1),Rr.clip()},endMapClip:function(){Rr.restore()},beginFrame:function(){var qZ,cx,Lz;if(this.setOverlayColor(void 0),Rr.save(),Rr.fillStyle="#000",qZ=JQ,cx=RY,Lz=Ne,Rr.fillRect(0,0,qZ,Lz+1),Rr.fillRect(0,Lz,Lz,cx-2*Lz),Rr.fillRect(qZ-Lz-2,Lz,Lz+2,cx-2*Lz),Rr.fillRect(0,cx-Lz-2,qZ,Lz+2),bK)Rr.font=jn-2+"px ArcadeR",Rr.textBaseline="bottom",Rr.textAlign="right",Rr.fillStyle="#333",Rr.fillText(Math.floor(EC.getFps())+" FPS",JQ,RY);Rr.translate(Ne+H,Ne+H)},endFrame:function(){if(Rr.restore(),this.overlayColor!=void 0)Rr.fillStyle=this.overlayColor,Rr.fillRect(0,0,JQ,RY)},clearMapFrame:function(){Rr.fillStyle="#000",Rr.fillRect(-1,-1,oP+1,Ab+1)},renderFunc:function(qZ,bK){if(bK)qZ.call(bK,Rr);else qZ(Rr)},drawNoGroutTile:function(qZ,bK,cx,Rr){var Lz=Rj.getTile(bK,cx);this.drawCenterTileSq(qZ,bK,cx,jn,Rj.getTile(bK+1,cx)==Lz,Rj.getTile(bK,cx+1)==Lz,Rj.getTile(bK+1,cx+1)==Lz)},drawCenterTileSq:function(qZ,bK,cx,Rr,Lz,wv,Gw){this.drawCenterPixelSq(qZ,bK*jn+Hp.x,cx*jn+Hp.y,Rr,Lz,wv,Gw)},drawCenterPixelSq:function(qZ,bK,cx,Rr,Lz,wv,Gw){qZ.fillRect(bK-Rr/2,cx-Rr/2,Rr,Rr);var AA=1;if(Lz)qZ.fillRect(bK-Rr/2,cx-Rr/2,Rr+AA,Rr);if(wv)qZ.fillRect(bK-Rr/2,cx-Rr/2,Rr,Rr+AA)},toggleLevelFlash:function(){this.flashLevel=!this.flashLevel},setLevelFlash:function(qZ){if(qZ!=this.flashLevel)this.flashLevel=qZ,this.drawMap()},drawTargets:function(){var qZ;for(Rr.strokeStyle="rgba(255,255,255,0.5)",Rr.lineWidth="1.5",Rr.lineCap="round",Rr.lineJoin="round",qZ=0;qZ<5;qZ++)if(Af[qZ].isDrawTarget)Af[qZ].drawTarget(Rr)},drawPaths:function(){var qZ=Rr.globalAlpha,bK;for(Rr.globalAlpha=.7,bK=0;bK<5;bK++)if(Af[bK].isDrawPath)this.drawPath(Af[bK]);Rr.globalAlpha=qZ},drawPath:function(qZ){if(!qZ.targetting)return;var bK={x:qZ.tile.x,y:qZ.tile.y},cx=qZ.targetTile,Lz={x:qZ.dir.x,y:qZ.dir.y},wv=qZ.dirEnum,Gw;if(bK.x==cx.x&&bK.y==cx.y)return;if(wv==eI&&qZ.tilePixel.y<=Hp.y||wv==oc&&qZ.tilePixel.y>=Hp.y||wv==vZ&&qZ.tilePixel.x<=Hp.x||wv==mW&qZ.tilePixel.x>=Hp.x)bK.x+=Lz.x,bK.y+=Lz.y;var AA={x:bK.x*jn+Hp.x,y:bK.y*jn+Hp.y},pF=Math.abs(bK.x*jn+Hp.x-qZ.pixel.x+bK.y*jn+Hp.y-qZ.pixel.y),gO=ll*jn,qN;if(Rr.strokeStyle=qZ.pathColor,Rr.lineWidth="2.0",Rr.lineCap="round",Rr.lineJoin="round",Rr.beginPath(),Rr.moveTo(qZ.pixel.x+qZ.pathCenter.x,qZ.pixel.y+qZ.pathCenter.y),Rr.lineTo(AA.x+qZ.pathCenter.x,AA.y+qZ.pathCenter.y),bK.x==cx.x&&bK.y==cx.y)qN=qZ.getPathDistLeft(AA,wv);else while(true){if(Gw=ak(bK,wv),qZ!=wX&&Rj.constrainGhostTurns)Rj.constrainGhostTurns(bK,Gw,wv);if(wv=lD(bK,cx,Gw),Pg(Lz,wv),bK.x+Lz.x==cx.x&&bK.y+Lz.y==cx.y){qN=qZ.getPathDistLeft(AA,wv),qN=Math.min(gO-pF,qN);break}if(pF+jn>gO){qN=gO-pF;break}bK.x+=Lz.x,bK.y+=Lz.y,AA.x+=jn*Lz.x,AA.y+=jn*Lz.y,pF+=jn,Rr.lineTo(bK.x*jn+Hp.x+qZ.pathCenter.x,bK.y*jn+Hp.y+qZ.pathCenter.y)}var Yl=AA.x+qZ.pathCenter.x+qN*Lz.x,ao=AA.y+qZ.pathCenter.y+qN*Lz.y;Rr.lineTo(Yl,ao);var De=3;if(wv==vZ||wv==mW)Rr.lineTo(Yl-De*Lz.x,ao+De*Lz.x),Rr.moveTo(Yl,ao),Rr.lineTo(Yl-De*Lz.x,ao-De*Lz.x);else Rr.lineTo(Yl+De*Lz.y,ao-De*Lz.y),Rr.moveTo(Yl,ao),Rr.lineTo(Yl-De*Lz.y,ao-De*Lz.y);Rr.stroke()},erasePellet:function(qZ,bK){if(Lz.translate(H,H),Lz.fillStyle=this.floorColor,this.drawNoGroutTile(Lz,qZ,bK,jn),Rj.getTile(qZ+1,bK)==" ")this.drawNoGroutTile(Lz,qZ+1,bK,jn);if(Rj.getTile(qZ-1,bK)==" ")this.drawNoGroutTile(Lz,qZ-1,bK,jn);if(Rj.getTile(qZ,bK+1)==" ")this.drawNoGroutTile(Lz,qZ,bK+1,jn);if(Rj.getTile(qZ,bK-1)==" ")this.drawNoGroutTile(Lz,qZ,bK-1,jn);Lz.translate(-H,-H)},drawMessage:function(qZ,bK,cx,Lz){Rr.font=jn+"px ArcadeR",Rr.textBaseline="top",Rr.textAlign="right",Rr.fillStyle=bK,cx+=qZ.length,Rr.fillText(qZ,cx*jn,Lz*jn)},drawReadyMessage:function(){this.drawMessage("READY ","#FF0",11,20),Ws(Rr,16*jn+3,20*jn+3)},drawEatenPoints:function(){PP.drawGhostPoints(Rr,wX.pixel.x,wX.pixel.y,Qc.getPoints())},drawActors:function(){var qZ;if(Qc.isActive()){for(qZ=0;qZ<4;qZ++)this.drawGhost(sd[qZ]);if(!Qc.showingPoints())this.drawPlayer();else this.drawEatenPoints()}else{for(this.drawPlayer(),qZ=3;qZ>=0;qZ--)if(sd[qZ].isVisible)this.drawGhost(sd[qZ]);if(eD.isVisible&&!eP.isVisible)this.drawGhost(eP,.5)}}};var Rg=function(){Gs.call(this,Rr,Lz),this.messageRow=21.7,this.pointsEarnedTextSize=1.5*jn,this.backColor="#222",this.floorColor="#444",this.flashFloorColor="#999",this.name="Minimal"};Rg.prototype=qZ(Gs.prototype,{drawMap:function(){var qZ,bK,cx,Rr;for(xk(),Lz.fillStyle=this.flashLevel?this.flashFloorColor:this.floorColor,cx=0,bK=0;bK<Rj.numRows;bK++)for(qZ=0;qZ<Rj.numCols;qZ++)if(Rr=Rj.currentTiles[cx++],Rr==" ")this.drawNoGroutTile(Lz,qZ,bK,jn);for(Lz.fillStyle=this.pelletColor,cx=0,bK=0;bK<Rj.numRows;bK++)for(qZ=0;qZ<Rj.numCols;qZ++)if(Rr=Rj.currentTiles[cx++],Rr==".")this.drawNoGroutTile(Lz,qZ,bK,jn);eT()},refreshPellet:function(qZ,bK){var cx=Rj.posToIndex(qZ,bK),Rr=Rj.currentTiles[cx];if(Rr==" ")this.erasePellet(qZ,bK);else if(Rr==".")Lz.fillStyle=this.pelletColor,this.drawNoGroutTile(Lz,qZ,bK,jn)},drawScore:function(){Rr.font=1.5*jn+"px sans-serif",Rr.textBaseline="top",Rr.textAlign="left",Rr.fillStyle="#FFF",Rr.fillText(Zq(),jn,jn*2),Rr.font="bold "+1.5*jn+"px sans-serif",Rr.textBaseline="top",Rr.textAlign="center",Rr.fillText("high score",jn*Rj.numCols/2,3),Rr.fillText(EG(),jn*Rj.numCols/2,jn*2)},drawExtraLives:function(){var qZ;Rr.fillStyle="rgba(255,255,0,0.6)";var bK=TM==1/0?1:TM;for(qZ=0;qZ<TM;qZ++)this.drawCenterPixelSq(Rr,(2*qZ+3)*jn,(Rj.numRows-2)*jn+Hp.y,this.actorSize)},drawLevelIcons:function(){var qZ;Rr.fillStyle="rgba(255,255,255,0.5)";var bK=2,cx=this.actorSize;for(qZ=0;qZ<qy;qZ++)Rr.fillRect((Rj.numCols-2)*jn-qZ*2*bK,(Rj.numRows-2)*jn+Hp.y-cx/2,bK,cx)},drawEnergizers:function(){var qZ,bK;for(Rr.fillStyle=this.energizerColor,bK=0;bK<Rj.numEnergizers;bK++)if(qZ=Rj.energizers[bK],Rj.currentTiles[qZ.x+qZ.y*Rj.numCols]=="o")this.drawCenterTileSq(Rr,qZ.x,qZ.y,this.energizerSize)},drawPlayer:function(qZ,bK){if(qZ==void 0)qZ=1;if(bK==void 0)bK=1;Rr.fillStyle="rgba(255,255,0,"+bK+")",this.drawCenterPixelSq(Rr,wX.pixel.x,wX.pixel.y,this.actorSize*qZ)},drawDyingPlayer:function(qZ){var bK=qZ*85;if(bK<=60)qZ=bK/60,this.drawPlayer(1-qZ);else bK-=60,qZ=bK/15,this.drawPlayer(qZ,1-qZ)},drawGhost:function(qZ){if(qZ.mode==NH)return;var bK=qZ.color;if(qZ.scared)bK=Qc.isFlash()?"#FFF":"#2121ff";else if(qZ.mode==G||qZ.mode==WD)bK="rgba(255,255,255,0.3)";Rr.fillStyle=bK,this.drawCenterPixelSq(Rr,qZ.pixel.x,qZ.pixel.y,this.actorSize)},drawFruit:function(){if(fj.isPresent())Rr.fillStyle="#0F0",this.drawCenterPixelSq(Rr,fj.pixel.x,fj.pixel.y,jn+2);else if(fj.isScorePresent())Rr.font=this.pointsEarnedTextSize+"px sans-serif",Rr.textBaseline="middle",Rr.textAlign="center",Rr.fillStyle="#FFF",Rr.fillText(fj.getPoints(),fj.pixel.x,fj.pixel.y)}});var pg=function(qZ,bK){Gs.call(this,qZ,bK),this.messageRow=20,this.pelletSize=2,this.energizerSize=jn,this.backColor="#000",this.floorColor="#000",this.flashWallColor="#FFF",this.name="Arcade"};pg.prototype=qZ(Gs.prototype,{blitMap:function(){Rr.scale(1/wv,1/wv),Rr.drawImage(cx,-1-H*wv,-1-H*wv),Rr.scale(wv,wv)},drawMap:function(qZ){if(xk(),Rj){if(LM!=SG)this.flashLevel=false;var bK,cx,Rr,wv,Gw;for(Rr=0,cx=0;cx<Rj.numRows;cx++)for(bK=0;bK<Rj.numCols;bK++){if(Rj.currentTiles[Rr]=="-"&&Rj.currentTiles[Rr+1]=="-")Lz.fillStyle="#ffb8de",Lz.fillRect(bK*jn,cx*jn+jn-2,jn*2,2);Rr++}if(this.flashLevel)Lz.fillStyle="#000",Lz.strokeStyle="#fff";else Lz.fillStyle=Rj.wallFillColor,Lz.strokeStyle=Rj.wallStrokeColor;for(Rr=0;Rr<Rj.paths.length;Rr++){var Yl=Rj.paths[Rr];for(Lz.beginPath(),Lz.moveTo(Yl[0].x,Yl[0].y),wv=1;wv<Yl.length;wv++)if(Yl[wv].cx!=void 0)Lz.quadraticCurveTo(Yl[wv].cx,Yl[wv].cy,Yl[wv].x,Yl[wv].y);else Lz.lineTo(Yl[wv].x,Yl[wv].y);Lz.quadraticCurveTo(Yl[wv-1].x,Yl[0].y,Yl[0].x,Yl[0].y),Lz.fill(),Lz.stroke()}for(Lz.fillStyle=Rj.pelletColor,Rr=0,cx=0;cx<Rj.numRows;cx++)for(bK=0;bK<Rj.numCols;bK++)this.refreshPellet(bK,cx,true);if(Rj.onDraw)Rj.onDraw(Lz);if(Rj.shouldDrawMapOnly)return void eT()}if(qy>0){var ao=36,TS=28;if(!qZ){var Rr;Lz.fillStyle=wX.color,Lz.save(),Lz.translate(3*jn,(ao-1)*jn),Lz.scale(.85,.85);var ty=TM==1/0?1:TM;if(De==AA)for(Rr=0;Rr<ty;Rr++)Rs(Lz,0,0,vZ,Math.PI/6),Lz.translate(2*jn,0);else if(De==pF)for(Rr=0;Rr<ty;Rr++)ud(Lz,0,0,mW,1),Lz.translate(2*jn,0);else if(De==gO)for(Rr=0;Rr<ty;Rr++)Ly(Lz,0,0,mW,1,false),Lz.translate(2*jn,0);else if(De==qN)for(Rr=0;Rr<ty;Rr++)HL(Lz,0,0,mW,0),Lz.translate(2*jn,0);if(TM==1/0){Lz.translate(-4*jn,0);var qK=2,SW=3;Lz.beginPath(),Lz.moveTo(-SW-qK,0),Lz.quadraticCurveTo(-SW-qK,-qK,-SW,-qK),Lz.bezierCurveTo(-(SW-qK),-qK,SW-qK,qK,SW,qK),Lz.quadraticCurveTo(SW+qK,qK,SW+qK,0),Lz.quadraticCurveTo(SW+qK,-qK,SW,-qK),Lz.bezierCurveTo(SW-qK,-qK,-(SW-qK),qK,-SW,qK),Lz.quadraticCurveTo(-SW-qK,qK,-SW-qK,0),Lz.lineWidth=1,Lz.strokeStyle="#FFF",Lz.stroke()}Lz.restore()}var yH=fj.fruitHistory,Rr,wv,Jz,Gs,Rg=7,pg=Math.max(Rg,qy);if(De!=AA)pg=Math.min(Rg,pg);var IF=.85;for(Rr=0,wv=pg-Rg+1;Rr<Rg&&wv<=qy;wv++,Rr++)if(Jz=yH[wv],Jz)if(Gs=SX(Jz.name),Gs)Lz.save(),Lz.translate((TS-3)*jn-Rr*16*IF,(ao-1)*jn),Lz.scale(IF,IF),Gs(Lz,0,0),Lz.restore();if(!qZ){if(qy>=100)Lz.font=jn-3+"px ArcadeR";else Lz.font=jn-1+"px ArcadeR";Lz.textBaseline="middle",Lz.fillStyle="#777",Lz.textAlign="left",Lz.fillText(qy,(TS-2)*jn,(ao-1)*jn)}}eT()},erasePellet:function(qZ,bK,cx){if(!cx)Lz.translate(H,H);Lz.fillStyle="#000";var Rr=Rj.posToIndex(qZ,bK),wv=Rj.tiles[Rr]=="o"?this.energizerSize:this.pelletSize;if(this.drawCenterTileSq(Lz,qZ,bK,wv+2),!cx)Lz.translate(-H,-H)},refreshPellet:function(qZ,bK,cx){if(!cx)Lz.translate(H,H);var Rr=Rj.posToIndex(qZ,bK),wv=Rj.currentTiles[Rr];if(wv==" ")this.erasePellet(qZ,bK,cx);else if(wv==".")Lz.fillStyle=Rj.pelletColor,Lz.translate(.5,.5),this.drawCenterTileSq(Lz,qZ,bK,this.pelletSize),Lz.translate(-.5,-.5);else if(wv=="o")Lz.fillStyle=Rj.pelletColor,Lz.beginPath(),Lz.arc(qZ*jn+Hp.x+.5,bK*jn+Hp.y,this.energizerSize/2,0,Math.PI*2),Lz.fill();if(!cx)Lz.translate(-H,-H)},drawScore:function(){Rr.font=jn+"px ArcadeR",Rr.textBaseline="top",Rr.fillStyle="#FFF",Rr.textAlign="right",Rr.fillText("1UP",6*jn,0),Rr.fillText(Yl?"PRACTICE":"HIGH SCORE",19*jn,0);var qZ=Zq();if(qZ==0)qZ="00";var bK=jn+1;if(Rr.fillText(qZ,7*jn,bK),!Yl){var cx=EG();if(cx==0)cx="00";Rr.fillText(cx,17*jn,bK)}},drawGhost:function(qZ,bK){var cx;if(bK)cx=Rr.globalAlpha,Rr.globalAlpha=bK;var Lz=function(bK,cx,Lz,wv,Gw,AA,pF,gO){if(bK==NH)return;var qN=qZ.getAnimFrame(Lz),Yl=bK==G||bK==WD,ao=yH(),De=qZ.getBounceY(cx.x,cx.y,gO),TS=qZ==eP&&Gw?cx.x+1:cx.x;ao(Rr,TS,De,qN,wv,Gw,AA,Yl,pF)};if(Gg.drawHistory(Rr,(function(bK){Lz(qZ.savedMode[bK],qZ.savedPixel[bK],qZ.savedFrames[bK],qZ.savedFaceDirEnum[bK],qZ.savedScared[bK],Qc.isFlash(),qZ.color,qZ.savedDirEnum[bK])})),Lz(qZ.mode,qZ.pixel,qZ.frames,qZ.faceDirEnum,qZ.scared,Qc.isFlash(),qZ.color,qZ.dirEnum),bK)Rr.globalAlpha=cx},drawPlayer:function(){var qZ=wX.getAnimFrame();if(wX.invincible)Rr.globalAlpha=.6;var bK=function(qZ,bK,cx){var Lz=wX.getAnimFrame(wX.getStepFrame(cx)),wv=Jz();wv(Rr,qZ.x,qZ.y,bK,Lz,true)};if(Gg.drawHistory(Rr,(function(qZ){bK(wX.savedPixel[qZ],wX.savedDirEnum[qZ],wX.savedSteps[qZ])})),bK(wX.pixel,wX.dirEnum,wX.steps),wX.invincible)Rr.globalAlpha=1},drawDyingPlayer:function(qZ){var bK=wX.getAnimFrame();if(De==AA){var cx=qZ*75;if(cx<=60){qZ=cx/60;var Lz=bK*Math.PI/6;Rs(Rr,wX.pixel.x,wX.pixel.y,wX.dirEnum,Lz+qZ*(Math.PI-Lz),4*qZ)}else cx-=60,this.drawExplodingPlayer(cx/15)}else if(De==qN)if(qZ<.8){var wv=Math.floor(wX.dirEnum-qZ*16)%4;if(wv<0)wv+=4;HL(Rr,wX.pixel.x,wX.pixel.y,wv,0)}else if(qZ<.95){var wv=Math.floor(wX.dirEnum-.8*16)%4;if(wv<0)wv+=4;HL(Rr,wX.pixel.x,wX.pixel.y,wv,0)}else xQ(Rr,wX.pixel.x,wX.pixel.y);else if(De==pF){var Gw=Math.PI*5,Yl=Math.PI/4/Gw,ao=Math.floor(qZ/Yl)*Yl*Gw;ud(Rr,wX.pixel.x,wX.pixel.y,wX.dirEnum,bK,ao)}else if(De==gO){var Gw=Math.PI*5,Yl=Math.PI/4/Gw,ao=Math.floor(qZ/Yl)*Yl*Gw;Ly(Rr,wX.pixel.x,wX.pixel.y,wX.dirEnum,bK,false,ao)}},drawExplodingPlayer:function(qZ){var bK=wX.getAnimFrame();Rs(Rr,wX.pixel.x,wX.pixel.y,wX.dirEnum,0,0,qZ,-3,1-qZ)},drawFruit:function(){if(fj.getCurrentFruit()){var qZ=fj.getCurrentFruit().name;if(fj.savedPixel)Gg.drawHistory(Rr,(function(bK){var cx=fj.savedPixel[bK];if(cx)PP.drawFruitSprite(Rr,cx.x,cx.y,qZ)}));if(fj.isPresent())PP.drawFruitSprite(Rr,fj.pixel.x,fj.pixel.y,qZ);else if(fj.isScorePresent())if(De==AA)PP.drawPacFruitPoints(Rr,fj.pixel.x,fj.pixel.y,fj.getPoints());else PP.drawMsPacFruitPoints(Rr,fj.pixel.x,fj.pixel.y,fj.getPoints())}}}),mx=[new Rg,new pg],BA=mx[1]},FY=(Kd=false,{update:function(){var qZ=this.isValidState();if(qZ!=Kd)if(Kd=qZ,Kd)vB.onHudEnable(),Gg.onHudEnable();else vB.onHudDisable(),Gg.onHudDisable()},draw:function(qZ){vB.draw(qZ),Gg.draw(qZ)},isValidState:function(){return LM==UP||LM==QJ||LM==Te||LM==x||LM==SG||LM==le||LM==ea}}),Kd,qd=(aT={},Xu=200,Qx=oP,Zh=Math.floor(Ab*1.5),vv=-.5,nt=120,mN=4,wC=nt/mN,bR=function(){var qZ;for(Em=0,JS=0,qZ=0;qZ<Xu;qZ++)aT[qZ]={x:Gw(0,Qx-1),y:Gw(0,Zh-1),color:wv(),phase:Gw(0,nt-1)}},kN=function(){if(Em++,Em%=nt,JS+=vv,JS%=Zh,JS<0)JS+=Zh},uh=function(qZ){var bK,cx,Rr,Lz;for(qZ.fillStyle="#FFF",bK=0;bK<Xu;bK++)if(cx=aT[bK],Rr=(Em+cx.phase)%nt,Rr>=wC){if(Lz=cx.y-JS,Lz<0)Lz+=Zh;qZ.fillStyle=cx.color,qZ.fillRect(cx.x,Lz,1,1)}},{init:bR,draw:uh,update:kN}),aT,Xu,Qx,Zh,JS,vv,Em,nt,mN,wC,bR,kN,uh,Ck=function(qZ){var bK=gm,cx=0,Rr=0;while(bK.tagName!="BODY")cx+=bK.offsetTop,Rr+=bK.offsetLeft,bK=bK.offsetParent;var Lz=qZ.pageX-Rr,wv=qZ.pageY-cx,Gw=1;return Lz/=ys/Gw,wv/=ys/Gw,Lz-=Ne,wv-=Ne,{x:Lz,y:wv}},Zy=function(qZ,bK,cx,Rr,Lz){this.x=qZ,this.y=bK,this.w=cx,this.h=Rr,this.onclick=Lz,this.pad=jn,this.frame=0,this.borderBlurColor="#333",this.borderFocusColor="#EEE",this.isSelected=false,this.startedInside=false;var wv=this,Gw=function(qZ){qZ.preventDefault();var bK=qZ.touches.length;if(bK==1){var cx=Ck(qZ.touches[0]);(wv.startedInside=wv.contains(cx.x,cx.y))?wv.focus():wv.blur()}else gO(qZ)},AA=function(qZ){qZ.preventDefault();var bK=qZ.touches.length;if(bK==1){if(wv.startedInside){var cx=Ck(qZ.touches[0]);wv.contains(cx.x,cx.y)?wv.focus():wv.blur()}}else gO(qZ)},pF=function(qZ){qZ.preventDefault();var bK=wv.startedInside&&wv.isSelected;if(bK)wv.click();if(gO(qZ),bK)wv.focus()},gO=function(qZ){qZ.preventDefault(),this.startedInside=false,wv.blur()},qN=function(qZ){var bK=Ck(qZ);if(wv.contains(bK.x,bK.y))wv.click()},Yl=function(qZ){var bK=Ck(qZ);wv.contains(bK.x,bK.y)?wv.focus():wv.blur()},ao=function(qZ){wv.blur()};this.isEnabled=false,this.onEnable=function(){gm.addEventListener("click",qN),gm.addEventListener("mousemove",Yl),gm.addEventListener("mouseleave",ao),gm.addEventListener("touchstart",Gw),gm.addEventListener("touchmove",AA),gm.addEventListener("touchend",pF),gm.addEventListener("touchcancel",gO),this.isEnabled=true},this.onDisable=function(){gm.removeEventListener("click",qN),gm.removeEventListener("mousemove",Yl),gm.removeEventListener("mouseleave",ao),gm.removeEventListener("touchstart",Gw),gm.removeEventListener("touchmove",AA),gm.removeEventListener("touchend",pF),gm.removeEventListener("touchcancel",gO),wv.blur(),this.isEnabled=false}};Zy.prototype={contains:function(qZ,bK){return qZ>=this.x&&qZ<=this.x+this.w&&bK>=this.y&&bK<=this.y+this.h},click:function(){clearTimeout(this.clickTimeout);var qZ=this;if(qZ.onclick)this.clickTimeout=setTimeout((function(){qZ.onclick()}),200)},enable:function(){this.frame=0,this.onEnable()},disable:function(){this.onDisable()},focus:function(){this.isSelected=true,this.onfocus&&this.onfocus()},blur:function(){this.isSelected=false,this.onblur&&this.onblur()},setText:function(qZ){this.msg=qZ},setFont:function(qZ,bK){this.font=qZ,this.fontcolor=bK},setIcon:function(qZ){this.drawIcon=qZ},draw:function(qZ){qZ.lineWidth=2,qZ.beginPath();var bK=this.x,cx=this.y,Rr=this.w,Lz=this.h,wv=Lz/4;if(qZ.moveTo(bK,cx+wv),qZ.quadraticCurveTo(bK,cx,bK+wv,cx),qZ.lineTo(bK+Rr-wv,cx),qZ.quadraticCurveTo(bK+Rr,cx,bK+Rr,cx+wv),qZ.lineTo(bK+Rr,cx+Lz-wv),qZ.quadraticCurveTo(bK+Rr,cx+Lz,bK+Rr-wv,cx+Lz),qZ.lineTo(bK+wv,cx+Lz),qZ.quadraticCurveTo(bK,cx+Lz,bK,cx+Lz-wv),qZ.closePath(),qZ.fillStyle="rgba(0,0,0,0.5)",qZ.fill(),qZ.strokeStyle=this.isSelected&&this.onclick?this.borderFocusColor:this.borderBlurColor,qZ.stroke(),this.drawIcon)if(!this.msg)this.drawIcon(qZ,this.x+this.w/2,this.y+this.h/2,this.frame);else this.drawIcon(qZ,this.x+this.pad+jn,this.y+this.h/2,this.frame);if(this.msg)qZ.font=this.font,qZ.fillStyle=this.isSelected&&this.onclick?this.fontcolor:"#777",qZ.textBaseline="middle",qZ.textAlign="center",qZ.fillText(this.msg,this.x+this.w/2,this.y+this.h/2+1)},update:function(){if(this.drawIcon)this.frame=this.isSelected?this.frame+1:0}};var HK=function(qZ,bK,cx,Rr,Lz,wv){var Gw=this,AA=function(){wv(!Lz()),Gw.refreshMsg()};this.isOn=Lz,this.setOn=wv,Zy.call(this,qZ,bK,cx,Rr,AA)};HK.prototype=qZ(Zy.prototype,{enable:function(){Zy.prototype.enable.call(this),this.refreshMsg()},setToggleLabel:function(qZ){this.label=qZ},refreshMsg:function(){if(this.label)this.msg=this.label+": "+(this.isOn()?"ON":"OFF")},refreshOnState:function(){this.setOn(this.isOn())}});var gW=function(qZ,bK,cx,Rr,Lz,wv,Gw,AA){if(this.title=qZ,this.x=bK,this.y=cx,this.w=Rr,this.h=Lz,this.pad=wv,this.buttons=[],this.buttonCount=0,this.currentY=this.y+this.pad,qZ)this.currentY+=1*(this.h+this.pad);this.font=Gw,this.fontcolor=AA,this.enabled=false,this.backButton=void 0};gW.prototype={clickCurrentOption:function(){var qZ;for(qZ=0;qZ<this.buttonCount;qZ++)if(this.buttons[qZ].isSelected){this.buttons[qZ].onclick();break}},selectNextOption:function(){var qZ,bK;for(qZ=0;qZ<this.buttonCount;qZ++)if(this.buttons[qZ].isSelected){this.buttons[qZ].blur(),bK=this.buttons[(qZ+1)%this.buttonCount];break}bK=bK||this.buttons[0],bK.focus()},selectPrevOption:function(){var qZ,bK;for(qZ=0;qZ<this.buttonCount;qZ++)if(this.buttons[qZ].isSelected){this.buttons[qZ].blur(),bK=this.buttons[qZ==0?this.buttonCount-1:qZ-1];break}bK=bK||this.buttons[this.buttonCount-1],bK.focus()},addToggleButton:function(qZ,bK){var cx=new HK(this.x+this.pad,this.currentY,this.w-this.pad*2,this.h,qZ,bK);this.buttons.push(cx),this.buttonCount++,this.currentY+=this.pad+this.h},addToggleTextButton:function(qZ,bK,cx){var Rr=new HK(this.x+this.pad,this.currentY,this.w-this.pad*2,this.h,bK,cx);Rr.setFont(this.font,this.fontcolor),Rr.setToggleLabel(qZ),this.buttons.push(Rr),this.buttonCount++,this.currentY+=this.pad+this.h},addTextButton:function(qZ,bK){var cx=new Zy(this.x+this.pad,this.currentY,this.w-this.pad*2,this.h,bK);cx.setFont(this.font,this.fontcolor),cx.setText(qZ),this.buttons.push(cx),this.buttonCount++,this.currentY+=this.pad+this.h},addTextIconButton:function(qZ,bK,cx){var Rr=new Zy(this.x+this.pad,this.currentY,this.w-this.pad*2,this.h,bK);Rr.setFont(this.font,this.fontcolor),Rr.setText(qZ),Rr.setIcon(cx),this.buttons.push(Rr),this.buttonCount++,this.currentY+=this.pad+this.h},addIconButton:function(qZ,bK){var cx=new Zy(this.x+this.pad,this.currentY,this.w-this.pad*2,this.h,bK);cx.setIcon(qZ),this.buttons.push(cx),this.buttonCount++,this.currentY+=this.pad+this.h},addSpacer:function(qZ){if(qZ==void 0)qZ=1;this.currentY+=qZ*(this.pad+this.h)},enable:function(){var qZ;for(qZ=0;qZ<this.buttonCount;qZ++)this.buttons[qZ].enable();this.enabled=true},disable:function(){var qZ;for(qZ=0;qZ<this.buttonCount;qZ++)this.buttons[qZ].disable();this.enabled=false},isEnabled:function(){return this.enabled},draw:function(qZ){if(this.title)qZ.font=jn+"px ArcadeR",qZ.textBaseline="middle",qZ.textAlign="center",qZ.fillStyle="#FFF",qZ.fillText(this.title,this.x+this.w/2,this.y+this.pad+this.h/2);var bK;for(bK=0;bK<this.buttonCount;bK++)this.buttons[bK].draw(qZ)},update:function(){var qZ;for(qZ=0;qZ<this.buttonCount;qZ++)this.buttons[qZ].update()}};var vB=function(){var qZ=jn*6,bK=jn*3,cx=function(){return Yl?gO:pF},Rr=function(){cx().enable()},Lz=function(){cx().disable()},wv=new Zy(oP/2-qZ/2,Ab,qZ,bK,(function(){Rr(),Gg.onHudDisable()}));wv.setText("MENU"),wv.setFont(jn+"px ArcadeR","#FFF");var Gw=new gW("QUESTION?",2*jn,5*jn,oP-4*jn,3*jn,jn,jn+"px ArcadeR","#EEE");Gw.addTextButton("YES",(function(){Gw.disable(),Gw.onConfirm()})),Gw.addTextButton("NO",(function(){Gw.disable(),Rr()})),Gw.addTextButton("CANCEL",(function(){Gw.disable(),Rr()})),Gw.backButton=Gw.buttons[Gw.buttonCount-1];var AA=function(qZ,bK){Lz(),Gw.title=qZ,Gw.onConfirm=bK,Gw.enable()},pF=new gW("PAUSED",2*jn,5*jn,oP-4*jn,3*jn,jn,jn+"px ArcadeR","#EEE");pF.addTextButton("RESUME",(function(){pF.disable()})),pF.addTextButton("QUIT",(function(){AA("QUIT GAME?",(function(){XW(cY,60)}))})),pF.backButton=pF.buttons[0];var gO=new gW("PAUSED",2*jn,5*jn,oP-4*jn,3*jn,jn,jn+"px ArcadeR","#EEE");gO.addTextButton("RESUME",(function(){Lz(),Gg.onHudEnable()})),gO.addTextButton("RESTART LEVEL",(function(){AA("RESTART LEVEL?",(function(){qy--,XW(Te,60)}))})),gO.addTextButton("SKIP LEVEL",(function(){AA("SKIP LEVEL?",(function(){XW(Te,60)}))})),gO.addTextButton("CHEATS",(function(){gO.disable(),qN.enable()})),gO.addTextButton("QUIT",(function(){AA("QUIT GAME?",(function(){XW(cY,60),eT(),Gg.reset()}))})),gO.backButton=gO.buttons[0];var qN=new gW("CHEATS",2*jn,5*jn,oP-4*jn,3*jn,jn,jn+"px ArcadeR","#EEE");qN.addToggleTextButton("INVINCIBLE",(function(){return wX.invincible}),(function(qZ){wX.invincible=qZ})),qN.addToggleTextButton("TURBO",(function(){return ao}),(function(qZ){ao=qZ})),qN.addToggleTextButton("SHOW TARGETS",(function(){return eP.isDrawTarget}),(function(qZ){for(var bK=0;bK<4;bK++)sd[bK].isDrawTarget=qZ})),qN.addToggleTextButton("SHOW PATHS",(function(){return eP.isDrawPath}),(function(qZ){for(var bK=0;bK<4;bK++)sd[bK].isDrawPath=qZ})),qN.addSpacer(1),qN.addTextButton("BACK",(function(){qN.disable(),gO.enable()})),qN.backButton=qN.buttons[qN.buttons.length-1];var De=[pF,gO,Gw,qN],TS=function(){var qZ=De.length,bK,cx;for(bK=0;bK<qZ;bK++)if(cx=De[bK],cx.isEnabled())return cx};return{onHudEnable:function(){wv.enable()},onHudDisable:function(){wv.disable()},update:function(){if(wv.isEnabled)wv.update()},draw:function(qZ){var bK=TS();if(bK)qZ.fillStyle="rgba(0,0,0,0.8)",qZ.fillRect(-H-1,-H-1,oP+1,Ab+1),bK.draw(qZ);else wv.draw(qZ)},isOpen:function(){return TS()!=void 0},getMenu:function(){return TS()},getMenuButton:function(){return wv}}}(),bg=(ap=[0,6,1,3,2,2,3,1,4,1,5,0,8,0,9,1,10,1,11,2,12,3,13,6],bb=function(qZ){var bK;qZ.save(),qZ.translate(.5,0),qZ.moveTo(0,6),qZ.quadraticCurveTo(1.5,0,6.5,0),qZ.quadraticCurveTo(11.5,0,13,6),qZ.restore()},lX=function(){var qZ=[13,13,11,11,9,13,8,13,8,11,5,11,5,13,4,13,2,11,0,13];return function(bK){var cx;for(bK.save(),bK.translate(.5,.5),cx=0;cx<qZ.length;cx+=2)bK.lineTo(qZ[cx],qZ[cx+1]);bK.restore()}}(),h=function(){var qZ=[13,12,12,13,11,13,9,11,7,13,6,13,4,11,2,13,1,13,0,12];return function(bK){var cx;for(bK.save(),bK.translate(.5,.5),cx=0;cx<qZ.length;cx+=2)bK.lineTo(qZ[cx],qZ[cx+1]);bK.restore()}}(),RH=function(qZ,bK){var cx;qZ.save(),qZ.translate(2,3);var Rr=[0,1,1,0,2,0,3,1,3,3,2,4,1,4,0,3],Lz=function(){for(qZ.translate(.5,.5),qZ.beginPath(),qZ.moveTo(Rr[0],Rr[1]),cx=2;cx<Rr.length;cx+=2)qZ.lineTo(Rr[cx],Rr[cx+1]);qZ.closePath(),qZ.fill(),qZ.lineJoin="round",qZ.stroke(),qZ.translate(-.5,-.5)};if(bK==vZ)qZ.translate(-1,0);else if(bK==mW)qZ.translate(1,0);else if(bK==eI)qZ.translate(0,-1);else if(bK==oc)qZ.translate(0,1);if(qZ.fillStyle="#FFF",qZ.strokeStyle="#FFF",qZ.lineWidth=1,qZ.lineJoin="round",Lz(),qZ.translate(6,0),Lz(),bK==vZ)qZ.translate(0,2);else if(bK==mW)qZ.translate(2,2);else if(bK==eI)qZ.translate(1,0);else if(bK==oc)qZ.translate(1,3);qZ.fillStyle="#00F",qZ.fillRect(0,0,2,2),qZ.translate(-6,0),qZ.fillRect(0,0,2,2),qZ.restore()},mt=function(qZ,bK){qZ.strokeStyle=qZ.fillStyle=bK?"#F00":"#FF0",qZ.fillRect(4,5,2,2),qZ.fillRect(8,5,2,2);var cx=[1,10,2,9,3,9,4,10,5,10,6,9,7,9,8,10,9,10,10,9,11,9,12,10];for(qZ.translate(.5,.5),qZ.beginPath(),qZ.moveTo(cx[0],cx[1]),i=2;i<cx.length;i+=2)qZ.lineTo(cx[i],cx[i+1]);qZ.lineWidth=1,qZ.stroke(),qZ.translate(-.5,-.5)},function(qZ,bK,cx,Rr,Lz,wv,Gw,AA,pF){if(qZ.save(),qZ.translate(bK-7,cx-7),wv)pF=Gw?"#FFF":"#2121ff";if(!AA){if(qZ.beginPath(),bb(qZ),Rr==0)lX(qZ);else h(qZ);qZ.closePath(),qZ.lineJoin="round",qZ.lineCap="round",qZ.lineWidth=.5,qZ.strokeStyle=pF,qZ.stroke(),qZ.lineWidth=1,qZ.fillStyle=pF,qZ.fill()}if(wv)mt(qZ,Gw);else RH(qZ,Lz);qZ.restore()}),bb,ap,lX,h,RH,mt,mg=function(){var qZ,bK,cx=function(bK,cx){var Rr=bK.length,Lz;for(qZ.beginPath(),qZ.moveTo(bK[0],bK[1]),Lz=2;Lz<Rr;Lz+=2)qZ.lineTo(bK[Lz],bK[Lz+1]);qZ.closePath(),qZ.lineWidth=1,qZ.lineCap=qZ.lineJoin="round",qZ.strokeStyle=cx,qZ.stroke()},Rr=function(bK,cx){var Rr=bK.length,Lz;for(qZ.beginPath(),qZ.moveTo(bK[0],bK[1]),Lz=2;Lz<Rr;Lz+=2)qZ.lineTo(bK[Lz],bK[Lz+1]);qZ.lineWidth=1,qZ.lineCap=qZ.lineJoin="round",qZ.strokeStyle=cx,qZ.stroke()},Lz=function(Rr,Lz){qZ.save(),qZ.translate(Rr,Lz),cx([1,0,2,0,3,1,3,5,2,6,1,6,0,5,0,1],bK),qZ.restore()},wv=function(qZ,cx){Rr([qZ,cx,qZ,cx+6],bK)},Gw=function(cx,Lz){qZ.save(),qZ.translate(cx,Lz),Rr([0,1,1,0,1,6,0,6,2,6],bK),qZ.restore()},AA=function(cx,Lz){qZ.save(),qZ.translate(cx,Lz),Rr([0,2,0,1,1,0,3,0,4,1,4,2,0,6,4,6],bK),qZ.restore()},pF=function(cx,Lz){qZ.save(),qZ.translate(cx,Lz),Rr([0,0,4,0,2,2,4,4,4,5,3,6,1,6,0,5],bK),qZ.restore()},gO=function(cx,Lz){qZ.save(),qZ.translate(cx,Lz),Rr([3,6,3,0,0,3,0,4,4,4],bK),qZ.restore()},qN=function(cx,Lz){qZ.save(),qZ.translate(cx,Lz),Rr([4,0,0,0,0,2,3,2,4,3,4,5,3,6,1,6,0,5],bK),qZ.restore()},Yl=function(cx,Lz){qZ.save(),qZ.translate(cx,Lz),Rr([3,0,1,0,0,1,0,5,1,6,2,6,3,5,3,3,0,3],bK),qZ.restore()},ao=function(cx,Lz){qZ.save(),qZ.translate(cx,Lz),Rr([0,1,0,0,4,0,4,1,2,4,2,6],bK),qZ.restore()},De=function(Rr,Lz){qZ.save(),qZ.translate(Rr,Lz),cx([1,0,3,0,4,1,4,2,3,3,1,3,0,4,0,5,1,6,3,6,4,5,4,4,3,3,1,3,0,2,0,1],bK),qZ.restore()},TS=function(){Gw(-5,-3),Lz(-1,-3),Lz(4,-3)},ty=function(){AA(-7,-3),Lz(-1,-3),Lz(4,-3)},qK=function(){pF(-7,-3),Lz(-1,-3),Lz(4,-3)},SW=function(){gO(-7,-3),Lz(-1,-3),Lz(4,-3)},xk=function(){qN(-7,-3),Lz(-1,-3),Lz(4,-3)},yH=function(){ao(-7,-3),Lz(-1,-3),Lz(4,-3)},Jz=function(){De(-7,-3),Lz(-1,-3),Lz(4,-3)},eT=function(){Gw(-8,-3),Lz(-4,-3),Lz(1,-3),Lz(6,-3)},Gs=function(){wv(-7,-3),Yl(-5,-3),Lz(0,-3),Lz(5,-3)},Rg=function(){AA(-10,-3),Lz(-4,-3),Lz(1,-3),Lz(6,-3)},qy=function(){pF(-10,-3),Lz(-4,-3),Lz(1,-3),Lz(6,-3)},TM=function(){qN(-10,-3),Lz(-4,-3),Lz(1,-3),Lz(6,-3)};return function(cx,Rr,Lz,wv,Gw){qZ=cx,bK=Gw,qZ.save(),qZ.translate(Rr+.5,Lz+.5),qZ.translate(0,-1);var AA={100:TS,200:ty,300:qK,400:SW,500:xk,700:yH,800:Jz,1e3:eT,1600:Gs,2e3:Rg,3e3:qy,5e3:TM}[wv];if(AA)AA();qZ.restore()}}(),Fu=function(){var qZ,bK="#fff",cx=function(bK,cx){var Rr=bK.length,Lz;for(qZ.beginPath(),qZ.moveTo(bK[0],bK[1]),Lz=2;Lz<Rr;Lz+=2)qZ.lineTo(bK[Lz],bK[Lz+1]);qZ.closePath(),qZ.lineWidth=1,qZ.lineCap=qZ.lineJoin="round",qZ.strokeStyle=cx,qZ.stroke()},Rr=function(bK,cx){var Rr=bK.length,Lz;for(qZ.beginPath(),qZ.moveTo(bK[0],bK[1]),Lz=2;Lz<Rr;Lz+=2)qZ.lineTo(bK[Lz],bK[Lz+1]);qZ.lineWidth=1,qZ.lineCap=qZ.lineJoin="round",qZ.strokeStyle=cx,qZ.stroke()},Lz=function(Rr,Lz){qZ.save(),qZ.translate(Rr,Lz),cx([0,0,2,0,2,4,0,4],bK),qZ.restore()},wv=function(cx,Lz){qZ.save(),qZ.translate(cx,Lz),Rr([1,0,1,4],bK),qZ.restore()},Gw=function(cx,Lz){qZ.save(),qZ.translate(cx,Lz),Rr([0,0,2,0,2,2,0,2,0,4,2,4],bK),qZ.restore()},AA=function(cx,Lz){qZ.save(),qZ.translate(cx,Lz),Rr([2,0,0,0,0,2,2,2,2,4,0,4],bK),qZ.restore()},pF=function(cx,Lz){qZ.save(),qZ.translate(cx,Lz),Rr([0,0,2,0,2,4],bK),qZ.restore()},gO=function(){wv(-5,-5),Lz(-1,-2),Lz(3,1)},qN=function(){Gw(-5,-5),Lz(-1,-2),Lz(3,1)},Yl=function(){AA(-5,-5),Lz(-1,-2),Lz(3,1)},ao=function(){pF(-5,-5),Lz(-1,-2),Lz(3,1)},De=function(){wv(-7,-7),Lz(-3,-4),Lz(1,-1),Lz(5,2)},TS=function(){Gw(-7,-7),Lz(-3,-4),Lz(1,-1),Lz(5,2)},ty=function(){AA(-7,-7),Lz(-3,-4),Lz(1,-1),Lz(5,2)};return function(bK,cx,Rr,Lz){qZ=bK,qZ.save(),qZ.translate(cx+.5,Rr+.5);var wv={100:gO,200:qN,500:Yl,700:ao,1e3:De,2e3:TS,5e3:ty}[Lz];if(wv)wv();qZ.restore()}}(),tx=function(){var qZ,bK,cx=function(bK,cx){var Rr=bK.length,Lz;for(qZ.beginPath(),qZ.moveTo(bK[0],bK[1]),Lz=2;Lz<Rr;Lz+=2)qZ.lineTo(bK[Lz],bK[Lz+1]);qZ.closePath(),qZ.lineWidth=1,qZ.lineCap=qZ.lineJoin="round",qZ.strokeStyle=cx,qZ.stroke()},Rr=function(bK,cx){var Rr=bK.length,Lz;for(qZ.beginPath(),qZ.moveTo(bK[0],bK[1]),Lz=2;Lz<Rr;Lz+=2)qZ.lineTo(bK[Lz],bK[Lz+1]);qZ.lineWidth=1,qZ.lineCap=qZ.lineJoin="round",qZ.strokeStyle=cx,qZ.stroke()},Lz=function(bK,cx){var Rr=bK.length,Lz;for(qZ.beginPath(),qZ.moveTo(bK[0],bK[1]),Lz=2;Lz<Rr;Lz+=2)qZ.lineTo(bK[Lz],bK[Lz+1]);qZ.closePath(),qZ.lineWidth=1,qZ.lineJoin="round",qZ.fillStyle=qZ.strokeStyle=cx,qZ.fill(),qZ.stroke()},wv=function(bK,cx,Rr){var wv;if(qZ.save(),qZ.translate(cx,Rr),Lz([0,1,1,0,2,0,3,1,3,3,2,4,1,4,0,3],"#FFF"),bK==vZ)qZ.translate(0,2);else if(bK==mW)qZ.translate(2,2);else if(bK==eI)qZ.translate(1,0);else if(bK==oc)qZ.translate(1,3);Lz([0,0,1,0,1,1,0,1],"#00F"),qZ.restore()},Gw=function(){Lz([-7,-3,-3,-7,-1,-7,-2,-6,0,-4,3,-7,5,-7,4,-7,3,-6,6,-3,6,1,5,3,2,6,-4,6,-5,5,-7,1],bK)},AA=function(bK,cx){qZ.save(),qZ.translate(bK,cx),Lz([0,0,3,-3,4,-3,5,-2,5,-1,4,0],"#00F"),qZ.restore()},pF=function(){Rr([-1,-7,0,-6],"#FFF"),Rr([5,-7,6,-6],"#FFF"),Gw(),AA(1,6),Rr([-4,6,-1,6],"#00F"),wv(mW,-4,-4),wv(mW,2,-4)},gO=function(){Rr([-1,-7,0,-7],"#FFF"),Rr([5,-7,6,-7],"#FFF"),Gw(),AA(-4,6),Rr([2,6,5,6],"#00F"),wv(mW,-4,-4),wv(mW,2,-4)},qN=function(){qZ.scale(-1,1),qZ.translate(1,0),pF()},Yl=function(){qZ.scale(-1,1),qZ.translate(1,0),gO()},ao=function(){Rr([-6,-7,-7,-6],"#FFF"),Rr([5,-7,6,-6],"#FFF"),Lz([-7,-3,-4,-6,-5,-7,-6,-7,-4,-7,-3,-6,-2,-6,-1,-5,0,-5,1,-6,2,-6,3,-7,5,-7,4,-7,3,-6,6,-3,6,1,5,3,4,5,3,6,-4,6,-5,5,-6,3,-7,1],bK)},De=function(){Rr([-6,-6,-7,-5],"#FFF"),Rr([5,-6,6,-5],"#FFF"),Lz([-7,-3,-4,-6,-5,-7,-6,-6,-5,-7,-4,-7,-3,-6,-2,-6,-1,-5,0,-5,1,-6,2,-6,3,-7,4,-7,5,-6,4,-7,3,-6,6,-3,6,1,5,3,4,5,3,6,-4,6,-5,5,-6,3,-7,1],bK)},TS=function(){ao(),wv(eI,-5,-5),wv(eI,1,-5),Lz([-4,6,-3,5,-2,5,-1,6],"#00F")},ty=function(){De(),wv(eI,-5,-5),wv(eI,1,-5),Lz([0,6,1,5,2,5,3,6],"#00F")},qK=function(){ao(),wv(oc,-5,-4),wv(oc,1,-4),Lz([0,6,1,4,2,3,3,3,4,4,4,5,3,6],"#00F"),Rr([-4,6,-2,6],"#00F")},SW=function(){De(),wv(oc,-5,-4),wv(oc,1,-4),Lz([-1,6,-2,4,-3,3,-4,3,-5,4,-5,5,-4,6],"#00F"),Rr([1,6,3,6],"#00F")},xk,yH,Jz=function(){cx([-6,-2,-2,-5,-3,-6,-5,-6,-3,-6,-1,-4,1,-4,3,-6,5,-6,3,-6,2,-5,6,-2,6,4,5,6,4,7,-4,7,-5,6,-6,4],xk),Rr([-2,4,-1,3,1,3,2,4],yH)},eT=function(qZ){Rr([-2,-2,-2,0],yH),Rr([-3,-1,-1,-1],yH),Rr([2,-2,2,0],yH),Rr([3,-1,1,-1],yH),Rr([-5,-6,-6,-7],"#FFF"),Rr([5,-6,6,-7],"#FFF"),Jz()},Gs=function(qZ){Rr([-3,-2,-1,0],yH),Rr([-3,0,-1,-2],yH),Rr([1,-2,3,0],yH),Rr([1,0,3,-2],yH),Rr([-5,-6,-6,-5],"#FFF"),Rr([5,-6,6,-5],"#FFF"),Jz()};return function(cx,Rr,Lz,wv,Gw,AA,ao,De,Jz){if(De)return;if(qZ=cx,bK=Jz,qZ.save(),qZ.translate(Rr+.5,Lz+.5),AA)qZ.translate(0,-1),xk=ao?"#FFF":"#00F",yH=ao?"#F00":"#FF0",[eT,Gs][wv]();else if(Gw==mW)[pF,gO][wv]();else if(Gw==vZ)[qN,Yl][wv]();else if(Gw==oc)[qK,SW][wv]();else if(Gw==eI)[TS,ty][wv]();qZ.restore()}}(),FU=function(qZ,bK){var cx,Rr=function(qZ,bK){var Rr=qZ.length,Lz;for(cx.beginPath(),cx.moveTo(qZ[0],qZ[1]),Lz=2;Lz<Rr;Lz+=2)cx.lineTo(qZ[Lz],qZ[Lz+1]);cx.lineWidth=1,cx.lineCap=cx.lineJoin="round",cx.strokeStyle=bK,cx.stroke()},Lz=function(qZ,bK){var Rr=qZ.length,Lz;for(cx.beginPath(),cx.moveTo(qZ[0],qZ[1]),Lz=2;Lz<Rr;Lz+=2)cx.lineTo(qZ[Lz],qZ[Lz+1]);cx.closePath(),cx.lineWidth=1,cx.lineJoin="round",cx.fillStyle=cx.strokeStyle=bK,cx.fill(),cx.stroke()},wv=function(){Lz([-4,-5,-3,-6,-2,-6,-2,-5,-3,-4,-4,-4],bK)},Gw=function(){Lz([-5,-4,-3,-6,2,-6,3,-5,-1,-3,3,-1,1,1,1,3,3,6,5,4,6,4,6,5,4,7,2,7,-1,1,-4,4,-3,6,-3,7,-4,7,-6,5,-6,4,-3,1,-5,-1],qZ),wv()},AA=function(){Lz([-5,-4,-3,-6,1,-6,3,-4,3,-1,1,1,1,6,4,6,4,7,0,7,0,1,-2,1,-4,3,-4,4,-3,5,-3,6,-4,6,-5,4,-5,3,-3,1,-5,-1],qZ),wv()},pF=function(){Lz([-5,-4,-3,-6,2,-6,3,-5,-1,-3,3,-1,1,1,1,3,4,3,4,4,0,4,0,1,-2,1,-2,6,1,6,1,7,-3,7,-3,1,-5,-1],qZ),wv()},gO=function(){Lz([-5,-4,-3,-6,2,-6,-2,-3,2,0,1,1,3,5,5,3,6,3,6,4,4,6,2,6,-1,1,-3,1,-3,6,0,6,0,7,-4,7,-4,2,-3,1,-5,-1],qZ),wv()},qN=function(){Lz([-5,-5,-4,-6,-3,-6,-3,-5,-4,-4,-5,-4],bK),Lz([3,-6,4,-6,5,-5,5,-4,4,-4,3,-5],bK)},Yl=function(){Lz([-4,-4,-2,-6,2,-6,4,-4,4,-1,2,1,-2,1,-4,-1],qZ)},ao=function(bK,Rr){cx.save(),cx.translate(0,bK),cx.scale(Rr,1),Lz([1,0,2,0,2,6,4,6,4,7,1,7],qZ),cx.restore()},De=function(bK,Rr){cx.save(),cx.translate(0,bK),cx.scale(Rr,1),Lz([1,0,2,0,2,4,3,5,4,4,5,4,5,5,3,7,2,7,1,6],qZ),cx.restore()},TS=function(){ao(0,-1),De(-2,1)},ty=function(){ao(-2,-1),De(-2,1)},qK=function(){De(-2,-1),ao(0,1)},SW=function(){De(0,-1),ao(0,1)},xk=function(){Yl(),qN(),TS(),Rr([-2,-3,2,-3],"#000")},yH=function(){Yl(),qN(),ty()},Jz=function(){Yl(),qN(),qK(),Rr([-2,-3,2,-3],"#000")},eT=function(){Yl(),qN(),SW(),Lz([-2,-3,0,-5,2,-3,0,-1],"#000")},Gs=function(){qN(),Yl(),TS()},Rg=function(){qN(),Yl(),ty()},qy=function(){qN(),Yl(),qK()},TM=function(){qN(),Yl(),SW()};return function(qZ,bK,Rr,Lz,wv,qN){if(cx=qZ,cx.save(),cx.translate(bK+.5,Rr+.5),qN)cx.rotate(qN);if(Lz==mW)cx.translate(0,-1),[Gw,AA,pF,gO][wv]();else if(Lz==vZ)cx.translate(0,-1),cx.scale(-1,1),[Gw,AA,pF,gO][wv]();else if(Lz==oc)cx.translate(0,-1),[xk,yH,Jz,eT][wv]();else if(Lz==eI)cx.translate(0,-1),[Gs,Rg,qy,TM][wv]();cx.restore()}},HL=FU("#FF0","#00F"),XK=FU("#F00","#FFF"),xQ=function(qZ,bK,cx){var Rr=function(bK,cx){var Rr=bK.length,Lz;for(qZ.beginPath(),qZ.moveTo(bK[0],bK[1]),Lz=2;Lz<Rr;Lz+=2)qZ.lineTo(bK[Lz],bK[Lz+1]);qZ.closePath(),qZ.lineWidth=1,qZ.lineCap=qZ.lineJoin="round",qZ.strokeStyle=cx,qZ.stroke()};qZ.save(),qZ.translate(bK+2,cx),Rr([3,-5,-1,-5,-2,-6,-2,-7,-1,-8,3,-8,4,-7,4,-6],"#F00"),qZ.restore(),HL(qZ,bK,cx,vZ,2,Math.PI/2)},Rs=function(qZ,bK,cx,Rr,Lz,wv,Gw,AA,pF,gO,qN){if(wv==void 0)wv=0;if(AA==void 0)AA=0;if(Gw==void 0)Gw=1;if(pF==void 0)pF=1;if(gO==void 0)gO="rgba(255,255,0,"+pF+")";if(qZ.save(),qZ.translate(bK,cx),qZ.scale(Gw,Gw),qN)qZ.rotate(qN);var Yl=Math.PI/2;if(Rr==eI)qZ.rotate(3*Yl);else if(Rr==mW)qZ.rotate(0);else if(Rr==oc)qZ.rotate(Yl);else if(Rr==vZ)qZ.rotate(2*Yl);qZ.beginPath(),qZ.moveTo(-3+wv,0),qZ.arc(AA,0,6.5,Lz,2*Math.PI-Lz),qZ.closePath(),qZ.fillStyle=gO,qZ.fill(),qZ.restore()},AU=function(qZ,bK,cx,Rr,Lz){var wv="#FF0",Gw=0,AA=0;if(Lz==1)Gw=-4,AA=Math.atan(7/14);else if(Lz==2)Gw=-2,AA=Math.atan(13/9);qZ.save(),qZ.translate(bK,cx);var pF=Math.PI/2;if(Rr==eI)qZ.rotate(3*pF);else if(Rr==mW)qZ.rotate(0);else if(Rr==oc)qZ.rotate(pF);else if(Rr==vZ)qZ.rotate(2*pF);qZ.beginPath(),qZ.moveTo(Gw,0),qZ.arc(0,0,16,AA,2*Math.PI-AA),qZ.closePath(),qZ.fillStyle=wv,qZ.fill(),qZ.restore()},ud=function(qZ,bK,cx,Rr,Lz,wv){var Gw=0;if(Lz==0)Rs(qZ,bK,cx,Rr,0,void 0,void 0,void 0,void 0,void 0,wv);else if(Lz==1)Gw=Math.atan(4/5),Rs(qZ,bK,cx,Rr,Gw,void 0,void 0,void 0,void 0,void 0,wv),Gw=Math.atan(4/8);else if(Lz==2)Gw=Math.atan(6/3),Rs(qZ,bK,cx,Rr,Gw,void 0,void 0,void 0,void 0,void 0,wv),Gw=Math.atan(6/6);if(qZ.save(),qZ.translate(bK,cx),wv)qZ.rotate(wv);var AA=Math.PI/2;if(Rr==eI)qZ.rotate(-AA);else if(Rr==oc)qZ.rotate(AA);else if(Rr==vZ)qZ.scale(-1,1);var bK=-7.5,cx=-7.5;if(qZ.fillStyle="#F00",qZ.beginPath(),qZ.arc(bK+1,cx+4,1.25,0,Math.PI*2),qZ.closePath(),qZ.fill(),qZ.beginPath(),qZ.arc(bK+2,cx+5,1.25,0,Math.PI*2),qZ.closePath(),qZ.fill(),qZ.beginPath(),qZ.arc(bK+3,cx+3,1.25,0,Math.PI*2),qZ.closePath(),qZ.fill(),qZ.beginPath(),qZ.arc(bK+4,cx+1,1.25,0,Math.PI*2),qZ.closePath(),qZ.fill(),qZ.beginPath(),qZ.arc(bK+5,cx+2,1.25,0,Math.PI*2),qZ.closePath(),qZ.fill(),qZ.fillStyle="#0031FF",qZ.beginPath(),qZ.arc(bK+2.5,cx+3.5,.5,0,Math.PI*2),qZ.closePath(),qZ.fill(),qZ.beginPath(),qZ.arc(bK+3.5,cx+2.5,.5,0,Math.PI*2),qZ.closePath(),qZ.fill(),qZ.strokeStyle="#F00",qZ.lineWidth=1.25,qZ.lineCap="round",qZ.beginPath(),Lz==0)qZ.moveTo(5,0),qZ.lineTo(6.5,0),qZ.moveTo(6.5,-1.5),qZ.lineTo(6.5,1.5);else{var pF=7.5,gO=8.5,qN=Math.cos(Gw),Yl=Math.sin(Gw);qZ.moveTo(-3+pF*qN,pF*Yl),qZ.lineTo(-3+gO*qN,gO*Yl),qZ.moveTo(-3+pF*qN,-pF*Yl),qZ.lineTo(-3+gO*qN,-gO*Yl)}if(qZ.stroke(),qZ.beginPath(),qZ.arc(-3,2,.5,0,Math.PI*2),qZ.fillStyle="#000",qZ.fill(),qZ.strokeStyle="#000",qZ.lineCap="round",qZ.beginPath(),Lz==0)qZ.moveTo(-2.5,-2),qZ.lineTo(-.5,-2);else{var pF=.5,gO=2.5,qN=Math.cos(Gw),Yl=Math.sin(Gw);qZ.moveTo(-3+pF*qN,-2-pF*Yl),qZ.lineTo(-3+gO*qN,-2-gO*Yl)}qZ.stroke(),qZ.restore()},Ly=(hv=void 0,Sw=0,lK=0,au=0,dy=0,cK=2.1,Hb=1,TL=function(){var qZ=Math.random()*Math.PI*2,bK=Math.random()*Math.PI*2,cx=Math.random()*Hb,Rr=Math.random()*Hb;Sw=Math.cos(qZ)*cx,lK=Math.sin(qZ)*cx,au=Math.cos(bK)*Rr,dy=Math.sin(bK)*Rr},function(qZ,bK,cx,Rr,Lz,wv,Gw){var AA=0,pF=function(Lz){Rs(qZ,bK,cx,Rr,Lz,void 0,void 0,void 0,void 0,"#47b8ff",Gw)};if(Lz==0)pF(0);else if(Lz==1)AA=Math.atan(4/5),pF(AA),AA=Math.atan(4/8);else if(Lz==2)AA=Math.atan(6/3),pF(AA),AA=Math.atan(6/6);if(qZ.save(),qZ.translate(bK,cx),Gw)qZ.rotate(Gw);var gO=Math.PI/2;if(Rr==eI)qZ.rotate(-gO);else if(Rr==oc)qZ.rotate(gO);else if(Rr==vZ)qZ.scale(-1,1);var bK=-4,cx=-3.5,qN=3,Yl=6;AA/=3,AA+=Math.PI/8;var ao=Math.cos(AA),De=Math.sin(AA);if(wv){if(Lz!=hv)TL();hv=Lz}qZ.beginPath(),qZ.arc(bK+Yl*ao,cx-Yl*De,cK,0,Math.PI*2),qZ.fillStyle="#FFF",qZ.fill(),qZ.beginPath(),qZ.arc(bK+Yl*ao+au,cx-Yl*De+dy,Hb,0,Math.PI*2),qZ.fillStyle="#000",qZ.fill(),qZ.beginPath(),qZ.arc(bK+qN*ao,cx-qN*De,cK,0,Math.PI*2),qZ.fillStyle="#FFF",qZ.fill(),qZ.beginPath(),qZ.arc(bK+qN*ao+Sw,cx-qN*De+lK,Hb,0,Math.PI*2),qZ.fillStyle="#000",qZ.fill(),qZ.restore()}),hv,Sw,lK,au,dy,cK,Hb,TL,mc=function(qZ,bK,cx){var Rr=function(bK,cx){qZ.save(),qZ.translate(bK,cx),qZ.beginPath(),qZ.arc(2.5,2.5,3,0,Math.PI*2),qZ.lineWidth=1,qZ.strokeStyle="#000",qZ.stroke(),qZ.fillStyle="#ff0000",qZ.fill(),qZ.lineCap="round",qZ.beginPath(),qZ.moveTo(1,3),qZ.lineTo(2,4),qZ.strokeStyle="#fff",qZ.stroke(),qZ.restore()};qZ.save(),qZ.translate(bK,cx),Rr(-6,-1),Rr(-1,1),qZ.beginPath(),qZ.moveTo(-3,0),qZ.bezierCurveTo(-1,-2,2,-4,5,-5),qZ.lineTo(5,-4),qZ.bezierCurveTo(3,-4,1,0,1,2),qZ.strokeStyle="#ff9900",qZ.lineJoin="round",qZ.lineCap="round",qZ.stroke(),qZ.restore()},SE=function(qZ,bK,cx){qZ.save(),qZ.translate(bK,cx),qZ.beginPath(),qZ.moveTo(-1,-4),qZ.bezierCurveTo(-3,-4,-5,-3,-5,-1),qZ.bezierCurveTo(-5,3,-2,5,0,6),qZ.bezierCurveTo(3,5,5,2,5,0),qZ.bezierCurveTo(5,-3,3,-4,0,-4),qZ.fillStyle="#f00",qZ.fill(),qZ.strokeStyle="#f00",qZ.stroke();var Rr=[{x:-4,y:-1},{x:-3,y:2},{x:-2,y:0},{x:-1,y:4},{x:0,y:2},{x:0,y:0},{x:2,y:4},{x:2,y:-1},{x:3,y:1},{x:4,y:-2}],Lz,wv;for(qZ.fillStyle="#fff",Lz=0,wv=Rr.length;Lz<wv;Lz++){var Gw=Rr[Lz];qZ.beginPath(),qZ.arc(Gw.x,Gw.y,.75,0,2*Math.PI),qZ.fill()}qZ.beginPath(),qZ.moveTo(0,-4),qZ.lineTo(-3,-4),qZ.lineTo(0,-4),qZ.lineTo(-2,-3),qZ.lineTo(-1,-3),qZ.lineTo(0,-4),qZ.lineTo(0,-2),qZ.lineTo(0,-4),qZ.lineTo(1,-3),qZ.lineTo(2,-3),qZ.lineTo(0,-4),qZ.lineTo(3,-4),qZ.closePath(),qZ.strokeStyle="#00ff00",qZ.lineCap="round",qZ.lineJoin="round",qZ.stroke(),qZ.beginPath(),qZ.moveTo(0,-4),qZ.lineTo(0,-5),qZ.lineCap="round",qZ.strokeStyle="#fff",qZ.stroke(),qZ.restore()},bf=function(qZ,bK,cx){qZ.save(),qZ.translate(bK,cx),qZ.beginPath(),qZ.moveTo(-2,-2),qZ.bezierCurveTo(-3,-2,-5,-1,-5,1),qZ.bezierCurveTo(-5,4,-3,6,0,6),qZ.bezierCurveTo(3,6,5,4,5,1),qZ.bezierCurveTo(5,-1,3,-2,2,-2),qZ.closePath(),qZ.fillStyle="#ffcc33",qZ.fill(),qZ.strokeStyle="#ffcc33",qZ.stroke(),qZ.beginPath(),qZ.moveTo(-1,-1),qZ.quadraticCurveTo(-1,-2,-2,-2),qZ.quadraticCurveTo(-1,-2,-1,-4),qZ.quadraticCurveTo(-1,-2,0,-2),qZ.quadraticCurveTo(-1,-2,-1,-1),qZ.strokeStyle="#ff9900",qZ.lineJoin="round",qZ.stroke(),qZ.beginPath(),qZ.moveTo(-.5,-4),qZ.quadraticCurveTo(0,-5,1,-5),qZ.bezierCurveTo(2,-5,3,-4,4,-4),qZ.bezierCurveTo(3,-4,3,-3,2,-3),qZ.bezierCurveTo(1,-3,1,-4,-.5,-4),qZ.strokeStyle="#00ff00",qZ.lineCap="round",qZ.lineJoin="round",qZ.stroke(),qZ.fillStyle="#00ff00",qZ.fill(),qZ.restore()},RT=function(qZ,bK,cx){qZ.save(),qZ.translate(bK,cx),qZ.beginPath(),qZ.moveTo(-2,-3),qZ.bezierCurveTo(-2,-4,-3,-4,-4,-4),qZ.bezierCurveTo(-5,-4,-6,-3,-6,0),qZ.bezierCurveTo(-6,3,-4,6,-2.5,6),qZ.quadraticCurveTo(-1,6,-1,5),qZ.bezierCurveTo(-1,6,0,6,1,6),qZ.bezierCurveTo(3,6,5,3,5,0),qZ.bezierCurveTo(5,-3,3,-4,2,-4),qZ.quadraticCurveTo(0,-4,0,-3),qZ.closePath(),qZ.fillStyle="#ff0000",qZ.fill(),qZ.beginPath(),qZ.moveTo(-1,-3),qZ.quadraticCurveTo(-1,-5,0,-5),qZ.lineCap="round",qZ.strokeStyle="#ff9900",qZ.stroke(),qZ.beginPath(),qZ.moveTo(2,3),qZ.quadraticCurveTo(3,3,3,1),qZ.lineCap="round",qZ.strokeStyle="#fff",qZ.stroke(),qZ.restore()},wf=function(qZ,bK,cx){qZ.save(),qZ.translate(bK,cx),qZ.beginPath(),qZ.arc(0,2,5.5,0,Math.PI*2),qZ.fillStyle="#7bf331",qZ.fill(),qZ.beginPath(),qZ.moveTo(0,-4),qZ.lineTo(0,-5),qZ.moveTo(2,-5),qZ.quadraticCurveTo(-3,-5,-3,-6),qZ.strokeStyle="#69b4af",qZ.lineCap="round",qZ.stroke();var Rr=[0,-2,-1,-1,-2,0,-3,1,-4,2,-3,3,-2,4,-1,5,-2,6,-3,-1,1,7,2,6,3,5,2,4,1,3,0,2,1,1,2,0,3,-1,3,1,4,2],Lz,wv;for(qZ.fillStyle="#69b4af",Lz=0,wv=Rr.length;Lz<wv;Lz+=2){var bK=Rr[Lz],cx=Rr[Lz+1];qZ.beginPath(),qZ.arc(bK,cx,.65,0,2*Math.PI),qZ.fill()}var Rr=[{x:0,y:-3},{x:-2,y:-1},{x:-4,y:1},{x:-3,y:3},{x:1,y:0},{x:-1,y:2},{x:-1,y:4},{x:3,y:2},{x:1,y:4}],Lz,wv;for(qZ.fillStyle="#fff",Lz=0,wv=Rr.length;Lz<wv;Lz++){var Gw=Rr[Lz];qZ.beginPath(),qZ.arc(Gw.x,Gw.y,.65,0,2*Math.PI),qZ.fill()}qZ.restore()},pi=function(qZ,bK,cx){qZ.save(),qZ.translate(bK,cx),qZ.beginPath(),qZ.moveTo(-4,-2),qZ.lineTo(4,-2),qZ.lineTo(4,-1),qZ.lineTo(2,1),qZ.lineTo(1,0),qZ.lineTo(0,0),qZ.lineTo(0,5),qZ.lineTo(0,0),qZ.lineTo(-1,0),qZ.lineTo(-2,1),qZ.lineTo(-4,-1),qZ.closePath(),qZ.lineJoin="round",qZ.strokeStyle=qZ.fillStyle="#fffa36",qZ.fill(),qZ.stroke(),qZ.beginPath(),qZ.moveTo(0,-5),qZ.lineTo(-3,-2),qZ.lineTo(-2,-2),qZ.lineTo(-1,-3),qZ.lineTo(0,-3),qZ.lineTo(0,-1),qZ.lineTo(0,-3),qZ.lineTo(1,-3),qZ.lineTo(2,-2),qZ.lineTo(3,-2),qZ.closePath(),qZ.lineJoin="round",qZ.strokeStyle=qZ.fillStyle="#f00",qZ.fill(),qZ.stroke(),qZ.beginPath(),qZ.moveTo(-5,-4),qZ.lineTo(-5,-1),qZ.lineTo(-2,2),qZ.moveTo(5,-4),qZ.lineTo(5,-1),qZ.lineTo(2,2),qZ.strokeStyle="#00f",qZ.lineJoin="round",qZ.stroke(),qZ.restore()},IU=function(qZ,bK,cx){qZ.save(),qZ.translate(bK,cx),qZ.beginPath(),qZ.moveTo(-1,-5),qZ.bezierCurveTo(-4,-5,-6,1,-6,6),qZ.lineTo(5,6),qZ.bezierCurveTo(5,1,3,-5,0,-5),qZ.closePath(),qZ.fillStyle=qZ.strokeStyle="#fffa37",qZ.stroke(),qZ.fill(),qZ.beginPath(),qZ.moveTo(-4,4),qZ.lineTo(-4,3),qZ.moveTo(-3,1),qZ.quadraticCurveTo(-3,-2,-2,-2),qZ.moveTo(-1,-4),qZ.lineTo(0,-4),qZ.lineCap="round",qZ.strokeStyle="#000",qZ.stroke(),qZ.beginPath(),qZ.rect(-5.5,6,10,2),qZ.fillStyle="#68b9fc",qZ.fill(),qZ.beginPath(),qZ.rect(-.5,6,2,2),qZ.fillStyle="#fff",qZ.fill(),qZ.restore()},iC=function(qZ,bK,cx){qZ.save(),qZ.translate(bK,cx),qZ.beginPath(),qZ.moveTo(-1,-2),qZ.lineTo(-1,5),qZ.moveTo(0,6),qZ.quadraticCurveTo(1,6,1,3),qZ.moveTo(1,4),qZ.lineTo(2,4),qZ.moveTo(1,1),qZ.lineTo(1,-2),qZ.moveTo(1,0),qZ.lineTo(2,0),qZ.lineCap="round",qZ.strokeStyle="#fff",qZ.stroke(),qZ.beginPath(),qZ.moveTo(0,-6),qZ.quadraticCurveTo(-3,-6,-3,-4),qZ.lineTo(-3,-2),qZ.lineTo(3,-2),qZ.lineTo(3,-4),qZ.quadraticCurveTo(3,-6,0,-6),qZ.strokeStyle=qZ.fillStyle="#68b9fc",qZ.fill(),qZ.lineJoin="round",qZ.stroke(),qZ.beginPath(),qZ.moveTo(1,-5),qZ.lineTo(-1,-5),qZ.lineCap="round",qZ.strokeStyle="#000",qZ.stroke(),qZ.restore()},bW=function(qZ,bK,cx){qZ.save(),qZ.translate(bK,cx),qZ.beginPath(),qZ.moveTo(-2,-5),qZ.quadraticCurveTo(-4,-6,-6,-4),qZ.quadraticCurveTo(-7,-2,-5,1),qZ.quadraticCurveTo(-3,4,0,5),qZ.quadraticCurveTo(5,5,5,-1),qZ.quadraticCurveTo(6,-5,3,-5),qZ.quadraticCurveTo(1,-5,0,-2),qZ.quadraticCurveTo(-2,3,-5,5),qZ.moveTo(1,1),qZ.quadraticCurveTo(3,4,4,6),qZ.lineWidth=2,qZ.lineCap="round",qZ.strokeStyle="#ffcc33",qZ.stroke();var Rr=[-5,-6,1,-6,4,-4,-5,0,-2,0,6,1,-4,6,5,5],Lz,wv;for(qZ.fillStyle="#fff",Lz=0,wv=Rr.length;Lz<wv;Lz+=2){var bK=Rr[Lz],cx=Rr[Lz+1];qZ.beginPath(),qZ.arc(bK,cx,.65,0,2*Math.PI),qZ.fill()}qZ.restore()},hQ=function(qZ,bK,cx){qZ.save(),qZ.translate(bK,cx),qZ.beginPath(),qZ.moveTo(0,-4),qZ.bezierCurveTo(-1,-4,-2,-3,-2,-1),qZ.bezierCurveTo(-2,1,-4,2,-4,4),qZ.bezierCurveTo(-4,6,-2,7,0,7),qZ.bezierCurveTo(2,7,4,6,4,4),qZ.bezierCurveTo(4,2,2,1,2,-1),qZ.bezierCurveTo(2,-3,1,-4,0,-4),qZ.fillStyle=qZ.strokeStyle="#00ff00",qZ.stroke(),qZ.fill(),qZ.beginPath(),qZ.moveTo(-2,3),qZ.quadraticCurveTo(-2,5,-1,5),qZ.strokeStyle="#0033ff",qZ.lineCap="round",qZ.stroke(),qZ.beginPath(),qZ.moveTo(0,-4),qZ.quadraticCurveTo(0,-6,2,-6),qZ.strokeStyle="#fff",qZ.lineCap="round",qZ.stroke(),qZ.restore()},QB=function(qZ,bK,cx){qZ.save(),qZ.translate(bK,cx),qZ.beginPath(),qZ.moveTo(-5,5),qZ.quadraticCurveTo(-4,5,-2,6),qZ.bezierCurveTo(2,6,6,2,6,-4),qZ.lineTo(3,-3),qZ.lineTo(3,-2),qZ.lineTo(-4,5),qZ.closePath(),qZ.fillStyle=qZ.strokeStyle="#ffff00",qZ.stroke(),qZ.fill(),qZ.beginPath(),qZ.moveTo(4,-5),qZ.lineTo(5,-6),qZ.strokeStyle="#ffff00",qZ.lineCap="round",qZ.stroke(),qZ.beginPath(),qZ.moveTo(3,-1),qZ.lineTo(-2,4),qZ.strokeStyle="#000",qZ.lineCap="round",qZ.stroke(),qZ.beginPath(),qZ.moveTo(2,3),qZ.lineTo(0,5),qZ.strokeStyle="#fff",qZ.lineCap="round",qZ.stroke(),qZ.restore()},MQ=function(qZ,bK,cx){qZ.save(),qZ.translate(bK,cx),qZ.beginPath(),qZ.arc(0,0,6,0,Math.PI*2),qZ.fillStyle="#f9bd6d",qZ.fill();var Rr=[0,-3,-4,-1,0,2,3,0,3,3],Lz,wv;for(qZ.fillStyle="#000",Lz=0,wv=Rr.length;Lz<wv;Lz+=2){var bK=Rr[Lz],cx=Rr[Lz+1];qZ.beginPath(),qZ.arc(bK,cx,.75,0,2*Math.PI),qZ.fill()}qZ.restore()},WI=function(qZ,bK,cx){qZ.save(),qZ.translate(bK,cx),qZ.beginPath(),qZ.arc(0,0,6,0,Math.PI*2),qZ.fillStyle="#000",qZ.lineWidth=1,qZ.strokeStyle="#f9bd6d",qZ.fill(),qZ.stroke();var Rr=[0,-3,-4,-1,0,2,3,0,3,3],Lz,wv;for(qZ.fillStyle="#f9bd6d",Lz=0,wv=Rr.length;Lz<wv;Lz+=2){var bK=Rr[Lz],cx=Rr[Lz+1];qZ.beginPath(),qZ.arc(bK,cx,.75,0,2*Math.PI),qZ.fill()}qZ.restore()},SX=function(qZ){var bK={cherry:mc,strawberry:SE,orange:bf,apple:RT,melon:wf,galaxian:pi,bell:IU,key:iC,pretzel:bW,pear:hQ,banana:QB,cookie:MQ};return bK[qZ]},zE=function(qZ,bK,cx,Rr){qZ.save(),qZ.fillStyle=Rr,qZ.translate(bK,cx),qZ.beginPath(),qZ.arc(0,0,4,0,Math.PI*2),qZ.fill(),qZ.restore()},ze=function(qZ,bK,cx,Rr){qZ.save(),qZ.fillStyle=Rr,qZ.translate(bK,cx);var Lz=3,wv=function(bK){qZ.beginPath(),qZ.moveTo(bK,Lz),qZ.lineTo(bK-2*Lz,0),qZ.lineTo(bK,-Lz),qZ.closePath(),qZ.fill()};wv(0),wv(2*Lz),qZ.restore()},cz=function(qZ,bK,cx,Rr){qZ.save(),qZ.translate(bK,cx);var Lz=jn;qZ.fillStyle=Rr,qZ.beginPath(),qZ.moveTo(0,-Lz/2),qZ.lineTo(Lz/2,Lz/2),qZ.lineTo(-Lz/2,Lz/2),qZ.closePath(),qZ.fill(),qZ.restore()},sZ=function(qZ,bK,cx,Rr){qZ.save(),qZ.translate(bK,cx);var Lz=jn;qZ.fillStyle=Rr,qZ.beginPath(),qZ.moveTo(0,Lz/2),qZ.lineTo(Lz/2,-Lz/2),qZ.lineTo(-Lz/2,-Lz/2),qZ.closePath(),qZ.fill(),qZ.restore()},BH=(iJ=function(qZ,bK){var cx=qZ.length,Rr;for(ctx.beginPath(),ctx.moveTo(qZ[0],qZ[1]),Rr=2;Rr<cx;Rr+=2)ctx.lineTo(qZ[Rr],qZ[Rr+1]);ctx.closePath(),ctx.lineWidth=1,ctx.lineJoin="round",ctx.fillStyle=ctx.strokeStyle=bK,ctx.fill(),ctx.stroke()},function(qZ,bK,cx,Rr){qZ.save(),qZ.translate(bK,cx),qZ.beginPath(),qZ.moveTo(-7,3),qZ.lineTo(-5,3),qZ.bezierCurveTo(-6,0,-5,-3,-2,-3),qZ.bezierCurveTo(0,-3,2,-2,2,2),qZ.bezierCurveTo(3,-1,3,-2,5,-2),qZ.bezierCurveTo(6,-2,6,0,5,0),qZ.bezierCurveTo(4,1,4,3,2,3),qZ.closePath(),qZ.lineWidth=1,qZ.lineCap=qZ.lineJoin="round",qZ.fillStyle=qZ.strokeStyle=Rr,qZ.fill(),qZ.stroke(),qZ.beginPath(),qZ.moveTo(4,-2),qZ.lineTo(3,-5),qZ.moveTo(5,-1),qZ.lineTo(7,-5),qZ.stroke(),qZ.beginPath(),qZ.arc(3,-5,1,0,Math.PI*2),qZ.fill(),qZ.beginPath(),qZ.arc(7,-5,1,0,Math.PI*2),qZ.fill(),qZ.beginPath(),qZ.moveTo(-4,1),qZ.bezierCurveTo(-5,-1,-3,-3,-1,-2),qZ.bezierCurveTo(0,-1,0,0,-1,1),qZ.bezierCurveTo(-2,1,-3,0,-2,-.5),qZ.lineWidth=.5,qZ.strokeStyle="#000",qZ.stroke(),qZ.restore()}),iJ,zQ=function(qZ,bK,cx){qZ.save(),qZ.translate(bK,cx),qZ.fillStyle="#ffb8ff",qZ.beginPath(),qZ.moveTo(0,-3),qZ.bezierCurveTo(-1,-4,-2,-6,-3.5,-6),qZ.quadraticCurveTo(-7,-6,-7,-.5),qZ.bezierCurveTo(-7,2,-2,5,0,7),qZ.bezierCurveTo(2,5,7,2,7,-.5),qZ.quadraticCurveTo(7,-6,3.5,-6),qZ.bezierCurveTo(2,-6,1,-4,0,-3),qZ.closePath(),qZ.fill(),qZ.restore()},Ws=function(qZ,bK,cx){qZ.save(),qZ.translate(bK,cx),qZ.lineWidth=.5,qZ.strokeStyle=qZ.fillStyle="#ff0",qZ.beginPath(),qZ.moveTo(-1,1),qZ.bezierCurveTo(-1,0,-1,-3,0,-3),qZ.lineTo(2,-3),qZ.bezierCurveTo(2,-2,0,0,-1,1),qZ.fill(),qZ.stroke(),qZ.beginPath(),qZ.arc(-2,3,.5,0,Math.PI*2),qZ.fill(),qZ.stroke(),qZ.restore()},vj=function(){this.dir={},this.pixel={},this.tile={},this.tilePixel={},this.distToMid={},this.targetTile={},this.frames=0,this.steps=0,this.isDrawTarget=false,this.isDrawPath=false,this.savedSteps={},this.savedFrames={},this.savedDirEnum={},this.savedPixel={},this.savedTargetting={},this.savedTargetTile={}};vj.prototype.save=function(qZ){this.savedSteps[qZ]=this.steps,this.savedFrames[qZ]=this.frames,this.savedDirEnum[qZ]=this.dirEnum,this.savedPixel[qZ]={x:this.pixel.x,y:this.pixel.y},this.savedTargetting[qZ]=this.targetting,this.savedTargetTile[qZ]={x:this.targetTile.x,y:this.targetTile.y}},vj.prototype.load=function(qZ){this.steps=this.savedSteps[qZ],this.frames=this.savedFrames[qZ],this.setDir(this.savedDirEnum[qZ]),this.setPos(this.savedPixel[qZ].x,this.savedPixel[qZ].y),this.targetting=this.savedTargetting[qZ],this.targetTile.x=this.savedTargetTile[qZ].x,this.targetTile.y=this.savedTargetTile[qZ].y},vj.prototype.reset=function(){this.setDir(this.startDirEnum),this.setPos(this.startPixel.x,this.startPixel.y),this.frames=0,this.steps=0,this.targetting=false},vj.prototype.setPos=function(qZ,bK){this.pixel.x=qZ,this.pixel.y=bK,this.commitPos()},vj.prototype.getTilePixel=function(qZ,bK){if(qZ==void 0)qZ=this.pixel;if(bK==void 0)bK={};if(bK.x=qZ.x%jn,bK.y=qZ.y%jn,bK.x<0)bK.x+=jn;if(bK.y<0)bK.y+=jn;return bK},vj.prototype.commitPos=function(){if(Rj)Rj.teleport(this);this.tile.x=Math.floor(this.pixel.x/jn),this.tile.y=Math.floor(this.pixel.y/jn),this.getTilePixel(this.pixel,this.tilePixel),this.distToMid.x=Hp.x-this.tilePixel.x,this.distToMid.y=Hp.y-this.tilePixel.y},vj.prototype.setDir=function(qZ){Pg(this.dir,qZ),this.dirEnum=qZ};var fP=0,Dv=1,em=2,lR=3,zF=4,sQ=5,vF=6,Da;vj.prototype.getStepSizeFromTable=(Da="1111111111111111"+"0111111111111111"+"1111211111112111"+"0110110101101101"+"0101010101010101"+"1111111111111111"+"1111111121111111"+"1111211111112111"+"1111111121111111"+"1111211112111121"+"0110110110110111"+"0110101011010101"+"1111211111112111"+"1111211112111121"+"1121112111211121"+"1111211112111121"+"1121112111211121"+"0111011101110111"+"0110110101101101"+"1121112111211121"+"1121121121121121"+"1111211111112111"+"1111211112111121"+"0000000000000000"+"0000000000000000"+"0110110101101101"+"1121112111211121"+"1121121121121121",function(qZ,bK){var cx;if(qZ<1)return;else if(qZ==1)cx=0;else if(qZ>=2&&qZ<=4)cx=1;else if(qZ>=5&&qZ<=20)cx=2;else if(qZ>=21)cx=3;return Da[cx*7*16+bK*16+this.frames%16]}),vj.prototype.update=function(qZ){var bK=this.getNumSteps();if(qZ>=bK)return;this.steps+=this.step(),this.steer()};var IC=0,NH=1,G=2,WD=3,rY=4,qA=5,Ga=function(){vj.apply(this),this.randomScatter=false,this.faceDirEnum=this.dirEnum},Lc,bw;Ga.prototype=qZ(vj.prototype),Ga.prototype.getBounceY=(Lc={},Lc[eI]=[-4,-2,0,2,4,3,2,3],Lc[oc]=[3,5,7,5,4,5,7,8],Lc[vZ]=[2,3,3,4,3,2,2,2],Lc[mW]=[2,2,3,4,3,3,2,2],function(qZ,bK,cx){if(qZ==void 0)qZ=this.pixel.x;if(bK==void 0)bK=this.pixel.y;if(cx==void 0)cx=this.dirEnum;if(this.mode!=IC||!this.scared||De!=gO)return bK;var Rr=this.getTilePixel({x:qZ,y:bK}),Lz=Math.floor(bK/jn),wv=Lz*jn;if(cx==eI||cx==oc)wv+=Lc[cx][Rr.y];else wv+=Lc[cx][Rr.x];return wv}),Ga.prototype.getAnimFrame=function(qZ){if(qZ==void 0)qZ=this.frames;return Math.floor(qZ/8)%2},Ga.prototype.reset=function(){this.sigReverse=false,this.sigLeaveHome=false,this.mode=this.startMode,this.scared=false,cx.ghostReset(),this.savedSigReverse={},this.savedSigLeaveHome={},this.savedMode={},this.savedScared={},this.savedElroy={},this.savedFaceDirEnum={},vj.prototype.reset.apply(this),this.faceDirEnum=this.dirEnum},Ga.prototype.save=function(qZ){if(this.savedSigReverse[qZ]=this.sigReverse,this.savedSigLeaveHome[qZ]=this.sigLeaveHome,this.savedMode[qZ]=this.mode,this.savedScared[qZ]=this.scared,this==eP)this.savedElroy[qZ]=this.elroy;this.savedFaceDirEnum[qZ]=this.faceDirEnum,vj.prototype.save.call(this,qZ)},Ga.prototype.load=function(qZ){if(this.sigReverse=this.savedSigReverse[qZ],this.sigLeaveHome=this.savedSigLeaveHome[qZ],this.mode=this.savedMode[qZ],this.scared=this.savedScared[qZ],this==eP)this.elroy=this.savedElroy[qZ];this.faceDirEnum=this.savedFaceDirEnum[qZ],vj.prototype.load.call(this,qZ)},Ga.prototype.isSlowInTunnel=function(){if(De==pF||De==qN||De==gO)return qy<=3;else return true},Ga.prototype.getNumSteps=function(){var qZ=Dv;if(this.mode==G||this.mode==WD)return 2;else if(this.mode==qA||this.mode==rY)return this.getStepSizeFromTable(1,zF);else if(Rj.isTunnelTile(this.tile.x,this.tile.y)&&this.isSlowInTunnel())qZ=zF;else if(this.scared)qZ=lR;else if(this.elroy==1)qZ=sQ;else if(this.elroy==2)qZ=vF;return this.getStepSizeFromTable(qy?qy:1,qZ)},Ga.prototype.reverse=function(){this.sigReverse=true},Ga.prototype.goHome=function(){cx.silence(),cx.eatingGhost.play(),this.mode=NH},Ga.prototype.leaveHome=function(){this.playSounds(),this.sigLeaveHome=true},Ga.prototype.playSounds=function(){for(var qZ=0,bK=0,Rr=0;Rr<4;Rr++){if(sd[Rr].mode==IC)qZ++;if(sd[Rr].mode==G)bK++}if(bK>0)return cx.ghostNormalMove.stopLoop(),void cx.ghostReturnToHome.startLoop(true);else cx.ghostReturnToHome.stopLoop();if(qZ>0){if(!this.scared)cx.ghostNormalMove.startLoop(true)}else cx.ghostNormalMove.stopLoop()},Ga.prototype.onEnergized=function(){if(this.reverse(),this.mode!=G&&this.mode!=WD)this.scared=true,this.targetting=void 0},Ga.prototype.onEaten=function(){this.goHome(),this.scared=false},Ga.prototype.step=function(){return this.setPos(this.pixel.x+this.dir.x,this.pixel.y+this.dir.y),1},Ga.prototype.homeSteer=(bw={},bw[G]=function(){if(this.tile.x==Rj.doorTile.x&&this.tile.y==Rj.doorTile.y)if(this.faceDirEnum=oc,this.targetting=false,this.pixel.x==Rj.doorPixel.x)this.mode=WD,this.playSounds(),this.setDir(oc),this.faceDirEnum=this.dirEnum;else this.setDir(mW),this.faceDirEnum=this.dirEnum},bw[WD]=function(){if(this.pixel.y==Rj.homeBottomPixel){if(this.pixel.x==this.startPixel.x)this.setDir(eI),this.mode=this.arriveHomeMode;else this.setDir(this.startPixel.x<this.pixel.x?vZ:mW);this.faceDirEnum=this.dirEnum}},bw[rY]=function(){if(this.sigLeaveHome)if(this.sigLeaveHome=false,this.mode=qA,this.pixel.x==Rj.doorPixel.x)this.setDir(eI);else this.setDir(this.pixel.x<Rj.doorPixel.x?mW:vZ);else if(this.pixel.y==Rj.homeTopPixel)this.setDir(oc);else if(this.pixel.y==Rj.homeBottomPixel)this.setDir(eI);this.faceDirEnum=this.dirEnum},bw[qA]=function(){if(this.pixel.x==Rj.doorPixel.x){if(this.pixel.y==Rj.doorPixel.y)this.mode=IC,this.setDir(vZ);else this.setDir(eI);this.faceDirEnum=this.dirEnum}},function(){var qZ=bw[this.mode];if(qZ)qZ.apply(this)}),Ga.prototype.isScatterBrain=function(){var qZ=false;if(xA.getCommand()==dw)if(De==pF||De==gO)qZ=this==eP||this==QQ;else if(De==qN)qZ=true;return qZ},Ga.prototype.steer=function(){var qZ,bK,cx=So(this.dirEnum),Rr;if(this.homeSteer(),cx=So(this.dirEnum),this.mode!=IC&&this.mode!=G)return void(this.targetting=false);if(this.distToMid.x==0&&this.distToMid.y==0){if(this.sigReverse)this.faceDirEnum=cx,this.sigReverse=false;this.setDir(this.faceDirEnum)}else if(this.dirEnum==mW&&this.tilePixel.x==Hp.x+1||this.dirEnum==vZ&&this.tilePixel.x==Hp.x-1||this.dirEnum==eI&&this.tilePixel.y==Hp.y-1||this.dirEnum==oc&&this.tilePixel.y==Hp.y+1){var Lz={x:this.tile.x+this.dir.x,y:this.tile.y+this.dir.y};if(bK=ak(Lz,this.dirEnum),this.scared){qZ=Math.floor(Math.random()*4);while(!bK[qZ])qZ=(qZ+1)%4;this.targetting=false}else{if(this.mode==G)this.targetTile.x=Rj.doorTile.x,this.targetTile.y=Rj.doorTile.y;else if(!this.elroy&&xA.getCommand()==dw)Rr=this.isScatterBrain()?Af[Math.floor(Math.random()*4)]:this,this.targetTile.x=Rr.cornerTile.x,this.targetTile.y=Rr.cornerTile.y,this.targetting="corner";else this.setTarget();var wv=false;if(this.mode==G&&Rj.getExitDir){var Gw=Rj.getExitDir(Lz.x,Lz.y);if(Gw!=void 0&&Gw!=cx)wv=true,qZ=Gw}if(!wv){if(this.mode!=G)if(Rj.constrainGhostTurns)Rj.constrainGhostTurns(Lz,bK,this.dirEnum);qZ=lD(Lz,this.targetTile,bK)}}this.faceDirEnum=qZ}},Ga.prototype.getPathDistLeft=function(qZ,bK){var cx=jn,Rr=this.getTargetPixel();if(this.targetting=="pacman")if(bK==eI||bK==oc)cx=Math.abs(qZ.y-Rr.y);else cx=Math.abs(qZ.x-Rr.x);return cx},Ga.prototype.setTarget=function(){if(this.targetTile=this.getTargetTile(),this!=UK)this.targetting="pacman"};var Zd=function(){if(vj.apply(this),De==pF||De==gO)this.frames=1;this.nextDir={},this.lastMeal={x:-1,y:-1},this.ai=false,this.invincible=false,this.savedNextDirEnum={},this.savedStopped={},this.savedEatPauseFramesLeft={}},jw;Zd.prototype=qZ(vj.prototype),Zd.prototype.save=function(qZ){this.savedEatPauseFramesLeft[qZ]=this.eatPauseFramesLeft,this.savedNextDirEnum[qZ]=this.nextDirEnum,this.savedStopped[qZ]=this.stopped,vj.prototype.save.call(this,qZ)},Zd.prototype.load=function(qZ){this.eatPauseFramesLeft=this.savedEatPauseFramesLeft[qZ],this.setNextDir(this.savedNextDirEnum[qZ]),this.stopped=this.savedStopped[qZ],vj.prototype.load.call(this,qZ)},Zd.prototype.reset=function(){this.setNextDir(this.startDirEnum),this.stopped=false,this.inputDirEnum=void 0,this.eatPauseFramesLeft=0,vj.prototype.reset.apply(this)},Zd.prototype.setNextDir=function(qZ){Pg(this.nextDir,qZ),this.nextDirEnum=qZ},Zd.prototype.getNumSteps=function(){if(ao)return 2;var qZ=Qc.isActive()?em:fP;return this.getStepSizeFromTable(qy,qZ)},Zd.prototype.getStepFrame=function(qZ){if(qZ==void 0)qZ=this.steps;return Math.floor(qZ/2)%4},Zd.prototype.getAnimFrame=function(qZ){if(qZ==void 0)qZ=this.getStepFrame();if(De==pF||De==gO)if(qZ=(qZ+1)%4,LM==le)qZ=1;if(De!=qN)if(qZ==3)qZ=1;return qZ},Zd.prototype.setInputDir=function(qZ){this.inputDirEnum=qZ},Zd.prototype.clearInputDir=function(qZ){if(qZ==void 0||this.inputDirEnum==qZ)this.inputDirEnum=void 0},Zd.prototype.step=(jw=function(qZ){if(qZ<0)return-1;if(qZ>0)return 1;return 0},function(){if(!Rj)return this.setPos(this.pixel.x+this.dir.x,this.pixel.y+this.dir.y),1;var qZ=this.dir.x!=0?"x":"y",bK=this.dir.x!=0?"y":"x";if(this.stopped=this.stopped||this.distToMid[qZ]==0&&!pe(this.tile,this.dir),!this.stopped)this.pixel[qZ]+=this.dir[qZ],this.pixel[bK]+=jw(this.distToMid[bK]);return this.commitPos(),this.stopped?0:1}),Zd.prototype.steer=function(){if(this.ai){if(this.distToMid.x!=0||this.distToMid.y!=0)return;var qZ=ak(this.tile,this.dirEnum);this.setTarget(),this.setNextDir(lD(this.tile,this.targetTile,qZ))}else this.targetting=void 0;if(this.inputDirEnum==void 0){if(this.stopped)this.setDir(this.nextDirEnum)}else{var bK={};Pg(bK,this.inputDirEnum);var Rr=pe(this.tile,bK);if(Rr)this.setDir(this.inputDirEnum),this.setNextDir(this.inputDirEnum),this.stopped=false;else if(!this.stopped)this.setNextDir(this.inputDirEnum)}if(this.stopped)cx.eating.stopLoop(true)},Zd.prototype.update=function(qZ){var bK=this.getNumSteps();if(qZ>=bK)return;if(this.eatPauseFramesLeft>0){if(qZ==bK-1)this.eatPauseFramesLeft--;return}if(vj.prototype.update.call(this,qZ),Rj){var Rr=Rj.getTile(this.tile.x,this.tile.y);if(Rr=="."||Rr=="o"){if(this.lastMeal.x=this.tile.x,this.lastMeal.y=this.tile.y,!ao)this.eatPauseFramesLeft=Rr=="."?1:3;if(cx.eating.startLoop(true),Rj.onDotEat(this.tile.x,this.tile.y),Um.onDotEat(),fj.onDotEat(),UM(Rr=="."?10:50),Rr=="o")Qc.activate()}if(Rr==" "&&!(this.lastMeal.x==this.tile.x&&this.lastMeal.y==this.tile.y))cx.eating.stopLoop(true)}};var eP=new Ga;eP.name="blinky",eP.color="#FF0000",eP.pathColor="rgba(255,0,0,0.8)",eP.isVisible=true;var QQ=new Ga;QQ.name="pinky",QQ.color="#FFB8FF",QQ.pathColor="rgba(255,184,255,0.8)",QQ.isVisible=true;var eD=new Ga;eD.name="inky",eD.color="#00FFFF",eD.pathColor="rgba(0,255,255,0.8)",eD.isVisible=true;var UK=new Ga;UK.name="clyde",UK.color="#FFB851",UK.pathColor="rgba(255,184,81,0.8)",UK.isVisible=true;var wX=new Zd;wX.name="pacman",wX.color="#FFFF00",wX.pathColor="rgba(255,255,0,0.8)";var Af=[eP,QQ,eD,UK,wX],sd=[eP,QQ,eD,UK],ll=16,am;am=Hp.y,wX.pathCenter={x:0,y:0},eP.pathCenter={x:-2,y:-2},QQ.pathCenter={x:-1,y:-1},eD.pathCenter={x:1,y:1},UK.pathCenter={x:2,y:2},eP.getTargetTile=function(){return{x:wX.tile.x,y:wX.tile.y}},eP.getTargetPixel=function(){return{x:wX.pixel.x,y:wX.pixel.y}},eP.drawTarget=function(qZ){if(!this.targetting)return;if(qZ.fillStyle=this.color,this.targetting=="pacman")BA.drawCenterPixelSq(qZ,wX.pixel.x,wX.pixel.y,am);else BA.drawCenterTileSq(qZ,this.targetTile.x,this.targetTile.y,am)},QQ.getTargetTile=function(){var qZ=wX.tile.x+4*wX.dir.x,bK=wX.tile.y+4*wX.dir.y;if(wX.dirEnum==eI)qZ-=4;return{x:qZ,y:bK}},QQ.getTargetPixel=function(){var qZ=wX.pixel.x+4*wX.dir.x*jn,bK=wX.pixel.y+4*wX.dir.y*jn;if(wX.dirEnum==eI)qZ-=4*jn;return{x:qZ,y:bK}},QQ.drawTarget=function(qZ){if(!this.targetting)return;qZ.fillStyle=this.color;var bK=this.getTargetPixel();if(this.targetting=="pacman"){if(qZ.beginPath(),qZ.moveTo(wX.pixel.x,wX.pixel.y),wX.dirEnum==eI)qZ.lineTo(wX.pixel.x,bK.y);qZ.lineTo(bK.x,bK.y),qZ.stroke(),BA.drawCenterPixelSq(qZ,bK.x,bK.y,am)}else BA.drawCenterTileSq(qZ,this.targetTile.x,this.targetTile.y,am)},eD.getTargetTile=function(){var qZ=wX.tile.x+2*wX.dir.x,bK=wX.tile.y+2*wX.dir.y;if(wX.dirEnum==eI)qZ-=2;return{x:eP.tile.x+2*(qZ-eP.tile.x),y:eP.tile.y+2*(bK-eP.tile.y)}},eD.getJointPixel=function(){var qZ=wX.pixel.x+2*wX.dir.x*jn,bK=wX.pixel.y+2*wX.dir.y*jn;if(wX.dirEnum==eI)qZ-=2*jn;return{x:qZ,y:bK}},eD.getTargetPixel=function(){var qZ=wX.pixel.x+2*wX.dir.x*jn,bK=wX.pixel.y+2*wX.dir.y*jn;if(wX.dirEnum==eI)qZ-=2*jn;return{x:eP.pixel.x+2*(qZ-eP.pixel.x),y:eP.pixel.y+2*(bK-eP.pixel.y)}},eD.drawTarget=function(qZ){if(!this.targetting)return;var bK,cx=this.getJointPixel();if(this.targetting=="pacman"){if(bK=this.getTargetPixel(),qZ.beginPath(),qZ.moveTo(wX.pixel.x,wX.pixel.y),wX.dirEnum==eI)qZ.lineTo(wX.pixel.x,cx.y);qZ.lineTo(cx.x,cx.y),qZ.moveTo(eP.pixel.x,eP.pixel.y),qZ.lineTo(bK.x,bK.y),qZ.closePath(),qZ.stroke(),qZ.beginPath(),qZ.arc(cx.x,cx.y,2,0,Math.PI*2),qZ.fillStyle=qZ.strokeStyle,qZ.fill(),qZ.fillStyle=this.color,BA.drawCenterPixelSq(qZ,bK.x,bK.y,am)}else qZ.fillStyle=this.color,BA.drawCenterTileSq(qZ,this.targetTile.x,this.targetTile.y,am)},UK.getTargetTile=function(){var qZ=wX.tile.x-(this.tile.x+this.dir.x),bK=wX.tile.y-(this.tile.y+this.dir.y),cx=qZ*qZ+bK*bK;if(cx>=64)return this.targetting="pacman",{x:wX.tile.x,y:wX.tile.y};else return this.targetting="corner",{x:this.cornerTile.x,y:this.cornerTile.y}},UK.getTargetPixel=function(){return{x:wX.pixel.x,y:wX.pixel.y}},UK.drawTarget=function(qZ){if(!this.targetting)return;if(qZ.fillStyle=this.color,this.targetting=="pacman"){if(qZ.beginPath(),true)qZ.arc(wX.pixel.x,wX.pixel.y,jn*8,0,2*Math.PI),qZ.closePath();else{qZ.moveTo(wX.pixel.x,wX.pixel.y);var bK=UK.pixel.x-wX.pixel.x,cx=UK.pixel.y-wX.pixel.y,Rr=Math.sqrt(bK*bK+cx*cx);bK=bK/Rr*jn*8,cx=cx/Rr*jn*8,qZ.lineTo(wX.pixel.x+bK,wX.pixel.y+cx)}qZ.stroke(),BA.drawCenterPixelSq(qZ,wX.pixel.x,wX.pixel.y,am)}else{if(xA.getCommand()==II)qZ.beginPath(),qZ.arc(wX.pixel.x,wX.pixel.y,jn*8,0,2*Math.PI),qZ.strokeStyle="rgba(255,255,255,0.25)",qZ.stroke();BA.drawCenterTileSq(qZ,this.targetTile.x,this.targetTile.y,am)}},wX.setTarget=function(){if(eP.mode==G||eP.scared)this.targetTile.x=QQ.tile.x,this.targetTile.y=QQ.tile.y,this.targetting="pinky";else this.targetTile.x=QQ.tile.x+2*(wX.tile.x-QQ.tile.x),this.targetTile.y=QQ.tile.y+2*(wX.tile.y-QQ.tile.y),this.targetting="flee"},wX.drawTarget=function(qZ){if(!this.ai)return;var bK,cx;if(qZ.fillStyle=this.color,this.targetting=="flee")bK=wX.pixel.x-QQ.pixel.x,cx=wX.pixel.y-QQ.pixel.y,bK=QQ.pixel.x+2*bK,cx=QQ.pixel.y+2*cx,qZ.beginPath(),qZ.moveTo(QQ.pixel.x,QQ.pixel.y),qZ.lineTo(bK,cx),qZ.closePath(),qZ.stroke(),BA.drawCenterPixelSq(qZ,bK,cx,am);else BA.drawCenterPixelSq(qZ,QQ.pixel.x,QQ.pixel.y,am)},wX.getPathDistLeft=function(qZ,bK){var cx=jn,Rr,Lz;if(this.targetting=="pinky")if(bK==eI||bK==oc)cx=Math.abs(qZ.y-QQ.pixel.y);else cx=Math.abs(qZ.x-QQ.pixel.x);else if(Rr=wX.pixel.x-QQ.pixel.x,Lz=wX.pixel.y-QQ.pixel.y,Rr=QQ.pixel.x+2*Rr,Lz=QQ.pixel.y+2*Lz,bK==eI||bK==oc)cx=Math.abs(Lz-qZ.y);else cx=Math.abs(Rr-qZ.x);return cx};var II=0,dw=1,xA=(XJ=function(){var qZ,bK=[{},{},{}];return bK[0][qZ=7*60]=II,bK[0][qZ+=20*60]=dw,bK[0][qZ+=7*60]=II,bK[0][qZ+=20*60]=dw,bK[0][qZ+=5*60]=II,bK[0][qZ+=20*60]=dw,bK[0][qZ+=5*60]=II,bK[1][qZ=7*60]=II,bK[1][qZ+=20*60]=dw,bK[1][qZ+=7*60]=II,bK[1][qZ+=20*60]=dw,bK[1][qZ+=5*60]=II,bK[1][qZ+=1033*60]=dw,bK[1][qZ+=1]=II,bK[2][qZ=5*60]=II,bK[2][qZ+=20*60]=dw,bK[2][qZ+=5*60]=II,bK[2][qZ+=20*60]=dw,bK[2][qZ+=5*60]=II,bK[2][qZ+=1037*60]=dw,bK[2][qZ+=1]=II,function(qZ){var cx;if(qy==1)cx=0;else if(qy>=2&&qy<=4)cx=1;else cx=2;var Rr=bK[cx][qZ];if(De==AA)return Rr;else if(qZ<=27*60)if(Rr!=void 0)return II}}(),Fn={},tb={},BT=function(qZ){Fn[qZ]=XU,tb[qZ]=vw},GO=function(qZ){XU=Fn[qZ],vw=tb[qZ]},{save:BT,load:GO,reset:function(){vw=dw,XU=0},update:function(){var qZ;if(!Qc.isActive()){if(qZ=XJ(XU),qZ!=void 0)for(vw=qZ,i=0;i<4;i++)sd[i].reverse();XU++}},getCommand:function(){return vw},setCommand:function(qZ){vw=qZ}}),XJ,XU,vw,Fn,tb,BT,GO,Um=function(){var qZ=0,bK=1,cx=1,Rr=2,Lz=3,wv=function(){return qy<5?4*60:3*60},Gw={};Gw[cx]=function(){return 0},Gw[Rr]=function(){return qy==1?30:0},Gw[Lz]=function(){if(qy==1)return 60;if(qy==2)return 50;return 0};var AA={},pF,gO;AA[cx]=7,AA[Rr]=17,AA[Lz]=32;var qN={},Yl,ao={},De={},TS={},ty=function(wv){if(De[wv]=pF,gO==bK)ao[wv]=Yl;else if(gO==qZ)TS[wv]={},TS[wv][cx]=qN[cx],TS[wv][Rr]=qN[Rr],TS[wv][Lz]=qN[Lz]},qK=function(wv){if(pF=De[wv],gO==bK)Yl=ao[wv];else if(gO==qZ)qN[cx]=TS[wv][cx],qN[Rr]=TS[wv][Rr],qN[Lz]=TS[wv][Lz]};return{save:ty,load:qK,onNewLevel:function(){gO=qZ,pF=0,qN[cx]=0,qN[Rr]=0,qN[Lz]=0},onRestartLevel:function(){gO=bK,pF=0,Yl=0},onDotEat:function(){var qZ;if(pF=0,gO==bK)Yl++;else for(qZ=1;qZ<4;qZ++)if(sd[qZ].mode==rY){qN[qZ]++;break}},update:function(){var ao;if(gO==qZ){for(i=1;i<4;i++)if(ao=sd[i],ao.mode==rY){if(qN[i]>=Gw[i]())return void ao.leaveHome();break}}else if(gO==bK)if(Yl==AA[cx]&&QQ.mode==rY)return void QQ.leaveHome();else if(Yl==AA[Rr]&&eD.mode==rY)return void eD.leaveHome();else if(Yl==AA[Lz]&&UK.mode==rY)return Yl=0,gO=qZ,void UK.leaveHome();if(pF>wv()){for(pF=0,i=1;i<4;i++)if(ao=sd[i],ao.mode==rY){ao.leaveHome();break}}else pF++}}}(),Sv=function(){var qZ=(bK=[[20,30,40,40,40,50,50,50,60,60,60,70,70,70,100,100,100,100,120,120,120],[10,15,20,20,20,25,25,25,30,30,30,40,40,40,50,50,50,50,60,60,60]],function(qZ){var cx=qy;if(cx>21)cx=21;var Rr=244;return Rr-bK[qZ-1][cx-1]}),bK,cx,Rr={},Lz=function(qZ){Rr[qZ]=cx},wv=function(qZ){cx=Rr[qZ]};return{onNewLevel:function(){cx=false},onRestartLevel:function(){cx=true},update:function(){if(cx&&UK.mode!=rY)cx=false;if(cx)eP.elroy=0;else if(Rj.dotsEaten>=qZ(2))eP.elroy=2;else if(Rj.dotsEaten>=qZ(1))eP.elroy=1;else eP.elroy=0},save:Lz,load:wv}}(),Qc=function(){var qZ=1,bK=(Rr=[6,5,4,3,2,5,2,2,1,5,2,1,1,3,1,1,0,1],function(){var qZ=qy;return qZ>18?0:60*Rr[qZ-1]}),Rr,Lz=(wv=[5,5,5,5,5,5,5,5,3,5,5,3,3,5,3,3,0,3],function(){var qZ=qy;return qZ>18?0:wv[qZ-1]}),wv,Gw=14,AA,pF,gO,qN,Yl={},ao={},De={},TS={},ty=function(qZ){Yl[qZ]=AA,ao[qZ]=pF,De[qZ]=gO,TS[qZ]=qN},qK=function(qZ){AA=Yl[qZ],pF=ao[qZ],gO=De[qZ],qN=TS[qZ]};return{save:ty,load:qK,reset:function(){for(cx.ghostTurnToBlue.stopLoop(),AA=0,pF=false,gO=100,qN=0,i=0;i<4;i++)sd[i].scared=false},update:function(){var qZ;if(pF)if(AA==bK())this.reset();else AA++},activate:function(){for(cx.ghostNormalMove.stopLoop(),cx.ghostTurnToBlue.startLoop(),pF=true,AA=0,gO=100,i=0;i<4;i++)sd[i].onEnergized();if(bK()==0)this.reset()},isActive:function(){return pF},isFlash:function(){var qZ=Math.floor((bK()-AA)/Gw);return qZ<=2*Lz()-1?qZ%2==0:false},getPoints:function(){return gO},addPoints:function(){UM(gO*=2),qN=qZ*60},showingPoints:function(){return qN>0},updatePointsTimer:function(){if(qN>0)qN--}}}(),tn=function(){this.pixel={x:0,y:0},this.fruitHistory={},this.scoreDuration=2,this.scoreFramesLeft,this.savedScoreFramesLeft={}};tn.prototype={isScorePresent:function(){return this.scoreFramesLeft>0},onNewLevel:function(){this.buildFruitHistory()},setCurrentFruit:function(qZ){this.currentFruitIndex=qZ},onDotEat:function(){if(!this.isPresent()&&(Rj.dotsEaten==this.dotLimit1||Rj.dotsEaten==this.dotLimit2))this.initiate()},save:function(qZ){this.savedScoreFramesLeft[qZ]=this.scoreFramesLeft},load:function(qZ){this.scoreFramesLeft=this.savedScoreFramesLeft[qZ]},reset:function(){this.scoreFramesLeft=0},getCurrentFruit:function(){return this.fruits[this.currentFruitIndex]},getPoints:function(){return this.getCurrentFruit().points},update:function(){if(this.scoreFramesLeft>0)this.scoreFramesLeft--},isCollide:function(){return Math.abs(wX.pixel.y-this.pixel.y)<=Hp.y&&Math.abs(wX.pixel.x-this.pixel.x)<=Hp.x},testCollide:function(){if(this.isPresent()&&this.isCollide())UM(this.getPoints()),cx.silence(true),cx.eatingFruit.play(),setTimeout(sd[0].playSounds,500),this.reset(),this.scoreFramesLeft=this.scoreDuration*60}};var ld=function(){tn.call(this),this.fruits=[{name:"cherry",points:100},{name:"strawberry",points:300},{name:"orange",points:500},{name:"apple",points:700},{name:"melon",points:1e3},{name:"galaxian",points:2e3},{name:"bell",points:3e3},{name:"key",points:5e3}],this.order=[0,1,2,2,3,3,4,4,5,5,6,6,7],this.dotLimit1=70,this.dotLimit2=170,this.duration=9,this.framesLeft,this.savedFramesLeft={}};ld.prototype=qZ(tn.prototype,{onNewLevel:function(){this.setCurrentFruit(this.getFruitIndexFromLevel(qy)),tn.prototype.onNewLevel.call(this)},getFruitFromLevel:function(qZ){return this.fruits[this.getFruitIndexFromLevel(qZ)]},getFruitIndexFromLevel:function(qZ){if(qZ>13)qZ=13;return this.order[qZ-1]},buildFruitHistory:function(){var qZ;for(this.fruitHistory={},qZ=1;qZ<=qy;qZ++)this.fruitHistory[qZ]=this.fruits[this.getFruitIndexFromLevel(qZ)]},initiate:function(){var qZ=13,bK=20;this.pixel.x=jn*(1+qZ)-1,this.pixel.y=jn*bK+Hp.y,this.framesLeft=60*this.duration},isPresent:function(){return this.framesLeft>0},reset:function(){tn.prototype.reset.call(this),this.framesLeft=0},update:function(){if(tn.prototype.update.call(this),this.framesLeft>0)this.framesLeft--},save:function(qZ){tn.prototype.save.call(this,qZ),this.savedFramesLeft[qZ]=this.framesLeft},load:function(qZ){tn.prototype.load.call(this,qZ),this.framesLeft=this.savedFramesLeft[qZ]}});var WE=0,vy=1,VN=2,iR=function(){tn.call(this),this.fruits=[{name:"cherry",points:100},{name:"strawberry",points:200},{name:"orange",points:500},{name:"pretzel",points:700},{name:"apple",points:1e3},{name:"pear",points:2e3},{name:"banana",points:5e3}],this.dotLimit1=64,this.dotLimit2=176,this.pen_path="<<<<<<^^^^^^>>>>>>>>>vvvvvv<<",this.savedIsPresent={},this.savedPixel={},this.savedPathMode={},this.savedFrame={},this.savedNumFrames={},this.savedPath={}},nd,cp,Yw,SI,hp,aU,kR,vp,Wf,fj;iR.prototype=qZ(tn.prototype,{shouldRandomizeFruit:function(){return qy>7},getFruitFromLevel:function(qZ){if(qZ<=7)return this.fruits[qZ-1];else return},onNewLevel:function(){if(!this.shouldRandomizeFruit())this.setCurrentFruit(qy-1);else this.setCurrentFruit(0);tn.prototype.onNewLevel.call(this)},buildFruitHistory:function(){var qZ;for(this.fruitHistory={},qZ=1;qZ<=Math.max(qy,7);qZ++)this.fruitHistory[qZ]=this.fruits[qZ-1]},reset:function(){tn.prototype.reset.call(this),this.frame=0,this.numFrames=0,this.path=void 0},initiatePath:function(qZ){this.frame=0,this.numFrames=qZ.length*16,this.path=qZ},initiate:function(){if(this.shouldRandomizeFruit())this.setCurrentFruit(Gw(0,6));var qZ=Rj.fruitPaths.entrances,bK=qZ[Gw(0,qZ.length-1)];this.initiatePath(bK.path),this.pathMode=WE,this.pixel.x=bK.start.x,this.pixel.y=bK.start.y},isPresent:function(){return this.frame<this.numFrames},bounceFrames:(nd={dx:0,dy:-1},cp={dx:0,dy:1},Yw={dx:-1,dy:0},SI={dx:1,dy:0},hp={dx:-1,dy:-1},aU={dx:1,dy:-1},kR={dx:-1,dy:1},vp={dx:1,dy:1},Wf={dx:0,dy:0},{"^":[nd,nd,nd,nd,nd,nd,nd,nd,nd,Wf,nd,Wf,Wf,cp,Wf,cp],">":[Wf,aU,Wf,SI,Wf,aU,Wf,SI,Wf,SI,Wf,SI,Wf,vp,vp,Wf],"<":[Wf,Wf,hp,Wf,Yw,Wf,hp,Wf,Yw,Wf,Yw,Wf,Yw,Wf,kR,kR],v:[Wf,cp,cp,cp,cp,cp,cp,cp,cp,cp,cp,cp,nd,nd,Wf,nd]}),move:function(){var qZ=this.path[Math.floor(this.frame/16)],bK=this.bounceFrames[qZ][this.frame%16];this.pixel.x+=bK.dx,this.pixel.y+=bK.dy,this.frame++},setNextPath:function(){if(this.pathMode==WE)this.pathMode=vy,this.initiatePath(this.pen_path);else if(this.pathMode==vy){this.pathMode=VN;var qZ=Rj.fruitPaths.exits,bK=qZ[Gw(0,qZ.length-1)];this.initiatePath(bK.path)}else if(this.pathMode==VN)this.reset()},update:function(){if(tn.prototype.update.call(this),this.isPresent())if(this.move(),this.frame==this.numFrames)this.setNextPath()},save:function(qZ){tn.prototype.save.call(this,qZ),this.savedPixel[qZ]=this.isPresent()?{x:this.pixel.x,y:this.pixel.y}:void 0,this.savedPathMode[qZ]=this.pathMode,this.savedFrame[qZ]=this.frame,this.savedNumFrames[qZ]=this.numFrames,this.savedPath[qZ]=this.path},load:function(qZ){if(tn.prototype.load.call(this,qZ),this.savedPixel[qZ])this.pixel.x=this.savedPixel[qZ].x,this.pixel.y=this.savedPixel[qZ].y;this.pathMode=this.savedPathMode[qZ],this.frame=this.savedFrame[qZ],this.numFrames=this.savedNumFrames[qZ],this.path=this.savedPath[qZ]}});var jR=(fv=new ld,ix=new iR,fj=fv,function(){if(De==AA)fj=fv;else fj=ix}),fv,ix,EC=function(){var qZ=1e3/60,bK,cx=false,Rr=false,Lz;(function(){for(var qZ=0,bK=["ms","moz","webkit","o"],cx=0;cx<bK.length&&!window.requestAnimationFrame;++cx)window.requestAnimationFrame=window[bK[cx]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[bK[cx]+"CancelAnimationFrame"]||window[bK[cx]+"CancelRequestAnimationFrame"];if(!window.requestAnimationFrame)window.requestAnimationFrame=function(bK,cx){var Rr=(new Date).getTime(),Lz=Math.max(0,16-(Rr-qZ)),wv=window.setTimeout((function(){bK(Rr+Lz)}),Lz);return qZ=Rr+Lz,wv};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(qZ){clearTimeout(qZ)}})();var wv=(Gw=60,AA=[],pF=0,gO=-1,qN=false,function(qZ){if(qN)pF=(pF+1)%Gw;if(gO=(gO+1)%Gw,gO==Gw-1)qN=true;AA[gO]=qZ;var bK=(qZ-AA[pF])/1e3,cx=gO-pF;if(cx<0)cx+=Gw;Lz=cx/bK}),Gw,AA,pF,gO,qN,Yl,ao=function(Rr){if(bK==void 0)bK=Rr;wv(Rr);var Lz=3;if(bK=Math.max(bK,Rr-Lz*qZ),cx||vB.isOpen())bK=Rr;FY.update();while(bK<Rr)LM.update(),bK+=qZ;if(BA.beginFrame(),LM.draw(),FY.isValidState())BA.renderFunc(FY.draw);BA.endFrame(),Yl=requestAnimationFrame(ao)};return{getFramePeriod:function(){return qZ},setUpdatesPerSecond:function(bK){qZ=1e3/bK,Gg.onFramePeriodChange()},init:function(){var qZ=this;window.addEventListener("focus",(function(){qZ.start()})),window.addEventListener("blur",(function(){qZ.stop()})),this.start()},start:function(){if(!Rr)Yl=requestAnimationFrame(ao),Rr=true},stop:function(){if(Rr)cancelAnimationFrame(Yl),Rr=false},togglePause:function(){cx=!cx},isPaused:function(){return cx},getFps:function(){return Lz}}}(),LM,XW=function(qZ,bK,Rr,Lz){if(LM=bK?vi(LM,qZ,bK,Rr,Lz):qZ,cx.silence(),LM.init(),EC.isPaused())EC.togglePause()},vi=function(qZ,bK,cx,Rr,Lz){var wv,Gw=Math.floor(cx/2),AA=function(){return wv<Gw},pF=function(){return wv/cx*2+(AA()?0:-1)},gO=false;return{init:function(){wv=0,gO=true},draw:function(){if(!gO)return;var cx=pF();if(wv<Gw){if(qZ)qZ.draw(),BA.setOverlayColor("rgba(0,0,0,"+cx+")")}else if(wv>Gw)bK.draw(),BA.setOverlayColor("rgba(0,0,0,"+(1-cx)+")")},update:function(){if(wv<Gw){if(Rr)qZ.update()}else if(wv==Gw)bK.init();else if(wv<cx){if(Lz)bK.update()}else LM=bK,gO=false;wv++}}},cY=(bB=function(qZ){XW(qZ),Je.disable()},Je=new gW("CHOOSE A GAME",2*jn,0*jn,oP-4*jn,3*jn,jn,jn+"px ArcadeR","#EEE"),gL=function(qZ){if(qZ=Math.floor(qZ/3)+1,qZ%=4,qZ==3)qZ=1;return qZ},du=function(qZ){return qZ=Math.floor(qZ/3),qZ%=4,qZ},Je.addTextIconButton(TS(AA),(function(){De=AA,bB(VA)}),(function(qZ,bK,cx,Rr){PP.drawPacmanSprite(qZ,bK,cx,mW,gL(Rr))})),Je.addTextIconButton(TS(pF),(function(){De=pF,bB(VA)}),(function(qZ,bK,cx,Rr){PP.drawMsPacmanSprite(qZ,bK,cx,mW,gL(Rr))})),Je.addTextIconButton(TS(gO),(function(){De=gO,bB(VA)}),(function(qZ,bK,cx,Rr){Ly(qZ,bK,cx,mW,gL(Rr),true)})),Je.addSpacer(.5),Je.addTextIconButton("LEARN",(function(){bB(eO)}),(function(qZ,bK,cx,Rr){PP.drawGhostSprite(qZ,bK,cx,Math.floor(Rr/8)%2,mW,false,false,false,eP.color)})),{init:function(){Je.enable(),cx.coffeeBreakMusic.startLoop()},draw:function(){BA.clearMapFrame(),BA.beginMapClip(),BA.renderFunc(Je.draw,Je),BA.endMapClip()},update:function(){Je.update()},getMenu:function(){return Je}}),bB,Je,gL,du,eO=function(){var qZ=function(qZ){XW(qZ),bK.disable(),ty((function(qZ){qZ.disable()})),SW(true),eT()},bK=new gW("LEARN",2*jn,-jn,oP-4*jn,3*jn,jn,jn+"px ArcadeR","#EEE");bK.addSpacer(7),bK.addTextButton("BACK",(function(){qZ(cY)})),bK.backButton=bK.buttons[bK.buttonCount-1],bK.noArrowKeys=true;var cx=jn,Rr=30,Lz=30,wv=oP/2-2*Rr-1.5*cx,Gw=4*jn,pF=new Zy(wv,Gw,Rr,Lz,(function(){SW(false),eP.isVisible=true,qK(eP,true)}));pF.setIcon((function(qZ,bK,cx,Rr){yH()(qZ,bK,cx,Math.floor(Rr/6)%2,oc,void 0,void 0,void 0,eP.color)})),wv+=Rr+cx;var gO=new Zy(wv,Gw,Rr,Lz,(function(){SW(false),qK(QQ,true)}));gO.setIcon((function(qZ,bK,cx,Rr){yH()(qZ,bK,cx,Math.floor(Rr/6)%2,oc,void 0,void 0,void 0,QQ.color)})),wv+=Rr+cx;var qN=new Zy(wv,Gw,Rr,Lz,(function(){SW(false),qK(eD,true)}));qN.setIcon((function(qZ,bK,cx,Rr){yH()(qZ,bK,cx,Math.floor(Rr/6)%2,oc,void 0,void 0,void 0,eD.color)})),wv+=Rr+cx;var TS=new Zy(wv,Gw,Rr,Lz,(function(){SW(false),qK(UK,true)}));TS.setIcon((function(qZ,bK,cx,Rr){yH()(qZ,bK,cx,Math.floor(Rr/6)%2,oc,void 0,void 0,void 0,UK.color)}));var ty=function(qZ){qZ(pF),qZ(gO),qZ(qN),qZ(TS)},qK=function(qZ,bK){qZ.isVisible=qZ.isDrawTarget=qZ.isDrawPath=bK},SW=function(qZ){qK(eP,qZ),qK(QQ,qZ),qK(eD,qZ),qK(UK,qZ)};return{init:function(){for(bK.enable(),ty((function(qZ){qZ.enable()})),Rj=Vu,BA.drawMap(),qy=1,Yl=false,ao=false,De=AA,xA.reset(),Qc.reset(),xA.setCommand(II),Um.onNewLevel(),Sv.onNewLevel(),i=0;i<4;i++){var qZ=Af[i];qZ.reset(),qZ.mode=IC}eP.setPos(14*jn-1,13*jn+Hp.y),QQ.setPos(15*jn+Hp.x,13*jn+Hp.y),eD.setPos(9*jn+Hp.x,16*jn+Hp.y),UK.setPos(18*jn+Hp.x,16*jn+Hp.y),wX.reset(),wX.setPos(14*jn-1,22*jn+Hp.y),pF.onclick()},draw:function(){BA.blitMap(),BA.renderFunc(bK.draw,bK),ty((function(qZ){BA.renderFunc(qZ.draw,qZ)})),BA.beginMapClip(),BA.drawPaths(),BA.drawActors(),BA.drawTargets(),BA.endMapClip()},update:function(){var qZ,cx;for(bK.update(),ty((function(qZ){qZ.update()})),cx=0;cx<2;cx++)for(wX.update(cx),qZ=0;qZ<4;qZ++)Af[qZ].update(cx);for(qZ=0;qZ<5;qZ++)Af[qZ].frames++},getMenu:function(){return bK}}}(),jd=function(){var qZ,bK,cx=function(){if(Yl.isSelected)qZ=TS(),bK=De==gO?"#47b8ff":wX.color;else if(ao.isSelected)qZ=xk()[0],bK=eP.color;else if(ty.isSelected)qZ=xk()[1],bK=QQ.color;else if(qK.isSelected)qZ=xk()[2],bK=eD.color;else if(SW.isSelected)qZ=xk()[3],bK=UK.color;else qZ=TS(),bK="#FFF"},Rr=20,Lz=30,wv=oP/2-3*Rr,Gw=3*jn,Yl=new Zy(wv,Gw,Rr,Lz,(function(){if(De==pF)De=qN;else if(De==qN)De=pF}));Yl.setIcon((function(qZ,bK,cx,Rr){Jz()(qZ,bK,cx,mW,wX.getAnimFrame(wX.getStepFrame(Math.floor((De==AA?Rr+4:Rr)/1.5))),true)})),wv+=2*Rr;var ao=new Zy(wv,Gw,Rr,Lz);ao.setIcon((function(qZ,bK,cx,Rr){yH()(qZ,bK,cx,Math.floor(Rr/6)%2,vZ,void 0,void 0,void 0,eP.color)})),wv+=Rr;var ty=new Zy(wv,Gw,Rr,Lz);ty.setIcon((function(qZ,bK,cx,Rr){yH()(qZ,bK,cx,Math.floor(Rr/6)%2,vZ,void 0,void 0,void 0,QQ.color)})),wv+=Rr;var qK=new Zy(wv,Gw,Rr,Lz);qK.setIcon((function(qZ,bK,cx,Rr){yH()(qZ,bK,cx,Math.floor(Rr/6)%2,vZ,void 0,void 0,void 0,eD.color)})),wv+=Rr;var SW=new Zy(wv,Gw,Rr,Lz);SW.setIcon((function(qZ,bK,cx,Rr){yH()(qZ,bK,cx,Math.floor(Rr/6)%2,vZ,void 0,void 0,void 0,UK.color)}));var eT=function(qZ){qZ(Yl),qZ(ao),qZ(ty),qZ(qK),qZ(SW)};return eT((function(qZ){qZ.borderBlurColor=qZ.borderFocusColor="#000"})),{init:function(){cx(),eT((function(qZ){qZ.enable()}))},shutdown:function(){eT((function(qZ){qZ.disable()}))},draw:function(){eT((function(qZ){BA.renderFunc(qZ.draw,qZ)})),cx(),BA.renderFunc((function(cx){cx.font=jn+"px ArcadeR",cx.fillStyle=bK,cx.textAlign="center",cx.textBaseline="top",cx.fillText(qZ,oP/2,jn)}))},update:function(){eT((function(qZ){qZ.update()}))},getYellowBtn:function(){return Yl}}}(),VA=function(){var qZ=function(qZ,cx){jd.shutdown(),bK.disable(),XW(qZ,cx)},bK=new gW("",2*jn,0,oP-4*jn,3*jn,jn,jn+"px ArcadeR","#EEE");return bK.addSpacer(2),bK.addTextButton("PLAY",(function(){Yl=false,ao=false,QJ.setStartLevel(1),qZ(QJ,60)})),bK.addTextButton("PLAY TURBO",(function(){Yl=false,ao=true,QJ.setStartLevel(1),qZ(QJ,60)})),bK.addTextButton("PRACTICE",(function(){Yl=true,ao=false,qZ(yl)})),bK.addSpacer(.5),bK.addTextButton("CUTSCENES",(function(){qZ(Jh)})),bK.addTextButton("ABOUT",(function(){qZ(gS)})),bK.addSpacer(.5),bK.addTextButton("BACK",(function(){qZ(cY)})),bK.backButton=bK.buttons[bK.buttonCount-1],{init:function(){cx.startMusic.play(),bK.enable(),jd.init(),Rj=void 0},draw:function(){BA.clearMapFrame(),BA.renderFunc(bK.draw,bK),jd.draw()},update:function(){jd.update()},getMenu:function(){return bK}}}(),yl=function(){var qZ,bK=4,cx=1,Rr=cx,Lz=function(bK,cx){jd.shutdown(),qZ.disable(),XW(bK,cx)},wv=function(qZ){RW.setAct(qZ),Lz(RW)},Gw=function(qZ){yl.setStartAct(qZ),Lz(yl)},AA=function(qZ,bK,cx,Rr){qZ.save(),qZ.translate(bK,cx),qZ.scale(1,Rr),qZ.beginPath(),qZ.moveTo(0,-jn/2),qZ.lineTo(jn,jn/2),qZ.lineTo(-jn,jn/2),qZ.closePath(),qZ.fillStyle="#FFF",qZ.fill(),qZ.restore()},pF=function(cx){var pF,gO;for(Rr=cx,qZ=new gW("",2*jn,0,oP-4*jn,3*jn,jn,jn+"px ArcadeR","#EEE"),qZ.addSpacer(2),qZ.addIconButton((function(qZ,bK,cx){AA(qZ,bK,cx,1)}),(function(){Gw(Math.max(1,cx-bK))})),pF=0;pF<bK;pF++)gO=jo(cx+pF),qZ.addTextIconButton("LEVELS "+gO[0]+"-"+gO[1],function(qZ){return function(){wv(cx+qZ)}}(pF),function(qZ){return function(bK,Rr,Lz){var wv=jn/3*2,Gw=jn/6;bK.save(),bK.translate(Rr,Lz),bK.beginPath(),bK.moveTo(-wv,0),bK.lineTo(-wv,-Gw),bK.quadraticCurveTo(-wv,-wv,-Gw,-wv),bK.lineTo(Gw,-wv),bK.quadraticCurveTo(wv,-wv,wv,-Gw),bK.lineTo(wv,Gw),bK.quadraticCurveTo(wv,wv,Gw,wv),bK.lineTo(-Gw,wv),bK.quadraticCurveTo(-wv,wv,-wv,Gw),bK.closePath();var AA=iK(cx+qZ);bK.fillStyle=AA.wallFillColor,bK.strokeStyle=AA.wallStrokeColor,bK.fill(),bK.stroke(),bK.restore()}}(pF));qZ.addIconButton((function(qZ,bK,cx){AA(qZ,bK,cx,-1)}),(function(){Gw(cx+bK)})),qZ.addTextButton("BACK",(function(){Lz(VA)})),qZ.backButton=qZ.buttons[qZ.buttonCount-1],qZ.enable()};return{init:function(){pF(Rr),jd.init()},setStartAct:function(qZ){Rr=qZ},draw:function(){BA.clearMapFrame(),BA.renderFunc(qZ.draw,qZ),jd.draw()},update:function(){jd.update()},getMenu:function(){return qZ}}}(),RW=function(){var qZ,bK=1,cx=function(bK,cx){jd.shutdown(),qZ.disable(),XW(bK,cx)},Rr=function(qZ){QJ.setStartLevel(qZ),cx(QJ,60)},Lz=function(bK){var Lz=jo(bK),wv;if(qZ=new gW("",2*jn,0,oP-4*jn,3*jn,jn,jn+"px ArcadeR","#EEE"),qZ.addSpacer(2),Lz[0]<Lz[1])for(wv=Lz[0];wv<=Lz[1];wv++)qZ.addTextIconButton("LEVEL "+wv,function(qZ){return function(){Rr(qZ)}}(wv),function(qZ){return function(bK,cx,Rr){var Lz=fj.getFruitFromLevel(qZ);if(Lz)PP.drawFruitSprite(bK,cx,Rr,Lz.name)}}(wv));qZ.addSpacer(.5),qZ.addTextButton("BACK",(function(){cx(yl)})),qZ.backButton=qZ.buttons[qZ.buttonCount-1],qZ.enable()};return{init:function(){jR(),Lz(bK),jd.init()},setAct:function(qZ){bK=qZ},draw:function(){BA.clearMapFrame(),BA.renderFunc(qZ.draw,qZ),jd.draw()},update:function(){jd.update()},getMenu:function(){return qZ}}}(),gS=function(){var qZ=function(qZ,cx){jd.shutdown(),bK.disable(),XW(qZ,cx)},bK=new gW("",2*jn,0,oP-4*jn,3*jn,jn,jn+"px ArcadeR","#EEE"),cx,Rr;bK.addSpacer(8),bK.addTextButton("BACK",(function(){qZ(VA)})),bK.backButton=bK.buttons[bK.buttonCount-1];var Lz=function(qZ){qZ.font=jn+"px ArcadeR",qZ.fillStyle="#FFF",qZ.textBaseline="top",qZ.textAlign="center";var bK=12*jn,Lz;for(Lz=0;Lz<Rr;Lz++)qZ.fillText(cx[Lz],14*jn,bK+Lz*2*jn)};return{init:function(){bK.enable(),jd.init()},draw:function(){BA.clearMapFrame(),BA.renderFunc(bK.draw,bK),jd.draw(),cx=qK(),Rr=cx.length,BA.renderFunc(Lz)},update:function(){jd.update()},getMenu:function(){return bK}}}(),Jh=function(){var qZ=function(qZ,bK){jd.shutdown(),cx.disable(),XW(qZ,bK)},bK=function(qZ){if(qZ)jd.shutdown(),cx.disable(),HE(qZ,Jh)},cx=new gW("",2*jn,0,oP-4*jn,3*jn,jn,jn+"px ArcadeR","#EEE");return cx.addSpacer(2),cx.addTextButton("CUTSCENE 1",(function(){bK(ib[De][0])})),cx.addTextButton("CUTSCENE 2",(function(){bK(ib[De][1])})),cx.addTextButton("CUTSCENE 3",(function(){bK(ib[De][2])})),cx.addSpacer(),cx.addTextButton("BACK",(function(){qZ(VA)})),cx.backButton=cx.buttons[cx.buttonCount-1],{init:function(){cx.enable(),jd.init(),qy=0},draw:function(){BA.clearMapFrame(),BA.renderFunc(cx.draw,cx),jd.draw()},update:function(){jd.update()},getMenu:function(){return cx}}}(),gr=function(){var qZ=function(qZ){XW(qZ),bK.disable()},bK=new gW("",2*jn,Ab-6*jn,oP-4*jn,3*jn,jn,jn+"px ArcadeR","#EEE");bK.addTextButton("BACK",(function(){qZ(cY)})),bK.backButton=bK.buttons[bK.buttonCount-1];var cx=0,Rr={},Lz;(function(){for(var qZ=-1.5*jn,bK=-1*jn,cx=18*jn,wv=29*jn,Gw=3,AA=0,pF=qZ,gO=bK,qN=function(qZ,bK){Rr[AA++]={x:qZ,y:bK}};gO<bK+wv;gO+=Gw)qN(pF,gO);for(;pF<qZ+cx;pF+=Gw)qN(pF,gO);for(;gO>bK;gO-=Gw)qN(pF,gO);for(;pF>qZ;pF-=Gw)qN(pF,gO);Lz=AA})();var wv=function(qZ){qZ.fillStyle="#555";var bK,wv,Gw=2;for(bK=0;bK<Lz;bK++)wv=Rr[bK],qZ.fillRect(wv.x,wv.y,Gw,Gw);for(qZ.fillStyle="#FFF",bK=0;bK<63;bK++)wv=Rr[(bK*4+Math.floor(cx/2))%Lz],qZ.fillRect(wv.x,wv.y,Gw,Gw);qZ.font=jn+"px ArcadeR",qZ.textBaseline="top",qZ.textAlign="right";var AA="#AAA",pF="#444",gO,qN;gO=9*jn,qN=0,qZ.fillStyle="#FFF",qZ.fillText("HIGH SCORES",gO+4*jn,qN),qN+=jn*4;var Yl=function(bK,cx){var Rr;for(qZ.lineWidth=1,qZ.lineCap="round",qZ.strokeStyle="rgba(255,255,255,0.5)",qZ.save(),qZ.translate(-2.5,0),Rr=-4;Rr<=4;Rr+=2)qZ.beginPath(),qZ.moveTo(bK+jn,cx+Rr),qZ.lineTo(bK+jn*(Math.random()*.5+1.5),cx+Rr),qZ.stroke();qZ.restore()};qZ.fillStyle=AA,qZ.fillText(IY[0],gO,qN),PP.drawPacmanSprite(qZ,gO+2*jn,qN+jn/2,vZ,1),qN+=jn*2,qZ.fillStyle=AA,qZ.fillText(IY[1],gO,qN),Yl(gO+2*jn,qN+jn/2),PP.drawPacmanSprite(qZ,gO+2*jn,qN+jn/2,vZ,1),qN+=jn*3,qZ.fillStyle=AA,qZ.fillText(IY[2],gO,qN),PP.drawMsPacmanSprite(qZ,gO+2*jn,qN+jn/2,vZ,1),qN+=jn*2,qZ.fillStyle=AA,qZ.fillText(IY[3],gO,qN),Yl(gO+2*jn,qN+jn/2),PP.drawMsPacmanSprite(qZ,gO+2*jn,qN+jn/2,vZ,1),qN+=jn*3,qZ.fillStyle=AA,qZ.fillText(IY[6],gO,qN),PP.drawOttoSprite(qZ,gO+2*jn,qN+jn/2,vZ,0),qN+=jn*2,qZ.fillStyle=AA,qZ.fillText(IY[7],gO,qN),Yl(gO+2*jn,qN+jn/2),PP.drawOttoSprite(qZ,gO+2*jn,qN+jn/2,vZ,0),qN+=jn*3,qZ.fillStyle=AA,qZ.fillText(IY[4],gO,qN),PP.drawCookiemanSprite(qZ,gO+2*jn,qN+jn/2,vZ,1),qN+=jn*2,qZ.fillStyle=AA,qZ.fillText(IY[5],gO,qN),Yl(gO+2*jn,qN+jn/2),PP.drawCookiemanSprite(qZ,gO+2*jn,qN+jn/2,vZ,1)},Gw=function(qZ){qZ.globalAlpha=.5,qZ.font=jn+"px sans-serif",qZ.textBaseline="middle",qZ.textAlign="left";var bK=20*jn,cx=0;qZ.fillStyle="#ffb8ae",qZ.fillRect(bK-1,cx-1.5,2,2),qZ.fillStyle="#FFF",qZ.fillText("10",bK+jn,cx),cx+=1.5*jn,qZ.fillStyle="#ffb8ae",qZ.beginPath(),qZ.arc(bK,cx-.5,jn/2,0,Math.PI*2),qZ.fill(),qZ.fillStyle="#FFF",qZ.fillText("50",bK+jn,cx),cx+=3*jn,PP.drawGhostSprite(qZ,bK,cx,0,mW,true),PP.drawGhostPoints(qZ,bK+2*jn,cx,200);var Rr=qZ.globalAlpha;cx+=2*jn,qZ.globalAlpha=Rr*.5,PP.drawGhostSprite(qZ,bK,cx,0,mW,true),qZ.globalAlpha=Rr,PP.drawGhostSprite(qZ,bK+2*jn,cx,0,mW,true),PP.drawGhostPoints(qZ,bK+4*jn,cx,400),cx+=2*jn,qZ.globalAlpha=Rr*.5,PP.drawGhostSprite(qZ,bK,cx,0,mW,true),PP.drawGhostSprite(qZ,bK+2*jn,cx,0,mW,true),qZ.globalAlpha=Rr,PP.drawGhostSprite(qZ,bK+4*jn,cx,0,mW,true),PP.drawGhostPoints(qZ,bK+6*jn,cx,800),cx+=2*jn,qZ.globalAlpha=Rr*.5,PP.drawGhostSprite(qZ,bK,cx,0,mW,true),PP.drawGhostSprite(qZ,bK+2*jn,cx,0,mW,true),PP.drawGhostSprite(qZ,bK+4*jn,cx,0,mW,true),qZ.globalAlpha=Rr,PP.drawGhostSprite(qZ,bK+6*jn,cx,0,mW,true),PP.drawGhostPoints(qZ,bK+8*jn,cx,1600);var Lz=[{name:"cherry",points:100},{name:"strawberry",points:200},{name:"orange",points:500},{name:"pretzel",points:700},{name:"apple",points:1e3},{name:"pear",points:2e3},{name:"banana",points:5e3}],wv=[{name:"cherry",points:100},{name:"strawberry",points:300},{name:"orange",points:500},{name:"apple",points:700},{name:"melon",points:1e3},{name:"galaxian",points:2e3},{name:"bell",points:3e3},{name:"key",points:5e3}],Gw,AA;for(cx+=3*jn,Gw=0;Gw<wv.length;Gw++)AA=wv[Gw],PP.drawFruitSprite(qZ,bK,cx,AA.name),PP.drawPacFruitPoints(qZ,bK+2*jn,cx,AA.points),cx+=2*jn;for(bK+=6*jn,cx=13.5*jn,Gw=0;Gw<Lz.length;Gw++)AA=Lz[Gw],PP.drawFruitSprite(qZ,bK,cx,AA.name),PP.drawMsPacFruitPoints(qZ,bK+2*jn,cx,AA.points),cx+=2*jn;qZ.globalAlpha=1};return{init:function(){bK.enable()},draw:function(){BA.clearMapFrame(),BA.renderFunc(wv),BA.renderFunc(Gw),BA.renderFunc(bK.draw,bK)},update:function(){bK.update(),cx++},getMenu:function(){return bK}}}(),Ie=function(){var qZ=function(qZ){XW(qZ),bK.disable()},bK=new gW("",2*jn,Ab-11*jn,oP-4*jn,3*jn,jn,jn+"px ArcadeR","#EEE");bK.addTextButton("GO TO PROJECT PAGE",(function(){window.open("https://github.com/shaunew/Pac-Man")})),bK.addTextButton("BACK",(function(){qZ(cY)})),bK.backButton=bK.buttons[bK.buttonCount-1];var cx=function(qZ){var bK,cx;qZ.font=jn+"px ArcadeR",qZ.textBaseline="top",qZ.textAlign="left",bK=2*jn,cx=0*jn,qZ.fillStyle="#0FF",qZ.fillText("DEVELOPER",bK,cx),cx+=jn*2,qZ.fillStyle="#777",qZ.fillText("SHAUN WILLIAMS",bK,cx),cx+=jn*4,qZ.fillStyle="#0FF",qZ.fillText("REVERSE-ENGINEERS",bK,cx),cx+=jn*2,qZ.fillStyle="#777",qZ.fillText("JAMEY PITTMAN",bK,cx),cx+=jn*2,qZ.fillText("BART GRANTHAM",bK,cx),cx+=jn*4,qZ.fillStyle="#FF0",qZ.fillText("PAC-MAN",bK,cx),cx+=jn*2,qZ.fillStyle="#777",qZ.fillText("NAMCO",bK,cx),cx+=jn*4,qZ.fillStyle="#FF0",qZ.fillText("MS. PAC-MAN / CRAZY OTTO",bK,cx),cx+=jn*2,qZ.fillStyle="#777",qZ.fillText("GENERAL COMPUTING",bK,cx)};return{init:function(){bK.enable(),qd.init()},draw:function(){BA.clearMapFrame(),BA.beginMapClip(),BA.renderFunc(qd.draw),BA.renderFunc(cx),BA.renderFunc(bK.draw,bK),BA.endMapClip()},update:function(){qd.update(),bK.update()},getMenu:function(){return bK}}}(),QJ=(qs=0,dC=1,{init:function(){eT(),BN=0,qy=dC-1,TM=Yl?1/0:3,gw(0),jR(),Te.init()},setStartLevel:function(qZ){dC=qZ},draw:function(){if(!Rj)return;BA.blitMap(),BA.drawScore(),BA.drawMessage("PLAYER ONE","#0FF",9,14),BA.drawReadyMessage()},update:function(){if(BN==qs*60)TM--,LM=Te,BA.drawMap();else BN++}}),BN,qs,dC,yv=function(){var qZ,bK=4;return{init:function(){var bK;for(cx.startMusic.play(),bK=0;bK<5;bK++)Af[bK].reset();xA.reset(),fj.reset(),Qc.reset(),Rj.resetTimeEaten(),qZ=0,Gg.init()},draw:function(){if(!Rj)return;BA.blitMap(),BA.drawScore(),BA.drawActors(),BA.drawReadyMessage()},update:function(){if(qZ==bK*60)XW(UP);else qZ++}}}(),Te=qZ(yv,{init:function(){if(qy++,De==AA)Rj=PG;else if(De==pF||De==qN)cM();else if(De==gO)hx();Rj.resetCurrent(),fj.onNewLevel(),BA.drawMap(),Um.onNewLevel(),Sv.onNewLevel(),yv.init.call(this)}}),x=qZ(yv,{init:function(){TM--,Um.onRestartLevel(),Sv.onRestartLevel(),BA.drawMap(),yv.init.call(this)}}),UP={init:function(){if(Yl)Gg.reset()},draw:function(){BA.setLevelFlash(false),BA.blitMap(),BA.drawScore(),BA.beginMapClip(),BA.drawFruit(),BA.drawPaths(),BA.drawActors(),BA.drawTargets(),BA.endMapClip()},isPacmanCollide:function(){var qZ,bK;for(qZ=0;qZ<4;qZ++)if(bK=sd[qZ],bK.tile.x==wX.tile.x&&bK.tile.y==wX.tile.y&&bK.mode==IC){if(bK.scared)Qc.addPoints(),bK.onEaten();else if(wX.invincible)continue;else XW(le);return true}return false},update:function(){if(Gg.isSeeking())Gg.seek();else{if(Gg.getMode()==Ko)Gg.record();var qZ,bK,Rr=2,Lz=false;if(Qc.showingPoints()){for(bK=0;bK<Rr;bK++)for(qZ=0;qZ<4;qZ++)if(sd[qZ].mode==G||sd[qZ].mode==WD)sd[qZ].update(bK);Qc.updatePointsTimer(),Lz=true}else{for(qZ=0;qZ<4;qZ++)if(sd[qZ].mode==NH)sd[qZ].mode=G,sd[qZ].targetting="door";sd[0].playSounds()}if(!Lz){for(Um.update(),xA.update(),Sv.update(),fj.update(),Qc.update(),bK=0;bK<Rr;bK++){if(wX.update(bK),fj.testCollide(),Rj.allDotsEaten()){XW(SG),cx.extend.play();break}if(this.isPacmanCollide())break;for(qZ=0;qZ<4;qZ++)Af[qZ].update(bK);if(this.isPacmanCollide())break}for(qZ=0;qZ<5;qZ++)Af[qZ].frames++}}}},Ks={init:function(){this.frames=0,this.triggerFrame=0;var qZ=this.triggers[0];this.drawFunc=qZ?qZ.draw:void 0,this.updateFunc=qZ?qZ.update:void 0},update:function(){var qZ=this.triggers[this.frames];if(qZ){if(qZ.init)qZ.init();this.drawFunc=qZ.draw,this.updateFunc=qZ.update,this.triggerFrame=0}if(this.updateFunc)this.updateFunc(this.triggerFrame);this.frames++,this.triggerFrame++},draw:function(){if(this.drawFunc)this.drawFunc(this.triggerFrame)}},Ml=qZ(Ks,{init:function(){Ks.init.call(this),this.savedFrames={},this.savedTriggerFrame={},this.savedDrawFunc={},this.savedUpdateFunc={}},save:function(qZ){this.savedFrames[qZ]=this.frames,this.savedTriggerFrame[qZ]=this.triggerFrame,this.savedDrawFunc[qZ]=this.drawFunc,this.savedUpdateFunc[qZ]=this.updateFunc},load:function(qZ){this.frames=this.savedFrames[qZ],this.triggerFrame=this.savedTriggerFrame[qZ],this.drawFunc=this.savedDrawFunc[qZ],this.updateFunc=this.savedUpdateFunc[qZ]},update:function(){if(Gg.isSeeking())Gg.seek();else{if(Gg.getMode()==Ko)Gg.record();Ks.update.call(this)}},draw:function(){if(this.drawFunc)Ks.draw.call(this)}}),le=(xd=function(){BA.blitMap(),BA.drawScore()},qZ(Ml,{triggers:{0:{init:function(){cx.die.play()},update:function(){var qZ;for(qZ=0;qZ<4;qZ++)Af[qZ].frames++},draw:function(){xd(),BA.beginMapClip(),BA.drawFruit(),BA.drawActors(),BA.endMapClip()}},60:{draw:function(){xd(),BA.beginMapClip(),BA.drawPlayer(),BA.endMapClip()}},120:{draw:function(qZ){xd(),BA.beginMapClip(),BA.drawDyingPlayer(qZ/75),BA.endMapClip()}},195:{draw:function(){xd(),BA.beginMapClip(),BA.drawDyingPlayer(1),BA.endMapClip()}},240:{draw:function(){xd(),BA.beginMapClip(),BA.drawDyingPlayer(1),BA.endMapClip()},init:function(){XW(TM==0?ea:x)}}}})),xd,SG=function(){var bK=function(){BA.blitMap(),BA.drawScore(),BA.beginMapClip(),BA.drawPlayer(),BA.endMapClip()},cx=function(qZ){BA.setLevelFlash(qZ),bK()};return qZ(Ml,{triggers:{0:{draw:function(){BA.setLevelFlash(false),BA.blitMap(),BA.drawScore(),BA.beginMapClip(),BA.drawFruit(),BA.drawActors(),BA.drawTargets(),BA.endMapClip()}},120:{draw:function(){cx(true)}},132:{draw:function(){cx(false)}},144:{draw:function(){cx(true)}},156:{draw:function(){cx(false)}},168:{draw:function(){cx(true)}},180:{draw:function(){cx(false)}},192:{draw:function(){cx(true)}},204:{draw:function(){cx(false)}},216:{init:function(){if(!UJ())XW(Te,60)}}}})}(),ea=function(){var qZ;return{init:function(){qZ=0},draw:function(){BA.blitMap(),BA.drawScore(),BA.drawMessage("GAME  OVER","#F00",9,20)},update:function(){if(qZ==120)XW(cY,60);else qZ++}}}();(function(){var qZ=function(){this.listeners={}};qZ.prototype={add:function(qZ,bK,cx){this.listeners[qZ]=this.listeners[qZ]||[],this.listeners[qZ].push({isActive:cx,callback:bK})},exec:function(qZ,bK){var cx=this.listeners[qZ],Rr,Lz;if(!cx)return;var wv=cx.length;for(Rr=0;Rr<wv;Rr++)if(Lz=cx[Rr],!Lz.isActive||Lz.isActive())if(bK.preventDefault(),Lz.callback())break}};var bK=new qZ,cx=new qZ,Rr=function(qZ,cx,Rr){bK.add(qZ,cx,Rr)},Lz=function(qZ,bK,Rr){cx.add(qZ,bK,Rr)},wv={};window.addEventListener("keydown",(function(qZ){var cx=(qZ||window.event).keyCode;if(!wv[cx])wv[cx]=true,bK.exec(cx,qZ)})),window.addEventListener("keyup",(function(qZ){var bK=(qZ||window.event).keyCode;wv[bK]=false,cx.exec(bK,qZ)}));var Gw=13,AA=27,pF=37,gO=39,qN=38,De=40,TS=16,ty=17,qK=18,SW=32,xk=77,yH=78,Jz=81,eT=87,Gs=69,Rg=82,qy=84,TM=65,pg=83,IF=68,SO=70,bj=71,na=73,sx=79,Qe=80,yB=49,IY=50,xu=35,UM,Zq=function(){if(UM=LM.getMenu&&LM.getMenu(),!UM&&vB.isOpen())UM=vB.getMenu();return UM};Rr(AA,(function(){return UM.backButton&&UM.backButton.onclick(),true}),Zq),Rr(Gw,(function(){UM.clickCurrentOption()}),Zq);var gw=function(){var qZ=Zq();return qZ&&!qZ.noArrowKeys};Rr(qN,(function(){UM.selectPrevOption()}),gw),Rr(De,(function(){UM.selectNextOption()}),gw);var EG=function(){return FY.isValidState()&&!vB.isOpen()};Rr(AA,(function(){return vB.getMenuButton().onclick(),true}),EG);var ri=function(){return LM==eO||LM==QJ||LM==UP||LM==Te||LM==x};Rr(pF,(function(){wX.setInputDir(vZ)}),ri),Rr(gO,(function(){wX.setInputDir(mW)}),ri),Rr(qN,(function(){wX.setInputDir(eI)}),ri),Rr(De,(function(){wX.setInputDir(oc)}),ri),Lz(pF,(function(){wX.clearInputDir(vZ)}),ri),Lz(gO,(function(){wX.clearInputDir(mW)}),ri),Lz(qN,(function(){wX.clearInputDir(eI)}),ri),Lz(De,(function(){wX.clearInputDir(oc)}),ri);var wL=function(){return ri()&&Yl};Rr(yB,(function(){EC.setUpdatesPerSecond(30)}),wL),Rr(IY,(function(){EC.setUpdatesPerSecond(15)}),wL),Lz(yB,(function(){EC.setUpdatesPerSecond(60)}),wL),Lz(IY,(function(){EC.setUpdatesPerSecond(60)}),wL);var kS=function(){return!Zq()&&Gg.getMode()!=fI};Rr(TS,(function(){Gg.startSeeking()}),kS),Lz(TS,(function(){Gg.startRecording()}),kS);var mr=function(){return Gg.isSeeking()};Rr(qN,(function(){Gg.nextSpeed(1)}),mr),Rr(De,(function(){Gg.nextSpeed(-1)}),mr);var nh=function(){return wL()&&(LM==QJ||LM==Te||LM==x||LM==UP||LM==le||LM==SG||LM==ea)};Rr(yH,(function(){XW(Te,60)}),nh),Rr(xk,(function(){XW(SG)}),(function(){return LM==UP})),Rr(Jz,(function(){eP.isDrawTarget=!eP.isDrawTarget}),wL),Rr(eT,(function(){QQ.isDrawTarget=!QQ.isDrawTarget}),wL),Rr(Gs,(function(){eD.isDrawTarget=!eD.isDrawTarget}),wL),Rr(Rg,(function(){UK.isDrawTarget=!UK.isDrawTarget}),wL),Rr(qy,(function(){wX.isDrawTarget=!wX.isDrawTarget}),wL),Rr(TM,(function(){eP.isDrawPath=!eP.isDrawPath}),wL),Rr(pg,(function(){QQ.isDrawPath=!QQ.isDrawPath}),wL),Rr(IF,(function(){eD.isDrawPath=!eD.isDrawPath}),wL),Rr(SO,(function(){UK.isDrawPath=!UK.isDrawPath}),wL),Rr(bj,(function(){wX.isDrawPath=!wX.isDrawPath}),wL),Rr(na,(function(){wX.invincible=!wX.invincible}),wL),Rr(sx,(function(){ao=!ao}),wL),Rr(Qe,(function(){wX.ai=!wX.ai}),wL),Rr(xu,(function(){EC.togglePause()}))})();var uU=function(){var qZ=0,bK=0,cx=0,Rr=0,Lz=4,wv=function(cx){cx.preventDefault();var Rr=cx.touches.length;if(Rr==1)qZ=cx.touches[0].pageX,bK=cx.touches[0].pageY;else pF(cx)},Gw=function(wv){wv.preventDefault();var Gw=wv.touches.length;if(Gw==1){if(cx=wv.touches[0].pageX-qZ,Rr=wv.touches[0].pageY-bK,cx*cx+Rr*Rr>=Lz*Lz)if(qZ+=cx,bK+=Rr,Math.abs(cx)>=Math.abs(Rr))wX.setInputDir(cx>0?mW:vZ);else wX.setInputDir(Rr>0?oc:eI)}else pF(wv)},AA=function(qZ){qZ.preventDefault()},pF=function(Lz){Lz.preventDefault(),qZ=bK=cx=Rr=0},gO=function(qZ){wX.clearInputDir(void 0)};document.onclick=gO,document.ontouchstart=wv,document.ontouchend=AA,document.ontouchmove=Gw,document.ontouchcancel=pF},HE=function(qZ,bK){Rj=void 0,BA.drawMap(true),setTimeout(cx.coffeeBreakMusic.startLoop,1200),qZ.nextState=bK,XW(qZ,60)},Nq=qZ(Ks,{init:function(){Ks.init.call(this),wX.setPos(232,164),eP.setPos(257,164),eP.setDir(vZ),eP.faceDirEnum=vZ,wX.setDir(vZ),eP.scared=false,eP.mode=IC,Gs(),eT(),Qc.reset(),wX.getNumSteps=function(){return vj.prototype.getStepSizeFromTable.call(this,5,fP)},eP.getNumSteps=function(){return vj.prototype.getStepSizeFromTable.call(this,5,vF)},wX.steer=eP.steer=function(){}},triggers:{0:{update:function(){var qZ;for(qZ=0;qZ<2;qZ++)wX.update(qZ),eP.update(qZ);wX.frames++,eP.frames++},draw:function(){BA.blitMap(),BA.beginMapClip(),BA.drawPlayer(),BA.drawGhost(eP),BA.endMapClip()}},260:{init:function(){wX.setPos(-193,155),eP.setPos(-8,164),eP.setDir(mW),eP.faceDirEnum=mW,wX.setDir(mW),eP.scared=true,wX.getNumSteps=function(){return vj.prototype.getStepSizeFromTable.call(this,5,em)},eP.getNumSteps=function(){return vj.prototype.getStepSizeFromTable.call(this,5,lR)}},update:function(){var qZ;for(qZ=0;qZ<2;qZ++)wX.update(qZ),eP.update(qZ);wX.frames++,eP.frames++},draw:function(){BA.blitMap(),BA.beginMapClip(),BA.drawGhost(eP),BA.renderFunc((function(qZ){var bK=Math.floor(wX.steps/4)%4;if(bK==3)bK=1;AU(qZ,wX.pixel.x,wX.pixel.y,wX.dirEnum,bK)})),BA.endMapClip()}},640:{init:function(){delete wX.getNumSteps,delete eP.getNumSteps,delete wX.steer,delete eP.steer,Rg(),XW(Nq.nextState,60)}}}}),cc=function(){var bK=new Zd,cx=new Zd,Rr=function(qZ,Rr){var Lz=Rr.getAnimFrame(),wv;if(Rr==bK)wv=De==pF?PP.drawPacmanSprite:PP.drawOttoSprite;else if(Rr==cx)wv=De==pF?PP.drawMsPacmanSprite:PP.drawMsOttoSprite;wv(qZ,Rr.pixel.x,Rr.pixel.y,Rr.dirEnum,Lz)},Lz=function(){BA.blitMap(),BA.beginMapClip(),BA.renderFunc((function(qZ){Rr(qZ,bK),Rr(qZ,cx)})),BA.drawGhost(eD),BA.drawGhost(QQ),BA.endMapClip()},wv=function(){var qZ;for(qZ=0;qZ<2;qZ++)bK.update(qZ),cx.update(qZ),eD.update(qZ),QQ.update(qZ);bK.frames++,cx.frames++,eD.frames++,QQ.frames++},Gw=function(){delete eD.getNumSteps,delete QQ.getNumSteps,delete eD.steer,delete QQ.steer,delete eD.getAnimFrame,delete QQ.getAnimFrame,Rg(),XW(cc.nextState,60)},AA,gO,qN,Yl,ao,TS,ty,qK,SW,xk,yH,Jz,qy,TM,pg,IF,SO,bj,na,sx,Qe,yB;return qZ(Ks,{init:function(){Ks.init.call(this),cx.frames=20,bK.frames=12,bK.setPos(-10,99),bK.setDir(mW),cx.setPos(232,180),cx.setDir(vZ),eD.frames=0,eD.mode=IC,eD.scared=false,eD.setPos(bK.pixel.x-42,99),eD.setDir(mW),eD.faceDirEnum=mW,QQ.frames=3,QQ.mode=IC,QQ.scared=false,QQ.setPos(cx.pixel.x+49,180),QQ.setDir(vZ),QQ.faceDirEnum=vZ,Gs(),eT(),Qc.reset(),bK.getStepFrame=function(){return Math.floor(this.frames/4)%4},cx.getStepFrame=function(){return Math.floor(this.frames/4)%4},eD.getAnimFrame=function(){return Math.floor(this.frames/8)%2},QQ.getAnimFrame=function(){return Math.floor(this.frames/8)%2},bK.getNumSteps=function(){return 1},cx.getNumSteps=function(){return 1},eD.getNumSteps=function(){return 1},QQ.getNumSteps=function(){return 1},bK.steer=function(){},cx.steer=function(){},eD.steer=function(){},QQ.steer=function(){}},triggers:{0:{update:function(){if(wv(),eD.pixel.x==105)eD.getNumSteps=function(){return vj.prototype.getStepSizeFromTable.call(this,5,vF)},QQ.getNumSteps=function(){return vj.prototype.getStepSizeFromTable.call(this,5,vF)}},draw:Lz},300:(AA=[1,0,1,0,0,1,0,1,0,1,0,0,1,0,1,0,1,0,0,1,0,1,0,1,0],gO=[-1,0,-1,0,0,0,0,0,1,0,1,0,0,0,-1,0,-1,0,0,0,0,0,1,0,1],qN=[0,0,0,0,-1,0,-1,0,0,-1,0,-1,0,-1,0,0,-1,0,-1,0,-1,0,0,-1,0,-1,0,-1,0,0],Yl=[0,0,0,-1,0,-1,0,0,0,0,0,1,0,1,0,0,0,-1,0,-1,0,0,0,0,0,1,0,1,0,0],ao=0,TS=0,ty=AA.length,qK=qN.length,SW=[0,1,1,1,1,0,0],xk=[0,0,-1,-1,-1,0,0],yH=0,Jz=SW.length,qy=0,TM=0,IF=0,SO=1,na=0,sx=1,Qe=2,yB=3,{init:function(){ao=TS=yH=qy=TM=0,pg=IF,bj=na,cx.setPos(-8,143),cx.setDir(mW),QQ.setPos(-81,143),QQ.faceDirEnum=mW,QQ.setDir(mW),bK.setPos(223+8+3,142),bK.setDir(vZ),eD.setPos(302,143),eD.faceDirEnum=vZ,eD.setDir(vZ),eD.getNumSteps=QQ.getNumSteps=function(){return"11211212"[this.frames%8]}},update:function(){var qZ;if(bj==na){for(qZ=0;qZ<2;qZ++)bK.update(qZ),cx.update(qZ);if(cx.pixel.x==102)bj++}else if(bj==sx){if(bK.pixel.x-=SW[yH],bK.pixel.y+=xk[yH],bK.commitPos(),cx.pixel.x+=SW[yH],cx.pixel.y+=xk[yH],cx.commitPos(),yH++,yH==Jz)bj++}else if(bj==Qe){if(qy==0)cx.pixel.y-=2,cx.commitPos(),cx.setDir(eI),bK.pixel.x-=1,bK.commitPos(),bK.setDir(eI);else for(qZ=0;qZ<2;qZ++)bK.update(qZ),cx.update(qZ);if(qy++,cx.pixel.y==91)bj++}else if(bj==yB){if(TM==0)cx.pixel.y++,cx.setDir(mW),cx.commitPos(),bK.pixel.y--,bK.pixel.x++,bK.setDir(vZ),bK.commitPos();if(TM>18)bK.frames--,cx.frames--;if(TM==78)Gw();TM++}if(bK.frames++,cx.frames++,pg==IF){for(qZ=0;qZ<2;qZ++)eD.update(qZ),QQ.update(qZ);if(eD.pixel.x=Math.max(120,eD.pixel.x),eD.commitPos(),QQ.pixel.x=Math.min(105,QQ.pixel.x),QQ.commitPos(),QQ.pixel.x==105)pg++}else if(pg==SO){if(ao<ty)eD.pixel.x+=AA[ao],eD.pixel.y+=gO[ao];if(TS<qK)QQ.pixel.x+=qN[TS],QQ.pixel.y+=Yl[TS];ao++,TS++}eD.frames++,QQ.frames++},draw:function(){if(BA.blitMap(),BA.beginMapClip(),BA.renderFunc((function(qZ){Rr(qZ,bK),Rr(qZ,cx)})),ao<ty)BA.drawGhost(eD);if(TS<qK)BA.drawGhost(QQ);if(bj==yB)BA.renderFunc((function(qZ){zQ(qZ,112,73)}));BA.endMapClip()}})}})}(),Al=function(){var bK=new Zd,cx=new Zd,Rr=function(qZ,Rr){var Lz=Rr.getAnimFrame(),wv;if(Rr==bK)wv=De==pF?PP.drawPacmanSprite:PP.drawOttoSprite;else if(Rr==cx)wv=De==pF?PP.drawMsPacmanSprite:PP.drawMsOttoSprite;wv(qZ,Rr.pixel.x,Rr.pixel.y,Rr.dirEnum,Lz)},Lz=function(){BA.blitMap(),BA.beginMapClip(),BA.renderFunc((function(qZ){Rr(qZ,bK),Rr(qZ,cx)})),BA.endMapClip()},wv=function(){var qZ;for(qZ=0;qZ<7;qZ++)bK.update(qZ),cx.update(qZ);bK.frames++,cx.frames++},Gw=function(){Rg(),XW(Al.nextState,60)},AA=function(){return 3},gO=function(){return"32"[this.frames%2]},qN=function(){return 7};return qZ(Ks,{init:function(){Ks.init.call(this),cx.frames=20,bK.frames=12,bK.getStepFrame=function(){return Math.floor(this.frames/4)%4},cx.getStepFrame=function(){return Math.floor(this.frames/4)%4},bK.steer=function(){},cx.steer=function(){},Gs(),eT()},triggers:{0:{draw:function(){BA.blitMap()}},160:{init:function(){bK.setPos(-8,67),bK.setDir(mW),cx.setPos(-106,68),cx.setDir(mW),bK.getNumSteps=gO,cx.getNumSteps=AA},update:wv,draw:Lz},410:{init:function(){bK.setPos(329,163),bK.setDir(vZ),cx.setPos(223+8,164),cx.setDir(vZ),bK.getNumSteps=AA,cx.getNumSteps=gO},update:wv,draw:Lz},670:{init:function(){bK.setPos(-8,142),bK.setDir(mW),cx.setPos(-106,143),cx.setDir(mW),bK.getNumSteps=gO,cx.getNumSteps=AA},update:wv,draw:Lz},930:{init:function(){bK.setPos(233+148,99),bK.setDir(vZ),cx.setPos(233,100),cx.setDir(vZ),bK.getNumSteps=qN,cx.getNumSteps=qN},update:function(){if(bK.pixel.x<=17&&bK.dirEnum==vZ)bK.setPos(-2,195),bK.setDir(mW),cx.setPos(-2-148,196),cx.setDir(mW);wv()},draw:Lz},1140:{init:Gw}}})}(),jQ=qZ(Ks,{init:function(){Ks.init.call(this),wX.setPos(232,164),eP.setPos(257,164),eP.setDir(vZ),eP.faceDirEnum=vZ,wX.setDir(vZ),eP.scared=false,eP.mode=IC,Gs(),eT(),Qc.reset(),wX.getNumSteps=function(){return vj.prototype.getStepSizeFromTable.call(this,5,fP)},eP.getNumSteps=function(){return vj.prototype.getStepSizeFromTable.call(this,5,vF)},wX.steer=eP.steer=function(){}},triggers:{0:{update:function(){var qZ;for(qZ=0;qZ<2;qZ++)wX.update(qZ),eP.update(qZ);wX.frames++,eP.frames++},draw:function(){BA.blitMap(),BA.beginMapClip(),BA.drawPlayer(),BA.drawGhost(eP),BA.endMapClip()}},260:{init:function(){wX.setPos(-193,164),eP.setPos(-8,155),eP.setDir(mW),eP.faceDirEnum=mW,wX.setDir(mW),eP.scared=true,wX.getNumSteps=function(){return vj.prototype.getStepSizeFromTable.call(this,5,em)},eP.getNumSteps=function(){return vj.prototype.getStepSizeFromTable.call(this,5,lR)}},update:function(){var qZ;for(qZ=0;qZ<2;qZ++)wX.update(qZ),eP.update(qZ);wX.frames++,eP.frames++},draw:function(){BA.blitMap(),BA.beginMapClip(),BA.drawPlayer(),BA.renderFunc((function(qZ){var bK=eP.getBounceY(eP.pixel.x,eP.pixel.y,mW),cx=eP.pixel.x;qZ.save(),qZ.translate(cx,bK);var Rr=16/6;qZ.scale(Rr,Rr),MQ(qZ,0,0),qZ.restore()})),BA.endMapClip()}},640:{init:function(){delete wX.getNumSteps,delete eP.getNumSteps,delete wX.steer,delete eP.steer,Rg(),XW(jQ.nextState,60)}}}}),FF=function(){var bK=new Ga;bK.scared=true,bK.mode=IC;var cx=new Zd,Rr=function(qZ,Rr){var Lz=Rr.getAnimFrame(),wv;if(Rr==bK){var Gw=Rr.getBounceY(Rr.pixel.x,Rr.pixel.y,Rr.dirEnum);PP.drawMuppetSprite(qZ,Rr.pixel.x,Gw,0,Rr.dirEnum,true,false)}else if(Rr==cx)Ly(qZ,Rr.pixel.x,Rr.pixel.y,Rr.dirEnum,Lz,true)},Lz=function(){BA.blitMap(),BA.beginMapClip(),BA.renderFunc((function(qZ){Rr(qZ,bK),Rr(qZ,cx)})),BA.drawGhost(eD),BA.drawGhost(QQ),BA.endMapClip()},wv=function(){var qZ;for(qZ=0;qZ<2;qZ++)bK.update(qZ),cx.update(qZ),eD.update(qZ),QQ.update(qZ);bK.frames++,cx.frames++,eD.frames++,QQ.frames++},Gw=function(){delete eD.getNumSteps,delete QQ.getNumSteps,delete eD.steer,delete QQ.steer,delete eD.getAnimFrame,delete QQ.getAnimFrame,Rg(),XW(FF.nextState,60)},AA,pF,gO,qN,Yl,ao,De,TS,ty,qK,SW,xk,yH,Jz,qy,TM,pg,IF,SO,bj,na,sx;return qZ(Ks,{init:function(){Ks.init.call(this),cx.frames=14,bK.frames=12,bK.setPos(-10,99),bK.setDir(mW),cx.setPos(232,180),cx.setDir(vZ),eD.frames=0,eD.mode=IC,eD.scared=false,eD.setPos(bK.pixel.x-42,99),eD.setDir(mW),eD.faceDirEnum=mW,QQ.frames=3,QQ.mode=IC,QQ.scared=false,QQ.setPos(cx.pixel.x+49,180),QQ.setDir(vZ),QQ.faceDirEnum=vZ,Gs(),eT(),Qc.reset(),bK.getStepFrame=function(){return Math.floor(this.frames/4)%4},cx.getStepFrame=function(){return Math.floor(this.frames/4)%4},eD.getAnimFrame=function(){return Math.floor(this.frames/8)%2},QQ.getAnimFrame=function(){return Math.floor(this.frames/8)%2},bK.getNumSteps=function(){return 1},cx.getNumSteps=function(){return 1},eD.getNumSteps=function(){return 1},QQ.getNumSteps=function(){return 1},bK.steer=function(){},cx.steer=function(){},eD.steer=function(){},QQ.steer=function(){}},triggers:{0:{update:function(){if(wv(),eD.pixel.x==105)eD.getNumSteps=function(){return vj.prototype.getStepSizeFromTable.call(this,5,vF)},QQ.getNumSteps=function(){return vj.prototype.getStepSizeFromTable.call(this,5,vF)}},draw:Lz},300:(AA=[1,0,1,0,0,1,0,1,0,1,0,0,1,0,1,0,1,0,0,1,0,1,0,1,0],pF=[-1,0,-1,0,0,0,0,0,1,0,1,0,0,0,-1,0,-1,0,0,0,0,0,1,0,1],gO=[0,0,0,0,-1,0,-1,0,0,-1,0,-1,0,-1,0,0,-1,0,-1,0,-1,0,0,-1,0,-1,0,-1,0,0],qN=[0,0,0,-1,0,-1,0,0,0,0,0,1,0,1,0,0,0,-1,0,-1,0,0,0,0,0,1,0,1,0,0],Yl=0,ao=0,De=AA.length,TS=gO.length,ty=[0,1,1,1,1,0,0,1,1,1,1,1,1],qK=[0,0,-1,-1,-1,0,0,0,0,0,0,0,0],SW=0,xk=ty.length,yH=0,Jz=0,TM=0,pg=1,SO=0,bj=1,na=2,sx=3,{init:function(){Yl=ao=SW=yH=Jz=0,qy=TM,IF=SO,cx.setPos(-8,143),cx.setDir(mW),QQ.setPos(-81,143),QQ.faceDirEnum=mW,QQ.setDir(mW),bK.setPos(223+8+3,142),bK.setDir(vZ),eD.setPos(302,143),eD.faceDirEnum=vZ,eD.setDir(vZ),eD.getNumSteps=QQ.getNumSteps=function(){return"11211212"[this.frames%8]}},update:function(){var qZ;if(IF==SO){for(qZ=0;qZ<2;qZ++)bK.update(qZ),cx.update(qZ);if(cx.pixel.x==102)IF++}else if(IF==bj){if(bK.pixel.x-=ty[SW],bK.pixel.y+=qK[SW],bK.commitPos(),cx.pixel.x+=ty[SW],cx.pixel.y+=qK[SW],cx.commitPos(),SW++,SW==xk)IF++}else if(IF==na){if(yH==0)cx.pixel.y-=2,cx.commitPos(),cx.setDir(eI);else for(qZ=0;qZ<2;qZ++)cx.update(qZ);if(yH++,cx.pixel.y==91)IF++}else if(IF==sx){if(Jz==0)cx.pixel.y++,cx.setDir(mW),cx.commitPos();if(Jz>18)cx.frames--;if(Jz==78)Gw();Jz++}if(bK.frames++,cx.frames++,qy==TM){for(qZ=0;qZ<2;qZ++)eD.update(qZ),QQ.update(qZ);if(eD.pixel.x=Math.max(120,eD.pixel.x),eD.commitPos(),QQ.pixel.x=Math.min(105,QQ.pixel.x),QQ.commitPos(),QQ.pixel.x==105)qy++}else if(qy==pg){if(Yl<De)eD.pixel.x+=AA[Yl],eD.pixel.y+=pF[Yl];if(ao<TS)QQ.pixel.x+=gO[ao],QQ.pixel.y+=qN[ao];Yl++,ao++}eD.frames++,QQ.frames++},draw:function(){if(BA.blitMap(),BA.beginMapClip(),BA.renderFunc((function(qZ){if(IF<=bj)Rr(qZ,bK);Rr(qZ,cx)})),Yl<De)BA.drawGhost(eD);if(ao<TS)BA.drawGhost(QQ);if(IF==sx)BA.renderFunc((function(qZ){zQ(qZ,112,73)}));BA.endMapClip()}})}})}(),ib=[[Nq],[cc,Al],[jQ,FF],[cc,Al]],Uf=function(){var qZ=ib[De],bK,cx=qZ.length;for(bK=0;bK<cx;bK++)if(LM==qZ[bK])return true;return false},UJ=function(){if(De==AA){if(qy==2)return HE(Nq,Te),true}else if(De==pF||De==qN){if(qy==2)return HE(cc,Te),true;else if(qy==5)return HE(Al,Te),true}else if(De==gO)if(qy==2)return HE(jQ,Te),true;else if(qy==5)return HE(FF,Te),true;return false},Rj;eP.startDirEnum=vZ,eP.startPixel={x:14*jn-1,y:14*jn+Hp.y},eP.cornerTile={x:28-1-2,y:0},eP.startMode=IC,eP.arriveHomeMode=qA,QQ.startDirEnum=oc,QQ.startPixel={x:14*jn-1,y:17*jn+Hp.y},QQ.cornerTile={x:2,y:0},QQ.startMode=rY,QQ.arriveHomeMode=rY,eD.startDirEnum=eI,eD.startPixel={x:12*jn-1,y:17*jn+Hp.y},eD.cornerTile={x:28-1,y:36-2},eD.startMode=rY,eD.arriveHomeMode=rY,UK.startDirEnum=eI,UK.startPixel={x:16*jn-1,y:17*jn+Hp.y},UK.cornerTile={x:0,y:36-2},UK.startMode=rY,UK.arriveHomeMode=rY,wX.startDirEnum=vZ,wX.startPixel={x:14*jn-1,y:26*jn+Hp.y};var Vu=new Lm(28,36,"____________________________"+"____________________________"+"____________________________"+"____________________________"+"____________________________"+"____________________________"+"____________________________"+"____________________________"+"____________________________"+"__||||||||||||||||||||||||__"+"__|                      |__"+"__| ||||| |||||||| ||||| |__"+"__| ||||| |||||||| ||||| |__"+"__| ||    ||    ||    || |__"+"__| || || || || || || || |__"+"||| || || || || || || || |||"+"       ||    ||    ||       "+"||| ||||| |||||||| ||||| |||"+"__| ||||| |||||||| ||||| |__"+"__|    ||          ||    |__"+"__| || || |||||||| || || |__"+"__| || || |||||||| || || |__"+"__| ||    ||    ||    || |__"+"__| || || || || || || || |__"+"||| || || || || || || || |||"+"       ||    ||    ||       "+"||| |||||||| || |||||||| |||"+"__| |||||||| || |||||||| |__"+"__|                      |__"+"__||||||||||||||||||||||||__"+"____________________________"+"____________________________"+"____________________________"+"____________________________"+"____________________________"+"____________________________");Vu.name="Pac-Man",Vu.wallStrokeColor="#47b897",Vu.wallFillColor="#000",Vu.pelletColor="#ffb8ae",Vu.shouldDrawMapOnly=true;var PG=new Lm(28,36,"____________________________"+"____________________________"+"____________________________"+"||||||||||||||||||||||||||||"+"|............||............|"+"|.||||.|||||.||.|||||.||||.|"+"|o||||.|||||.||.|||||.||||o|"+"|.||||.|||||.||.|||||.||||.|"+"|..........................|"+"|.||||.||.||||||||.||.||||.|"+"|.||||.||.||||||||.||.||||.|"+"|......||....||....||......|"+"||||||.||||| || |||||.||||||"+"_____|.||||| || |||||.|_____"+"_____|.||          ||.|_____"+"_____|.|| |||--||| ||.|_____"+"||||||.|| |______| ||.||||||"+"      .   |______|   .      "+"||||||.|| |______| ||.||||||"+"_____|.|| |||||||| ||.|_____"+"_____|.||          ||.|_____"+"_____|.|| |||||||| ||.|_____"+"||||||.|| |||||||| ||.||||||"+"|............||............|"+"|.||||.|||||.||.|||||.||||.|"+"|.||||.|||||.||.|||||.||||.|"+"|o..||.......  .......||..o|"+"|||.||.||.||||||||.||.||.|||"+"|||.||.||.||||||||.||.||.|||"+"|......||....||....||......|"+"|.||||||||||.||.||||||||||.|"+"|.||||||||||.||.||||||||||.|"+"|..........................|"+"||||||||||||||||||||||||||||"+"____________________________"+"____________________________");PG.name="Pac-Man",PG.wallStrokeColor="#2121ff",PG.wallFillColor="#000",PG.pelletColor="#ffb8ae",PG.constrainGhostTurns=function(qZ,bK){if((qZ.x==12||qZ.x==15)&&(qZ.y==14||qZ.y==26))bK[eI]=false};var TF=function(qZ){if(qZ<=2)return 1;else if(qZ<=5)return 2;else return 3+Math.floor((qZ-6)/4)},iK=function(qZ){if(De==AA)return{wallFillColor:PG.wallFillColor,wallStrokeColor:PG.wallStrokeColor,pelletColor:PG.pelletColor};else if(De==pF||De==qN)return zf(qZ);else if(De==gO)return FB(qZ)},jo=function(qZ){if(qZ==1)return[1,2];else if(qZ==2)return[3,5];else{var bK=qZ*4-6;return[bK,bK+3]}},FB=function(qZ){var bK=["#359c9c","#80d8fc","#c2b853","#e6f1e7","#86669c","#f2c1db","#ed0a04","#e8b4cd","#2067c1","#63e0b6","#c55994","#fd61c3","#12bc76","#b4e671","#5036d9","#618dd4","#939473","#fdfdf4"],cx=(qZ-1)*2%bK.length;return{wallFillColor:bK[cx],wallStrokeColor:bK[cx+1],pelletColor:"#ffb8ae"}},hx=function(){var qZ,bK=TF(qy);if(!Rj||qy==1||bK!=TF(qy-1)){Rj=Wd();var cx=FB(bK);Rj.wallFillColor=cx.wallFillColor,Rj.wallStrokeColor=cx.wallStrokeColor,Rj.pelletColor=cx.pelletColor}},zf=function(qZ){qZ-=1;var bK=qZ<=1?qZ:qZ%2+2,cx=[bh,Oz,oU,AO],Rr=cx[bK];if(qZ>=4)return[{wallFillColor:"#ffb8ff",wallStrokeColor:"#FFFF00",pelletColor:"#00ffff"},{wallFillColor:"#FFB8AE",wallStrokeColor:"#FF0000",pelletColor:"#dedeff"},{wallFillColor:"#de9751",wallStrokeColor:"#dedeff",pelletColor:"#ff0000"},{wallFillColor:"#2121ff",wallStrokeColor:"#ffb851",pelletColor:"#dedeff"}][qZ%4];else return{wallFillColor:Rr.wallFillColor,wallStrokeColor:Rr.wallStrokeColor,pelletColor:Rr.pelletColor}},cM=function(){var qZ=[bh,Oz,oU,AO],bK=TF(qy)-1,cx=bK<=1?bK:bK%2+2;if(Rj=qZ[cx],bK>=4){var Rr=zf(bK+1);Rj.wallFillColor=Rr.wallFillColor,Rj.wallStrokeColor=Rr.wallStrokeColor,Rj.pelletColor=Rr.pelletColor}},bh=new Lm(28,36,"____________________________"+"____________________________"+"____________________________"+"||||||||||||||||||||||||||||"+"|......||..........||......|"+"|o||||.||.||||||||.||.||||o|"+"|.||||.||.||||||||.||.||||.|"+"|..........................|"+"|||.||.|||||.||.|||||.||.|||"+"__|.||.|||||.||.|||||.||.|__"+"|||.||.|||||.||.|||||.||.|||"+"   .||.......||.......||.   "+"|||.||||| |||||||| |||||.|||"+"__|.||||| |||||||| |||||.|__"+"__|.                    .|__"+"__|.||||| |||--||| |||||.|__"+"__|.||||| |______| |||||.|__"+"__|.||    |______|    ||.|__"+"__|.|| || |______| || ||.|__"+"|||.|| || |||||||| || ||.|||"+"   .   ||          ||   .   "+"|||.|||||||| || ||||||||.|||"+"__|.|||||||| || ||||||||.|__"+"__|.......   ||   .......|__"+"__|.|||||.||||||||.|||||.|__"+"|||.|||||.||||||||.|||||.|||"+"|............  ............|"+"|.||||.|||||.||.|||||.||||.|"+"|.||||.|||||.||.|||||.||||.|"+"|.||||.||....||....||.||||.|"+"|o||||.||.||||||||.||.||||o|"+"|.||||.||.||||||||.||.||||.|"+"|..........................|"+"||||||||||||||||||||||||||||"+"____________________________"+"____________________________");bh.name="Ms. Pac-Man 1",bh.wallFillColor="#FFB8AE",bh.wallStrokeColor="#FF0000",bh.pelletColor="#dedeff",bh.fruitPaths={entrances:[{start:{y:164,x:228},path:"<<<<vvv<<<<<<<<<^^^"},{start:{y:164,x:-4},path:">>>>vvvvvv>>>>>>>>>>>>>>>^^^<<<^^^"},{start:{y:92,x:-4},path:">>>>^^^^>>>vvvv>>>vvv>>>>>>>>>vvvvvv<<<"},{start:{y:92,x:228},path:"<<<<vvvvvvvvv<<<^^^<<<vvv<<<"}],exits:[{path:"<vvv>>>>>>>>>^^^>>>>"},{path:"<<<<vvv<<<<<<<<<^^^<<<<"},{path:"<<<<<<<^^^^^^<<<<<<^^^<<<<"},{path:"<vvv>>>>>>>>>^^^^^^^^^^^^>>>>"}]};var Oz=new Lm(28,36,"____________________________"+"____________________________"+"____________________________"+"||||||||||||||||||||||||||||"+"       ||..........||       "+"|||||| ||.||||||||.|| ||||||"+"|||||| ||.||||||||.|| ||||||"+"|o...........||...........o|"+"|.|||||||.||.||.||.|||||||.|"+"|.|||||||.||.||.||.|||||||.|"+"|.||......||.||.||......||.|"+"|.||.|||| ||....|| ||||.||.|"+"|.||.|||| |||||||| ||||.||.|"+"|......|| |||||||| ||......|"+"||||||.||          ||.||||||"+"||||||.|| |||--||| ||.||||||"+"|......|| |______| ||......|"+"|.||||.|| |______| ||.||||.|"+"|.||||.   |______|   .||||.|"+"|...||.|| |||||||| ||.||...|"+"|||.||.||          ||.||.|||"+"__|.||.|||| |||| ||||.||.|__"+"__|.||.|||| |||| ||||.||.|__"+"__|.........||||.........|__"+"__|.|||||||.||||.|||||||.|__"+"|||.|||||||.||||.|||||||.|||"+"   ....||...    ...||....   "+"|||.||.||.||||||||.||.||.|||"+"|||.||.||.||||||||.||.||.|||"+"|o..||.......||.......||..o|"+"|.||||.|||||.||.|||||.||||.|"+"|.||||.|||||.||.|||||.||||.|"+"|..........................|"+"||||||||||||||||||||||||||||"+"____________________________"+"____________________________");Oz.name="Ms. Pac-Man 2",Oz.wallFillColor="#47b8ff",Oz.wallStrokeColor="#dedeff",Oz.pelletColor="#ffff00",Oz.fruitPaths={entrances:[{start:{y:212,x:228},path:"<<<<^^^<<<<<<<<^^^<"},{start:{y:212,x:-4},path:">>>>^^^>>>>>>>>vvv>>>>>^^^^^^<"},{start:{y:36,x:-4},path:">>>>>>>vvv>>>vvvvvvv>>>>>>>>>vvvvvv<<<"},{start:{y:36,x:228},path:"<<<<<<<vvv<<<vvvvvvvvvvvvv<<<"}],exits:[{path:"vvv>>>>>>>>vvv>>>>"},{path:"vvvvvv<<<<<^^^<<<<<<<<vvv<<<<"},{path:"<<<<<<<^^^^^^^^^^^^^<<<^^^<<<<<<<"},{path:"vvv>>>>>^^^^^^^^^^>>>>>^^^^^^<<<<<^^^>>>>>>>"}]};var oU=new Lm(28,36,"____________________________"+"____________________________"+"____________________________"+"||||||||||||||||||||||||||||"+"|.........||....||.........|"+"|.|||||||.||.||.||.|||||||.|"+"|o|||||||.||.||.||.|||||||o|"+"|.||.........||.........||.|"+"|.||.||.||||.||.||||.||.||.|"+"|....||.||||.||.||||.||....|"+"||||.||.||||.||.||||.||.||||"+"||||.||..............||.||||"+" ....|||| |||||||| ||||.... "+"|.|| |||| |||||||| |||| ||.|"+"|.||                    ||.|"+"|.|||| || |||--||| || ||||.|"+"|.|||| || |______| || ||||.|"+"|.     || |______| ||     .|"+"|.|| |||| |______| |||| ||.|"+"|.|| |||| |||||||| |||| ||.|"+"|.||                    ||.|"+"|.|||| ||||| || ||||| ||||.|"+"|.|||| ||||| || ||||| ||||.|"+"|......||....||....||......|"+"|||.||.||.||||||||.||.||.|||"+"|||.||.||.||||||||.||.||.|||"+"|o..||.......  .......||..o|"+"|.||||.|||||.||.|||||.||||.|"+"|.||||.|||||.||.|||||.||||.|"+"|......||....||....||......|"+"|.||||.||.||||||||.||.||||.|"+"|.||||.||.||||||||.||.||||.|"+"|......||..........||......|"+"||||||||||||||||||||||||||||"+"____________________________"+"____________________________");oU.name="Ms. Pac-Man 3",oU.wallFillColor="#de9751",oU.wallStrokeColor="#dedeff",oU.pelletColor="#ff0000",oU.fruitPaths={entrances:[{start:{y:100,x:228},path:"<<<<<vv<<<<<vvvvvv<<<"},{start:{y:100,x:-4},path:">>>>>vv>>>>>>>>>>>>>>vvvvvv<<<"},{start:{y:100,x:-4},path:">>>>>vv>>>>>>>>>>>>>>vvvvvv<<<"},{start:{y:100,x:228},path:"<<vvvvv<<<vvv<<<<<<<<"}],exits:[{path:"<vvv>>>vvv>>>^^^>>>>>^^^^^^^^^^^>>"},{path:"<<<<vvv<<<vvv<<<^^^<<<<<^^^^^^^^^^^<<"},{path:"<<<<vvv<<<vvv<<<^^^<<<<<^^^^^^^^^^^<<"},{path:"<vvv>>>vvv>>>^^^^^^<<<^^^^^^>>>>>^^>>>>>"}]},oU.constrainGhostTurns=function(qZ,bK,cx){if(qZ.y==12)if(qZ.x==1&&cx==mW||qZ.x==26&&cx==vZ)bK[oc]=false};var AO=new Lm(28,36,"____________________________"+"____________________________"+"____________________________"+"||||||||||||||||||||||||||||"+"|..........................|"+"|.||.||||.||||||||.||||.||.|"+"|o||.||||.||||||||.||||.||o|"+"|.||.||||.||....||.||||.||.|"+"|.||......||.||.||......||.|"+"|.||||.||.||.||.||.||.||||.|"+"|.||||.||.||.||.||.||.||||.|"+"|......||....||....||......|"+"|||.|||||||| || ||||||||.|||"+"__|.|||||||| || ||||||||.|__"+"__|....||          ||....|__"+"||| ||.|| |||--||| ||.|| |||"+"    ||.|| |______| ||.||    "+"||||||.   |______|   .||||||"+"||||||.|| |______| ||.||||||"+"    ||.|| |||||||| ||.||    "+"||| ||.||          ||.|| |||"+"__|....||||| || |||||....|__"+"__|.||.||||| || |||||.||.|__"+"__|.||....   ||   ....||.|__"+"__|.|||||.|| || ||.|||||.|__"+"|||.|||||.|| || ||.|||||.|||"+"|.........||    ||.........|"+"|.||||.||.||||||||.||.||||.|"+"|.||||.||.||||||||.||.||||.|"+"|.||...||..........||...||.|"+"|o||.|||||||.||.|||||||.||o|"+"|.||.|||||||.||.|||||||.||.|"+"|............||............|"+"||||||||||||||||||||||||||||"+"____________________________"+"____________________________");AO.name="Ms. Pac-Man 4",AO.wallFillColor="#2121ff",AO.wallStrokeColor="#ffb851",AO.pelletColor="#dedeff",AO.fruitPaths={entrances:[{start:{y:156,x:228},path:"<<<<vv<<<vv<<<<<<^^^"},{start:{y:156,x:-4},path:">>>>vv>>>vv>>>>>>vvv>>>^^^^^^"},{start:{y:132,x:-4},path:">>>>^^^^^>>>^^^>>>vvv>>>vvv>>>>>>vvvvvv<<<"},{start:{y:132,x:228},path:"<<<<^^<<<vvv<<<vvv<<<"}],exits:[{path:"<vvv>>>>>>^^>>>^^>>>>"},{path:"<<<<vvv<<<<<<^^<<<^^<<<<"},{path:"<<<<<<<^^^<<<^^^<<<vv<<<<"},{path:"<vvv>>>>>>^^^^^^^^^>>>vv>>>>"}]};var fI=-1,Ko=0,SZ=1,rE=2,bO=3,Gg=function(){var qZ,bK,cx,Rr,Lz=[-8,-4,-2,-1,0,1,2,4,8],wv=Lz.length,Gw=["rgba(255,255,0,0.25)","rgba(255,255,0,0.20)","rgba(255,255,0,0.15)","rgba(255,255,0,0.10)","rgba(0,0,0,0)","rgba(0,0,255,0.10)","rgba(0,0,255,0.15)","rgba(0,0,255,0.20)","rgba(0,0,255,0.25)"],AA=[18,13,8,3,3,10,15,20,25],pF=[6,5,4,3,3,3,4,5,6],gO,qN=15*60,ao,De,TS=function(){cx=0,gO=0,ao=0,De=0,states={},qy()},ty=function(){var qZ;for(qZ=0;qZ<5;qZ++)Af[qZ].load(gO);if(Sv.load(gO),Qc.load(gO),fj.load(gO),xA.load(gO),Um.load(gO),Rj.load(gO,cx),Qe(gO),LM==le)le.load(gO);else if(LM==SG)SG.load(gO)},qK=function(){var qZ;for(qZ=0;qZ<5;qZ++)Af[qZ].save(gO);if(Sv.save(gO),Qc.save(gO),fj.save(gO),xA.save(gO),Um.save(gO),Rj.save(gO),sx(gO),LM==le)le.save(gO);else if(LM==SG)SG.save(gO)},SW=function(){Rj.eraseFuture(cx),De=gO},xk=function(qZ){if(cx+=qZ,gO=(gO+qZ)%qN,gO<0)gO+=qN},yH=function(qZ,bK){return qZ<=bK?bK-qZ:bK+qN-qZ},Jz=function(qZ){if(!bK||qZ==0)return 0;var cx=yH(gO,De),Rr=yH(ao,gO);return qZ>0?Math.min(cx,qZ):Math.max(-Rr,qZ)},eT=function(){qZ=fI},Gs=function(qZ){if(qZ==void 0)qZ=Lz[Rr];if(bK)xk(Jz(qZ)),ty()},Rg=function(){if(bK){if(xk(1),gO==ao)ao=(ao+1)%qN;De=gO}else bK=true;qK()},qy=function(){qZ=Ko,bK=false,SW(),xu.disable(),UM.disable(),Zq.setIcon((function(qZ,bK,cx,Rr){ze(qZ,bK,cx,"#FFF")})),Zq.setText()},TM=function(){Zq.setText(Lz[Rr]+"x")},pg=function(){Rr=3,vZ(),xu.enable(),UM.enable(),Zq.setIcon(void 0),TM()},IF=function(qZ){if(Lz[Rr+qZ]!=void 0)Rr+=qZ;vZ(),TM()},SO,bj,na,yB,IY=5;SO=oP+1,yB=25,na=25,bj=Ab/2-yB/2;var xu=new Zy(SO,bj-yB-IY,na,yB,(function(){IF(1)}));xu.setIcon((function(qZ,bK,cx,Rr){cz(qZ,bK,cx,"#FFF")}));var UM=new Zy(SO,bj+yB+IY,na,yB,(function(){IF(-1)}));UM.setIcon((function(qZ,bK,cx,Rr){sZ(qZ,bK,cx,"#FFF")}));var Zq=new HK(SO,bj,na,yB,(function(){return qZ!=Ko}),(function(qZ){qZ?pg():qy()}));Zq.setIcon((function(qZ,bK,cx,Rr){ze(qZ,bK,cx,"#FFF")})),Zq.setFont(jn-1+"px ArcadeR","#FFF");var gw=new HK(-na-IY-1,bj,na,yB,(function(){return EC.getFramePeriod()==1e3/15}),(function(qZ){EC.setUpdatesPerSecond(qZ?15:60)}));gw.setIcon((function(qZ,bK,cx){PP.drawSnail(qZ,bK,cx,1)}));var EG=function(){if(gw.isOn())gw.setIcon((function(qZ,bK,cx){PP.drawSnail(qZ,bK,cx,0)}));else gw.setIcon((function(qZ,bK,cx){PP.drawSnail(qZ,bK,cx,1)}))},ri=function(){if(Yl){if(qZ==fI||qZ==Ko)xu.disable(),UM.disable();else xu.enable(),UM.enable();Zq.enable(),gw.enable()}},wL=function(){if(Yl)xu.disable(),UM.disable(),Zq.disable(),gw.disable()},kS=function(){return!vB.isOpen()&&(LM==UP||LM==SG||LM==le)},eI=function(qZ){if(Yl){if(kS()&&Gg.getMode()!=Ko)BA.setOverlayColor(Gw[Rr]);if(xu.isEnabled)xu.draw(qZ);if(UM.isEnabled)UM.draw(qZ);if(Zq.isEnabled)Zq.draw(qZ);if(gw.isEnabled)gw.draw(qZ)}},vZ=function(){var bK=Lz[Rr];if(bK==0)qZ=bO;else if(bK<0)qZ=SZ;else if(bK>0)qZ=rE};return{init:eT,reset:TS,seek:Gs,record:Rg,draw:eI,onFramePeriodChange:EG,onHudEnable:ri,onHudDisable:wL,eraseFuture:SW,startRecording:qy,startSeeking:pg,nextSpeed:IF,isSeeking:function(){return qZ==SZ||qZ==rE||qZ==bO},getTime:function(){return cx},getFrame:function(){return gO},getMode:function(){return qZ},drawHistory:function(qZ,bK){if(!this.isSeeking())return;var cx=yH(ao,gO),Lz=(gO-Math.min(cx,AA[Rr]))%qN;if(Lz<0)Lz+=qN;var Gw=yH(gO,De),Yl=(gO+Math.min(Gw,AA[wv-1-Rr]))%qN,TS=qZ.globalAlpha;qZ.globalAlpha=.2;var ty=Lz,qK=pF[Rr];if(Lz>Yl){for(;ty<qN;ty+=qK)bK(ty);ty%=qN}for(;ty<Yl;ty+=qK)bK(ty);qZ.globalAlpha=TS}}}();window.addEventListener("load",(function(){wL(),Sn(),PP.create(),uU();var qZ=window.location.hash.substring(1);if(qZ=="learn")XW(eO);else if(qZ=="cheat_pac"||qZ=="cheat_mspac"){De=qZ=="cheat_pac"?AA:pF,Yl=true,XW(QJ);for(var bK=0;bK<4;bK++)sd[bK].isDrawTarget=true,sd[bK].isDrawPath=true}else XW(cY);EC.init()}))})();